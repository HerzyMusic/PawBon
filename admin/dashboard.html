<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PawBon Admin â€” ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --rose:#E8475F; --rose-l:#FFF0F2; --teal:#2ECDA7; --teal-d:#1FA882; --teal-l:#EDFCF7;
  --amber:#FFB347; --amber-l:#FFF8EC; --orange:#FF7B54; --orange-l:#FFF4F0;
  --ink:#1A1A2E; --s700:#334155; --s600:#475569; --s500:#64748B;
  --s400:#94A3B8; --s300:#CBD5E1; --s200:#E2E8F0; --s100:#F1F5F9;
  --bg:#F8F6F3; --card:#FFFFFF;
  --sidebar-w: 240px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--ink);min-height:100vh;display:flex;}

.sidebar{width:var(--sidebar-w);background:var(--ink);color:#fff;position:fixed;top:0;left:0;bottom:0;overflow-y:auto;z-index:10;}
.sidebar-brand{padding:24px 20px 16px;border-bottom:1px solid rgba(255,255,255,.06);}
.sidebar-brand h1{font-size:18px;font-weight:900;display:flex;align-items:center;gap:8px;}
.sidebar-brand p{font-size:11px;color:var(--s400);margin-top:4px;}
.sidebar-section{padding:16px 12px 8px;font-size:10px;font-weight:700;color:var(--s500);letter-spacing:1.5px;text-transform:uppercase;}
.sidebar-item{display:flex;align-items:center;gap:10px;padding:10px 20px;font-size:13px;color:var(--s400);cursor:pointer;transition:all .15s;border-left:3px solid transparent;}
.sidebar-item:hover{background:rgba(255,255,255,.04);color:var(--s300);}
.sidebar-item.active{background:rgba(46,205,167,.08);color:var(--teal);border-left-color:var(--teal);font-weight:700;}
.sidebar-item .icon{font-size:16px;width:20px;text-align:center;}
.sidebar-item .badge{margin-left:auto;background:var(--teal);color:#fff;font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;}

.main{margin-left:var(--sidebar-w);flex:1;padding:24px 32px 60px;}
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
.topbar h2{font-size:20px;font-weight:900;}
.conn-panel{background:var(--card);border-radius:16px;padding:24px;margin-bottom:24px;border:1px solid var(--s200);}
.conn-panel h3{font-size:14px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.conn-grid{display:grid;grid-template-columns:1fr 1fr auto;gap:12px;align-items:end;}
.conn-field label{display:block;font-size:11px;font-weight:700;color:var(--s500);margin-bottom:4px;letter-spacing:.5px;}
.conn-field input{width:100%;padding:10px 14px;border:1.5px solid var(--s200);border-radius:10px;font-size:13px;font-family:'JetBrains Mono',monospace;background:var(--bg);}
.conn-field input:focus{outline:none;border-color:var(--teal);}
.stats-row{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:24px;}
.stat-card{background:var(--card);border-radius:14px;padding:16px 20px;border:1px solid var(--s200);}
.stat-card .num{font-size:28px;font-weight:900;}
.stat-card .label{font-size:11px;color:var(--s500);font-weight:600;margin-top:2px;}
.stat-card.teal .num{color:var(--teal-d);}
.stat-card.rose .num{color:var(--rose);}
.stat-card.amber .num{color:var(--orange);}
.stat-card.blue .num{color:#3B82F6;}
.stat-card.purple .num{color:#8B5CF6;}

.btn{padding:10px 20px;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;border:none;font-family:inherit;transition:all .15s;display:inline-flex;align-items:center;gap:6px;}
.btn:active{transform:scale(.97);}
.btn-primary{background:var(--teal);color:#fff;}
.btn-primary:hover{background:var(--teal-d);}
.btn-outline{background:var(--card);color:var(--s600);border:1.5px solid var(--s200);}
.btn-outline:hover{border-color:var(--s400);}
.btn-sm{padding:6px 14px;font-size:12px;border-radius:8px;}
.btn-danger{background:var(--rose);color:#fff;}
.btn-amber{background:var(--amber);color:#fff;}

.table-wrap{background:var(--card);border-radius:16px;border:1px solid var(--s200);overflow:hidden;margin-bottom:24px;}
.table-header{padding:16px 20px;border-bottom:1px solid var(--s200);display:flex;align-items:center;justify-content:space-between;}
.table-header h3{font-size:14px;font-weight:700;display:flex;align-items:center;gap:8px;}
.table-header .count{font-size:12px;color:var(--s400);font-weight:500;}
.table-scroll{overflow-x:auto;}
table{width:100%;border-collapse:collapse;font-size:12px;}
thead{background:var(--s100);}
th{padding:10px 14px;text-align:left;font-weight:700;color:var(--s600);white-space:nowrap;border-bottom:1px solid var(--s200);font-size:11px;letter-spacing:.3px;}
td{padding:10px 14px;border-bottom:1px solid var(--s100);vertical-align:top;}
tr:hover td{background:rgba(46,205,167,.03);}
td.mono{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--s600);}
td .tag{display:inline-block;padding:2px 10px;border-radius:6px;font-size:11px;font-weight:600;}
td .tag.genki{background:#DCFCE7;color:#166534;}
td .tag.worry{background:#FEF2F2;color:#991B1B;}
td .tag.active{background:#DBEAFE;color:#1E40AF;}
.status-dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:6px;}
.status-dot.on{background:#4ADE80;}.status-dot.off{background:var(--s300);}
.empty{padding:60px 20px;text-align:center;color:var(--s400);}
.empty .icon{font-size:48px;margin-bottom:12px;}
.loading{padding:40px;text-align:center;color:var(--s400);font-size:13px;}
.spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--s200);border-top-color:var(--teal);border-radius:50%;animation:spin .6s linear infinite;margin-right:8px;vertical-align:middle;}
@keyframes spin{to{transform:rotate(360deg);}}
.toast{position:fixed;bottom:24px;right:24px;padding:12px 20px;border-radius:12px;font-size:13px;font-weight:600;color:#fff;z-index:100;opacity:0;transform:translateY(10px);transition:all .3s;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.ok{background:var(--teal-d);}
.toast.err{background:var(--rose);}
.tab-content{display:none;}
.tab-content.active{display:block;}

/* Quota Management */
.quota-family-card{background:var(--card);border-radius:14px;border:1px solid var(--s200);margin-bottom:12px;overflow:hidden;}
.quota-family-header{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--s100);}
.quota-family-header .code{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--rose);font-size:14px;}
.quota-family-header .pets{font-size:13px;font-weight:600;flex:1;}
.quota-family-header .area{font-size:11px;color:var(--s400);}
.quota-body{padding:14px 16px;display:grid;grid-template-columns:repeat(4,1fr);gap:12px;align-items:center;}
.quota-item{text-align:center;}
.quota-item .val{font-size:22px;font-weight:900;}
.quota-item .lbl{font-size:10px;color:var(--s500);margin-top:2px;}
.quota-item .val.teal{color:var(--teal-d);}
.quota-item .val.amber{color:var(--orange);}
.quota-item .val.purple{color:#8B5CF6;}
.quota-item .val.blue{color:#3B82F6;}
.quota-actions{padding:12px 16px;border-top:1px solid var(--s100);display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.quota-actions .group{display:flex;align-items:center;gap:6px;background:var(--s100);padding:4px 6px;border-radius:8px;}
.quota-actions .group label{font-size:10px;font-weight:700;color:var(--s500);white-space:nowrap;}
.quota-actions .group input{width:50px;padding:4px 8px;border:1.5px solid var(--s200);border-radius:6px;font-size:12px;font-family:'JetBrains Mono',monospace;text-align:center;background:#fff;}
.quota-actions .group input:focus{outline:none;border-color:var(--teal);}
.total-quota{font-size:12px;margin-left:auto;color:var(--s500);font-weight:600;}
.total-quota strong{color:var(--ink);}

/* Search bar */
.search-bar{display:flex;gap:8px;margin-bottom:16px;}
.search-bar input{flex:1;padding:10px 14px;border:1.5px solid var(--s200);border-radius:10px;font-size:13px;background:var(--card);}
.search-bar input:focus{outline:none;border-color:var(--teal);}

/* Log table */
.log-row{font-size:11px;}
.log-row .time{color:var(--s400);font-family:'JetBrains Mono',monospace;}
.log-row .action{font-weight:700;}
.log-row .action.add{color:var(--teal-d);}
.log-row .action.remove{color:var(--rose);}
.log-row .action.purchase{color:var(--orange);}

@media(max-width:900px){
  .sidebar{width:60px;}
  .sidebar-brand h1 span,.sidebar-brand p,.sidebar-section,.sidebar-item span:not(.icon),.sidebar-item .badge{display:none;}
  .sidebar-item{padding:12px 0;justify-content:center;}
  .main{margin-left:60px;padding:16px;}
  .stats-row{grid-template-columns:1fr 1fr;}
  .conn-grid{grid-template-columns:1fr;}
  .quota-body{grid-template-columns:1fr 1fr;}
}

/* â•â•â• OpenChaté‹å–¶ Styles â•â•â• */
.ops-hint{background:#E8F8ED;border-left:4px solid #06c755;border-radius:0 8px 8px 0;padding:12px 16px;font-size:12px;line-height:1.8;margin-bottom:16px;color:#1A1A2E;}
.ops-hint strong{font-weight:700;}
.ops-hint.warn{background:#FFF8EE;border-color:#FFB347;}
.ops-hint.err{background:#FFF0F2;border-color:#E8475F;}
.ops-checklist{list-style:none;margin:0;padding:0;}
.ops-check{display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border-bottom:1px solid var(--s100);cursor:pointer;transition:background .15s;}
.ops-check:hover{background:var(--s50);}
.ops-check:last-child{border-bottom:none;}
.ops-check .ck{width:22px;height:22px;border-radius:6px;border:2px solid var(--s300);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px;color:transparent;transition:all .2s;margin-top:1px;}
.ops-check .ck.done{background:var(--teal-d);border-color:var(--teal-d);color:#fff;}
.ops-check.is-done{opacity:.5;}
.ops-check.is-done .ck-title{text-decoration:line-through;}
.ck-body{flex:1;min-width:0;}
.ck-title{font-size:13px;font-weight:600;}
.ck-meta{font-size:11px;color:var(--s500);margin-top:2px;display:flex;gap:10px;flex-wrap:wrap;}
.ck-meta .ck-time{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--teal-d);}
.ck-meta .ck-type{font-weight:700;font-size:10px;padding:1px 6px;border-radius:4px;}
.ck-type.semi{background:#E8F8ED;color:#05A847;}
.ck-type.manual{background:#FFF0F2;color:#D03A50;}

.tmpl-card{background:var(--card);border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.04),0 4px 12px rgba(0,0,0,.06);overflow:hidden;}
.tmpl-head{padding:12px 16px;color:#fff;font-weight:700;font-size:13px;display:flex;align-items:center;gap:8px;}
.tmpl-head .tmpl-id{background:rgba(255,255,255,.2);padding:2px 8px;border-radius:6px;font-size:10px;font-family:'JetBrains Mono',monospace;}
.tmpl-content{padding:16px;font-size:12px;line-height:2;background:var(--s50);border:1.5px solid var(--s100);border-radius:8px;margin:12px 16px;white-space:pre-line;max-height:240px;overflow-y:auto;}
.tmpl-foot{padding:10px 16px;border-top:1px solid var(--s100);display:flex;gap:8px;flex-wrap:wrap;}
.tmpl-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:16px;margin-top:16px;}

.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;}
.cal-day{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 1px 3px rgba(0,0,0,.04);border-top:3px solid var(--s200);min-height:100px;}
.cal-day.has-topic{border-top-color:#06c755;}
.cal-day .cal-label{font-weight:800;font-size:13px;margin-bottom:6px;}
.cal-day .cal-topic{font-weight:700;color:#05A847;font-size:12px;}
.cal-day .cal-eg{color:var(--s500);font-size:11px;line-height:1.5;margin-top:4px;}
.cal-day .cal-status{margin-top:6px;font-size:10px;}

.lifecycle-bar{display:flex;gap:4px;align-items:stretch;margin:16px 0;}
.lc-node{flex:1;padding:14px;border-radius:10px;font-size:11px;line-height:1.5;}
.lc-node .lc-icon{font-size:22px;}
.lc-node .lc-name{font-weight:800;font-size:12px;margin-top:2px;}
.lc-node .lc-cond{font-weight:700;opacity:.8;margin-top:1px;}
.lc-arrow{display:flex;align-items:center;font-size:16px;color:var(--s400);flex-shrink:0;}
.lc-seed{background:#E0F2FE;color:#0369A1;}
.lc-nurture{background:#E8F8ED;color:#05A847;}
.lc-selfrun{background:#FFF8EE;color:#B8860B;}
.lc-split{background:#FFF0F2;color:#D03A50;}

.mod-card{padding:14px 16px;border-radius:10px;border-left:4px solid;margin-bottom:10px;background:var(--card);box-shadow:0 1px 3px rgba(0,0,0,.04);}
.mod-card.sev-red{border-color:var(--rose);}
.mod-card.sev-yellow{border-color:var(--amber-d,#E89B2D);}
.mod-card.sev-info{border-color:var(--teal-d);}
.mod-card .mod-head{display:flex;align-items:center;gap:8px;font-size:12px;font-weight:700;margin-bottom:4px;}
.mod-card .mod-body{font-size:12px;color:var(--s500);line-height:1.6;}

.manual-section{background:var(--card);border-radius:12px;margin-bottom:16px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.04);}
.manual-header{padding:14px 20px;cursor:pointer;display:flex;align-items:center;gap:10px;font-weight:700;font-size:14px;border-bottom:1px solid var(--s100);transition:background .15s;}
.manual-header:hover{background:var(--s50);}
.manual-header .arrow{margin-left:auto;transition:transform .2s;font-size:12px;}
.manual-header.open .arrow{transform:rotate(180deg);}
.manual-body{padding:0 20px;max-height:0;overflow:hidden;transition:max-height .3s ease,padding .3s;}
.manual-body.open{max-height:2000px;padding:16px 20px;}
.manual-body table{width:100%;border-collapse:collapse;font-size:12px;}
.manual-body th{background:var(--s50);padding:8px 10px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--s500);border-bottom:2px solid var(--s200);}
.manual-body td{padding:8px 10px;border-bottom:1px solid var(--s100);vertical-align:top;}

.post-log-item{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid var(--s100);font-size:12px;align-items:flex-start;}
.post-log-item:last-child{border-bottom:none;}
.post-log-item .ptime{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--s500);white-space:nowrap;min-width:80px;}
.post-log-item .ptype{font-size:10px;font-weight:700;padding:1px 6px;border-radius:4px;white-space:nowrap;}
.ptype-daily{background:#E8F8ED;color:#05A847;}
.ptype-weekly{background:#E0F2FE;color:#0369A1;}
.ptype-achieve{background:#FFF8EE;color:#B8860B;}
.ptype-welcome{background:#F0EDFF;color:#6B21A8;}
.ptype-topic{background:#ECFDF5;color:#059669;}
.ptype-announce{background:#FFF0F2;color:#D03A50;}

.copied-toast{position:fixed;top:16px;right:16px;background:var(--teal-d);color:#fff;padding:10px 20px;border-radius:10px;font-size:13px;font-weight:700;box-shadow:0 8px 24px rgba(0,0,0,.15);z-index:9999;animation:fadeIO 2s forwards;pointer-events:none;}
@keyframes fadeIO{0%{opacity:0;transform:translateY(-10px);}15%{opacity:1;transform:translateY(0);}85%{opacity:1;}100%{opacity:0;transform:translateY(-10px);}}

/* Changelog Modal */
.cl-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(26,26,46,.55);z-index:9998;display:none;align-items:center;justify-content:center;backdrop-filter:blur(3px);}
.cl-overlay.show{display:flex;}
.cl-modal{background:var(--card);border-radius:18px;width:640px;max-width:90vw;max-height:85vh;display:flex;flex-direction:column;box-shadow:0 24px 80px rgba(0,0,0,.2);overflow:hidden;animation:clSlide .25s ease;}
@keyframes clSlide{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.cl-head{padding:24px 28px 16px;border-bottom:1px solid var(--s200);display:flex;align-items:center;gap:12px;}
.cl-head h2{font-size:18px;font-weight:900;flex:1;}
.cl-close{width:32px;height:32px;border-radius:8px;border:none;background:var(--s100);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:background .15s;}
.cl-close:hover{background:var(--s200);}
.cl-body{padding:20px 28px 28px;overflow-y:auto;flex:1;}
.cl-ver{margin-bottom:24px;}
.cl-ver:last-child{margin-bottom:0;}
.cl-ver-head{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.cl-ver-tag{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;padding:3px 12px;border-radius:8px;background:var(--teal-l);color:var(--teal-d);}
.cl-ver-tag.current{background:var(--teal);color:#fff;}
.cl-ver-tag.old{background:var(--s100);color:var(--s500);}
.cl-ver-date{font-size:12px;color:var(--s400);font-family:'JetBrains Mono',monospace;}
.cl-ver-title{font-size:13px;font-weight:700;color:var(--ink);margin-left:4px;}
.cl-changes{list-style:none;padding:0;}
.cl-changes li{padding:5px 0 5px 20px;font-size:12px;color:var(--s600);line-height:1.6;position:relative;}
.cl-changes li::before{content:'';position:absolute;left:4px;top:12px;width:6px;height:6px;border-radius:50%;background:var(--s300);}
.cl-changes li.feat::before{background:var(--teal);}
.cl-changes li.fix::before{background:var(--rose);}
.cl-changes li.improve::before{background:var(--amber);}
.cl-badge{font-size:10px;font-weight:700;padding:1px 6px;border-radius:4px;margin-right:4px;vertical-align:1px;}
.cl-badge.feat{background:#E8F8ED;color:#05A847;}
.cl-badge.fix{background:#FFF0F2;color:#D03A50;}
.cl-badge.improve{background:#FFF8EE;color:#B8860B;}

@media(max-width:900px){
  .cal-grid{grid-template-columns:1fr 1fr;}
  .lifecycle-bar{flex-direction:column;}
  .lc-arrow{transform:rotate(90deg);justify-content:center;}
  .tmpl-grid{grid-template-columns:1fr;}
}

/* â•â•â• Login Panel â•â•â• */
.login-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:9999;display:flex;align-items:center;justify-content:center;}
.login-card{background:var(--card);border-radius:20px;padding:40px;width:400px;max-width:90vw;box-shadow:0 8px 40px rgba(0,0,0,.1);text-align:center;}
.login-card h1{font-size:24px;font-weight:900;margin-bottom:4px;display:flex;align-items:center;justify-content:center;gap:8px;}
.login-card p{font-size:12px;color:var(--s500);margin-bottom:24px;}
.login-card .field{margin-bottom:16px;text-align:left;}
.login-card .field label{display:block;font-size:11px;font-weight:700;color:var(--s500);margin-bottom:4px;letter-spacing:.5px;}
.login-card .field input{width:100%;padding:12px 14px;border:1.5px solid var(--s200);border-radius:10px;font-size:14px;background:var(--bg);font-family:inherit;}
.login-card .field input:focus{outline:none;border-color:var(--teal);}
.login-card .login-btn{width:100%;padding:14px;border-radius:12px;background:var(--teal);color:#fff;font-size:14px;font-weight:700;border:none;cursor:pointer;font-family:inherit;transition:all .15s;margin-top:8px;}
.login-card .login-btn:hover{background:var(--teal-d);}
.login-card .login-btn:disabled{background:var(--s300);cursor:not-allowed;}
.login-error{color:var(--rose);font-size:12px;font-weight:600;margin-top:12px;display:none;}
.user-bar{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--s400);padding:12px 20px;border-top:1px solid rgba(255,255,255,.06);margin-top:auto;}
.user-bar .role-badge{font-size:10px;font-weight:700;padding:2px 8px;border-radius:6px;}
.role-badge.super_admin{background:var(--rose);color:#fff;}
.role-badge.admin{background:var(--teal);color:#fff;}
.role-badge.viewer{background:var(--s400);color:#fff;}
.logout-btn{margin-left:auto;background:none;border:none;color:var(--s500);cursor:pointer;font-size:11px;font-family:inherit;padding:4px 8px;border-radius:6px;transition:all .15s;}
.logout-btn:hover{background:rgba(255,255,255,.06);color:var(--s300);}

/* â•â•â• Admin Users Management â•â•â• */
.admin-user-card{background:var(--card);border-radius:12px;border:1px solid var(--s200);padding:16px;margin-bottom:10px;display:flex;align-items:center;gap:12px;}
.admin-user-card .au-email{font-size:13px;font-weight:600;flex:1;}
.admin-user-card .au-name{font-size:11px;color:var(--s500);}
.admin-user-card select{padding:6px 10px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;background:var(--card);font-family:inherit;}
</style>
</head>
<body>

<!-- â•â•â• Sidebar â•â•â• -->
<div class="sidebar" style="display:flex;flex-direction:column;">
  <div style="flex:1;overflow-y:auto;">
  <div class="sidebar-brand">
    <h1>ğŸ¾ <span>PawBon Admin</span></h1>
    <p>ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ <a href="javascript:void(0)" onclick="showChangelog()" style="color:var(--teal);text-decoration:none;cursor:pointer;border-bottom:1px dashed var(--teal);" title="æ›´æ–°å±¥æ­´ã‚’è¡¨ç¤º">v0.6.0</a></p>
  </div>

  <div class="sidebar-section">ãƒ†ãƒ¼ãƒ–ãƒ«</div>
  <div class="sidebar-item active" data-tab="dashboard" data-min-role="viewer"><span class="icon">ğŸ“Š</span><span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span></div>
  <div class="sidebar-item" data-tab="pet_families" data-min-role="viewer"><span class="icon">ğŸ </span><span>pet_families</span><span class="badge" id="badge-families">-</span></div>
  <div class="sidebar-item" data-tab="family_members" data-min-role="viewer"><span class="icon">ğŸ‘¥</span><span>family_members</span><span class="badge" id="badge-members">-</span></div>
  <div class="sidebar-item" data-tab="checkins" data-min-role="viewer"><span class="icon">âœ…</span><span>checkins</span><span class="badge" id="badge-checkins">-</span></div>
  <div class="sidebar-item" data-tab="referrals" data-min-role="viewer"><span class="icon">ğŸ</span><span>referrals</span><span class="badge" id="badge-referrals">-</span></div>

  <div class="sidebar-section">ç®¡ç†</div>
  <div class="sidebar-item" data-tab="quota_mgmt" data-min-role="admin"><span class="icon">ğŸ«</span><span>æ ãƒ»èª²é‡‘ç®¡ç†</span></div>
  <div class="sidebar-item" data-tab="openchat_list" data-min-role="admin"><span class="icon">ğŸ’¬</span><span>OpenChatä¸€è¦§</span><span class="badge" id="badge-openchats">-</span></div>
  <div class="sidebar-item" data-tab="openchat_bind" data-min-role="admin"><span class="icon">ğŸ”—</span><span>å®¶æ— Ã— OpenChat</span></div>

  <div class="sidebar-section" style="color:#06c755;">OpenChaté‹å–¶</div>
  <div class="sidebar-item" data-tab="oc_daily" data-min-role="admin"><span class="icon">â˜€ï¸</span><span>æ—¥æ¬¡é‹å–¶ãƒ‘ãƒãƒ«</span></div>
  <div class="sidebar-item" data-tab="oc_templates" data-min-role="admin"><span class="icon">ğŸ“‹</span><span>æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</span></div>
  <div class="sidebar-item" data-tab="oc_calendar" data-min-role="admin"><span class="icon">ğŸ“…</span><span>è©±é¡Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</span></div>
  <div class="sidebar-item" data-tab="oc_moderation" data-min-role="admin"><span class="icon">ğŸ›¡ï¸</span><span>ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</span></div>
  <div class="sidebar-item" data-tab="oc_manual" data-min-role="admin"><span class="icon">ğŸ“–</span><span>é‹å–¶ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</span></div>

  <div class="sidebar-section">ãƒ“ãƒ¥ãƒ¼</div>
  <div class="sidebar-item" data-tab="today_summary" data-min-role="viewer"><span class="icon">ğŸ“‹</span><span>today_summary</span></div>
  <div class="sidebar-item" data-tab="family_overview" data-min-role="viewer"><span class="icon">ğŸ“ˆ</span><span>family_overview</span></div>

  <div class="sidebar-section">ãƒ„ãƒ¼ãƒ«</div>
  <div class="sidebar-item" data-tab="sql" data-min-role="super_admin"><span class="icon">âš¡</span><span>SQL / REST</span></div>
  <div class="sidebar-item" data-tab="admin_users" data-min-role="super_admin"><span class="icon">ğŸ‘¤</span><span>ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼</span></div>
  </div>

  <div class="user-bar" id="userBar" style="display:none;">
    <span id="userDisplayName">-</span>
    <span class="role-badge" id="userRoleBadge">-</span>
    <button class="logout-btn" onclick="adminLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>
</div>

<!-- â•â•â• Main â•â•â• -->
<div class="main">

  <div class="conn-panel" id="connPanel" style="padding:12px 24px;">
    <h3 style="margin-bottom:0;font-size:13px;"><span class="status-dot off" id="connDot"></span> <span id="connLabel">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</span></h3>
  </div>

  <!-- â•â•â• Dashboard â•â•â• -->
  <div class="tab-content active" id="tab-dashboard">
    <div class="topbar"><h2>ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2><button class="btn btn-outline btn-sm" onclick="refreshAll()">ğŸ”„ å…¨æ›´æ–°</button></div>
    <div class="stats-row">
      <div class="stat-card teal"><div class="num" id="stat-families">-</div><div class="label">ç™»éŒ²å®¶æ—æ•°</div></div>
      <div class="stat-card blue"><div class="num" id="stat-members">-</div><div class="label">å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼æ•°</div></div>
      <div class="stat-card amber"><div class="num" id="stat-checkins">-</div><div class="label">ç·ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ•°</div></div>
      <div class="stat-card rose"><div class="num" id="stat-worry">-</div><div class="label">å¿ƒé…å ±å‘Šæ•°</div></div>
      <div class="stat-card purple"><div class="num" id="stat-revenue">Â¥0</div><div class="label">æœˆé–“èª²é‡‘åå…¥</div></div>
    </div>
    <div id="dashboardContent"></div>
  </div>

  <!-- â•â•â• Table Tabs â•â•â• -->
  <div class="tab-content" id="tab-pet_families">
    <div class="topbar"><h2>ğŸ  pet_families</h2><button class="btn btn-outline btn-sm" onclick="loadTable('pet_families')">ğŸ”„ æ›´æ–°</button></div>
    <div id="table-pet_families"></div>
  </div>
  <div class="tab-content" id="tab-family_members">
    <div class="topbar"><h2>ğŸ‘¥ family_members</h2><button class="btn btn-outline btn-sm" onclick="loadTable('family_members')">ğŸ”„ æ›´æ–°</button></div>
    <div id="table-family_members"></div>
  </div>
  <div class="tab-content" id="tab-checkins">
    <div class="topbar"><h2>âœ… checkins</h2><button class="btn btn-outline btn-sm" onclick="loadTable('checkins')">ğŸ”„ æ›´æ–°</button></div>
    <div id="table-checkins"></div>
  </div>
  <div class="tab-content" id="tab-referrals">
    <div class="topbar"><h2>ğŸ referrals</h2><button class="btn btn-outline btn-sm" onclick="loadTable('referrals')">ğŸ”„ æ›´æ–°</button></div>
    <div id="table-referrals"></div>
  </div>

  <!-- â•â•â• æ ãƒ»èª²é‡‘ç®¡ç† â•â•â• -->
  <div class="tab-content" id="tab-quota_mgmt">
    <div class="topbar"><h2>ğŸ« æ ãƒ»èª²é‡‘ç®¡ç†</h2><button class="btn btn-outline btn-sm" onclick="loadQuotaMgmt()">ğŸ”„ æ›´æ–°</button></div>

    <div class="stats-row" style="grid-template-columns:repeat(4,1fr);">
      <div class="stat-card teal"><div class="num" id="q-total-free">-</div><div class="label">åŸºæœ¬æ ï¼ˆå…¨ä½“ï¼‰</div></div>
      <div class="stat-card amber"><div class="num" id="q-total-bonus">-</div><div class="label">æ‹›å¾…ãƒœãƒ¼ãƒŠã‚¹æ </div></div>
      <div class="stat-card purple"><div class="num" id="q-total-paid">-</div><div class="label">èª²é‡‘æ </div></div>
      <div class="stat-card rose"><div class="num" id="q-monthly-revenue">Â¥0</div><div class="label">æœˆé–“åå…¥ï¼ˆæ¨å®šï¼‰</div></div>
    </div>

    <div class="search-bar">
      <input type="text" id="quotaSearch" placeholder="ğŸ” å®¶æ—ã‚³ãƒ¼ãƒ‰ãƒ»ãƒšãƒƒãƒˆåã§æ¤œç´¢..." oninput="filterQuota()">
    </div>
    <div id="quotaList"></div>
  </div>

  <!-- â•â•â• OpenChatä¸€è¦§ç®¡ç† â•â•â• -->
  <div class="tab-content" id="tab-openchat_list">
    <div class="topbar"><h2>ğŸ’¬ OpenChatä¸€è¦§ ï¼† é‹å–¶</h2><button class="btn btn-primary btn-sm" onclick="showOcForm()">ï¼‹ æ–°è¦è¿½åŠ </button><button class="btn btn-outline btn-sm" style="margin-left:8px;" onclick="loadOcList()">ğŸ”„ æ›´æ–°</button></div>

    <!-- é‹å–¶KPI -->
    <div class="stats-row" style="grid-template-columns:repeat(5,1fr);">
      <div class="stat-card teal"><div class="num" id="oc-stat-total">-</div><div class="label">ã‚°ãƒ«ãƒ¼ãƒ—æ•°</div></div>
      <div class="stat-card blue"><div class="num" id="oc-stat-members">-</div><div class="label">åˆè¨ˆãƒ¡ãƒ³ãƒãƒ¼</div></div>
      <div class="stat-card amber"><div class="num" id="oc-stat-reported">-</div><div class="label">ä»Šæ—¥ãƒ¬ãƒãƒ¼ãƒˆæ¸ˆ</div></div>
      <div class="stat-card rose"><div class="num" id="oc-stat-pending">-</div><div class="label">æœªãƒ¬ãƒãƒ¼ãƒˆ</div></div>
      <div class="stat-card" style="background:var(--s50);"><div class="num" id="oc-stat-families">-</div><div class="label">ç´ã¥ã‘å®¶æ—æ•°</div></div>
    </div>

    <!-- æ–°è¦è¿½åŠ /ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="table-wrap" id="ocFormWrap" style="display:none;padding:20px;margin-bottom:16px;">
      <h3 style="font-size:14px;font-weight:700;margin-bottom:16px;" id="ocFormTitle">ğŸ’¬ æ–°è¦OpenChatç™»éŒ²</h3>
      <input type="hidden" id="ocEditId" value="">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ã‚°ãƒ«ãƒ¼ãƒ—å *</label><input type="text" id="ocName" placeholder="ä¾‹: æ¸‹è°·ãƒšãƒƒãƒˆå‹ã®ä¼š" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;"></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">æ‹›å¾…URL</label><input type="text" id="ocUrl" placeholder="https://line.me/ti/openchat/..." style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;font-family:'JetBrains Mono',monospace;"></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">å‚åŠ äººæ•°</label><input type="number" id="ocMembers" placeholder="0" min="0" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;"></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ğŸŒ å›½</label><select id="ocCountry" onchange="onOcCountryChange()" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;background:var(--card);"></select></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">éƒ½é“åºœçœŒ / å·</label><select id="ocArea" onchange="updateOcAreaDetail()" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;background:var(--card);"><option value="">é¸æŠã—ã¦ãã ã•ã„</option></select></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">å¸‚åŒºç”ºæ‘</label><select id="ocAreaDetail" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;background:var(--card);"><option value="">é¸æŠã—ã¦ãã ã•ã„</option></select></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;">
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">å‚™è€ƒ</label><input type="text" id="ocNotes" placeholder="ç®¡ç†è€…ãƒ¡ãƒ¢" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;"></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ç´¹ä»‹æ–‡</label><textarea id="ocDesc" rows="1" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—ã®èª¬æ˜..." style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;resize:vertical;font-family:inherit;"></textarea></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;">
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ğŸ·ï¸ ãƒ•ã‚§ãƒ¼ã‚º</label><select id="ocPhase" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;background:var(--card);"><option value="seed">ğŸŒ± ä½œæˆï¼ˆseedï¼‰</option><option value="nurture">ğŸŒ¿ è‚²æˆï¼ˆnurture: 10-50äººï¼‰</option><option value="selfrun">ğŸŒ³ è‡ªèµ°ï¼ˆselfrun: 50äºº+ï¼‰</option><option value="split">ğŸ”€ åˆ†å‰²æ¤œè¨ï¼ˆsplit: 500äºº+ï¼‰</option><option value="archived">ğŸ“¦ çµ‚äº†ï¼ˆarchivedï¼‰</option></select></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ğŸŒŸ åœ°åŸŸãƒªãƒ¼ãƒ€ãƒ¼å</label><input type="text" id="ocLeader" placeholder="ä¾‹: ãƒ¢ã‚«ã¡ã‚ƒã‚“ã®é£¼ã„ä¸»ã•ã‚“" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;"></div>
      </div>
      <div style="display:flex;gap:8px;margin-top:16px;">
        <button class="btn btn-primary" onclick="saveOcEntry()">ğŸ’¾ ä¿å­˜</button>
        <button class="btn btn-outline" onclick="hideOcForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>

    <div class="search-bar">
      <input type="text" id="ocListSearch" placeholder="ğŸ” åå‰ãƒ»åœ°åŸŸã§æ¤œç´¢..." oninput="filterOcList()">
    </div>
    <div id="ocListContainer"></div>
  </div>

  <!-- â•â•â• å®¶æ— Ã— OpenChatç´ã¥ã‘ â•â•â• -->
  <div class="tab-content" id="tab-openchat_bind">
    <div class="topbar"><h2>ğŸ”— å®¶æ— Ã— OpenChatç´ã¥ã‘</h2><button class="btn btn-amber btn-sm" onclick="autoBind()" style="margin-right:8px;">âš¡ ã‚¨ãƒªã‚¢è‡ªå‹•ç´ã¥ã‘</button><button class="btn btn-outline btn-sm" onclick="loadOcBind()">ğŸ”„ æ›´æ–°</button></div>

    <div class="stats-row" style="grid-template-columns:repeat(3,1fr);">
      <div class="stat-card teal"><div class="num" id="bind-total">-</div><div class="label">ç™»éŒ²å®¶æ—æ•°</div></div>
      <div class="stat-card blue"><div class="num" id="bind-linked">-</div><div class="label">ç´ã¥ã‘æ¸ˆã¿</div></div>
      <div class="stat-card amber"><div class="num" id="bind-unlinked">-</div><div class="label">æœªç´ã¥ã‘</div></div>
    </div>

    <div class="search-bar">
      <input type="text" id="bindSearch" placeholder="ğŸ” å®¶æ—ã‚³ãƒ¼ãƒ‰ãƒ»ãƒšãƒƒãƒˆåã§æ¤œç´¢..." oninput="filterBind()">
      <select id="bindFilter" onchange="filterBind()" style="padding:10px;border:1.5px solid var(--s200);border-radius:10px;font-size:13px;background:var(--card);">
        <option value="all">ã™ã¹ã¦</option>
        <option value="linked">ç´ã¥ã‘æ¸ˆã¿</option>
        <option value="unlinked">æœªç´ã¥ã‘</option>
      </select>
    </div>
    <div id="bindList"></div>
  </div>

  <div class="tab-content" id="tab-today_summary">
    <div class="topbar"><h2>ğŸ“‹ today_summary</h2><button class="btn btn-outline btn-sm" onclick="loadTable('today_summary')">ğŸ”„ æ›´æ–°</button></div>
    <div id="table-today_summary"></div>
  </div>
  <div class="tab-content" id="tab-family_overview">
    <div class="topbar"><h2>ğŸ“ˆ family_overview</h2><button class="btn btn-outline btn-sm" onclick="loadTable('family_overview')">ğŸ”„ æ›´æ–°</button></div>
    <div id="table-family_overview"></div>
  </div>

  <!-- â•â•â• æ—¥æ¬¡é‹å–¶ãƒ‘ãƒãƒ« â•â•â• -->
  <div class="tab-content" id="tab-oc_daily">
    <div class="topbar"><h2>â˜€ï¸ æ—¥æ¬¡é‹å–¶ãƒ‘ãƒãƒ«</h2><button class="btn btn-outline btn-sm" onclick="loadOcDaily()">ğŸ”„ æ›´æ–°</button><button class="btn btn-outline btn-sm" style="margin-left:8px;" onclick="resetDailyChecks()">ğŸ”„ ãƒã‚§ãƒƒã‚¯ãƒªã‚»ãƒƒãƒˆ</button></div>

    <div class="ops-hint">
      <strong>â±ï¸ åˆè¨ˆå·¥æ•°ç›®å®‰ï¼š</strong>1ç¾¤ã‚ãŸã‚Šç´„5åˆ†/æ—¥ + è©±é¡ŒæŠ•ç¨¿10åˆ†/é€±ã€‚æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã¯ 08:30ã€œ08:35 ã§å®Œäº†ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€ŒğŸ“‹ æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã‚¿ãƒ–ã§ç”Ÿæˆãƒ»ã‚³ãƒ”ãƒ¼ã€‚
    </div>

    <!-- KPI -->
    <div class="stats-row" style="grid-template-columns:repeat(4,1fr);">
      <div class="stat-card teal"><div class="num" id="od-groups">-</div><div class="label">ç®¡ç†ä¸­ã‚°ãƒ«ãƒ¼ãƒ—</div></div>
      <div class="stat-card blue"><div class="num" id="od-today-posts">-</div><div class="label">ä»Šæ—¥ã®æŠ•ç¨¿æ•°</div></div>
      <div class="stat-card amber"><div class="num" id="od-pending">-</div><div class="label">æœªãƒ¬ãƒãƒ¼ãƒˆç¾¤</div></div>
      <div class="stat-card rose"><div class="num" id="od-mod">-</div><div class="label">ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div></div>
    </div>

    <!-- æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ -->
    <div class="table-wrap" style="margin-bottom:16px;">
      <div class="table-header"><h3>ğŸŒ… æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ï¼ˆ08:30ã€œï¼‰</h3></div>
      <ul class="ops-checklist" id="dailyMorning">
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">LINE Notifyã§æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å—ä¿¡ç¢ºèª</div><div class="ck-meta"><span class="ck-time">08:30</span><span class="ck-type semi">åŠè‡ªå‹•</span>GASãŒè‡ªå‹•é€ä¿¡ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç¢ºèª</div></div></li>
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">å„åœ°åŸŸOpenChatã«ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒšæŠ•ç¨¿</div><div class="ck-meta"><span class="ck-time">08:31</span><span class="ck-type semi">åŠè‡ªå‹•</span>â†’ã€ŒğŸ“‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã‚¿ãƒ–ã§ç”Ÿæˆ â†’ å„ç¾¤ã«è²¼ä»˜</div></div></li>
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">ãƒ¬ãƒãƒ¼ãƒˆæŠ•ç¨¿ã«ä¸€è¨€è¿½åŠ ï¼ˆæœã®æŒ¨æ‹¶ï¼‰</div><div class="ck-meta"><span class="ck-time">08:32</span><span class="ck-type manual">æ‰‹å‹•</span>å­£ç¯€æ„Ÿã®ã‚ã‚‹è‡ªç„¶ãªä¸€è¨€ã€‚å®šå‹æ–‡ã¯ç¦æ­¢ã€æ¯æ—¥å¤‰ãˆã‚‹</div></div></li>
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">æ–°ãƒ¡ãƒ³ãƒãƒ¼å‚åŠ é€šçŸ¥ã®ç¢ºèªï¼†æ­“è¿</div><div class="ck-meta"><span class="ck-time">08:33</span><span class="ck-type manual">æ‰‹å‹•</span>â†’ã€ŒğŸ“‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã‚¿ãƒ–ã®æ­“è¿ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ä½¿ç”¨</div></div></li>
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">è¡¨å½°é€šçŸ¥ã®ç¢ºèªï¼†æŠ•ç¨¿</div><div class="ck-meta"><span class="ck-time">08:34</span><span class="ck-type semi">åŠè‡ªå‹•</span>é€£ç¶šæ‰“åˆ»é”æˆè€…ãŒã„ã‚Œã°GASã‹ã‚‰é€šçŸ¥ã‚ã‚Š</div></div></li>
      </ul>
    </div>

    <!-- æ—¥ä¸­ï¼†å¤œ -->
    <div class="table-wrap" style="margin-bottom:16px;">
      <div class="table-header"><h3>ğŸŒ¤ï¸ æ—¥ä¸­ã€œå¤œ</h3></div>
      <ul class="ops-checklist" id="dailyDay">
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">åˆå‰ä¸­ã®æŠ•ç¨¿ã«ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¢ºèª</div><div class="ck-meta"><span class="ck-time">12:00é ƒ</span><span class="ck-type manual">æ‰‹å‹•</span>ã‚¹ãƒãƒ›ã§1åˆ†ã€‚åˆæŠ•ç¨¿è€…ã«ã¯å¿…ãšåå¿œ</div></div></li>
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">è©±é¡ŒæŠ•ç¨¿ï¼ˆè©²å½“æ›œæ—¥ã®ã¿ï¼‰</div><div class="ck-meta"><span class="ck-time">åˆå¾Œ</span><span class="ck-type manual">æ‰‹å‹•</span>â†’ã€ŒğŸ“… è©±é¡Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€ã‚¿ãƒ–ã§ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒç¢ºèª</div></div></li>
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">å¤•æ–¹ã€œå¤œã®æŠ•ç¨¿ã«ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¢ºèª</div><div class="ck-meta"><span class="ck-time">20:00é ƒ</span><span class="ck-type manual">æ‰‹å‹•</span>ã€Œç„¡è¦–ã•ã‚ŒãŸæ„Ÿã€ã‚’çµ¶å¯¾ã«ç”Ÿã¾ãªã„</div></div></li>
        <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª</div><div class="ck-meta"><span class="ck-time">éšæ™‚</span><span class="ck-type manual">æ‰‹å‹•</span>NGãƒ¯ãƒ¼ãƒ‰è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ã™ã‚ŠæŠœã‘åˆ†ã‚’ç›®è¦–ç¢ºèª</div></div></li>
      </ul>
    </div>

    <!-- ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <div class="table-wrap">
      <div class="table-header"><h3>ğŸ“Š ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ é‹å–¶ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3></div>
      <div id="ocDailyStatus"><div class="empty"><div class="icon">ğŸ“­</div><p>æ¥ç¶šå¾Œã«ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</p></div></div>
    </div>
  </div>

  <!-- â•â•â• æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ â•â•â• -->
  <div class="tab-content" id="tab-oc_templates">
    <div class="topbar"><h2>ğŸ“‹ æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2></div>

    <div class="ops-hint">
      <strong>ä½¿ã„æ–¹ï¼š</strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã€ŒğŸ“‹ ã‚³ãƒ”ãƒ¼ã€ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ â†’ å¯¾è±¡OpenChatã«è²¼ä»˜ã€‚æŠ•ç¨¿ã—ãŸã‚‰ã€Œâœ… æŠ•ç¨¿æ¸ˆã€ãƒœã‚¿ãƒ³ã§ãƒ­ã‚°ã«è¨˜éŒ²ã€‚<br>
      <strong>ãƒ«ãƒ¼ãƒ«ï¼š</strong>å€‹äººåã§ã¯ãªã<strong>ãƒšãƒƒãƒˆå</strong>ã§å‘¼ã¶ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é…æ…®ï¼‰ã€‚æœã®ä¸€è¨€ã¯æ¯æ—¥å¤‰ãˆã‚‹ï¼ˆå®šå‹æ–‡ç¦æ­¢ï¼‰ã€‚
    </div>

    <!-- æŠ•ç¨¿å…ˆé¸æŠ -->
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:16px;flex-wrap:wrap;">
      <span style="font-size:12px;font-weight:700;color:var(--s500);">æŠ•ç¨¿å…ˆ:</span>
      <select id="tmplTarget" style="padding:8px 14px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;background:var(--card);min-width:200px;" onchange="onTmplTargetChange()">
        <option value="">OpenChatã‚’é¸æŠ...</option>
      </select>
      <button class="btn btn-outline btn-sm" id="tmplOpenLink" style="display:none;" onclick="openTmplTarget()">ğŸ”— LINEã§é–‹ã</button>
    </div>

    <div class="tmpl-grid" id="tmplContainer">
      <!-- JS ã§ç”Ÿæˆ -->
    </div>

    <!-- æŠ•ç¨¿ãƒ­ã‚° -->
    <div class="table-wrap" style="margin-top:20px;">
      <div class="table-header"><h3>ğŸ“ æœ€è¿‘ã®æŠ•ç¨¿ãƒ­ã‚°</h3><button class="btn btn-outline btn-sm" onclick="loadPostLog()">ğŸ”„</button></div>
      <div id="postLogList" style="padding:12px 16px;max-height:300px;overflow-y:auto;"><div style="color:var(--s400);font-size:12px;">æ¥ç¶šå¾Œã«ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</div></div>
    </div>
  </div>

  <!-- â•â•â• è©±é¡Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ â•â•â• -->
  <div class="tab-content" id="tab-oc_calendar">
    <div class="topbar"><h2>ğŸ“… è©±é¡Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2></div>

    <div class="ops-hint">
      æ—¥æ¬¡å…ƒæ°—ãƒ¬ãƒãƒ¼ãƒˆã¯<strong>æ¯æ—¥</strong>é…ä¿¡ã€‚ä»¥ä¸‹ã¯è¿½åŠ ã®è©±é¡ŒæŠ•ç¨¿ã€‚éåº¦ãªæŠ•ç¨¿ã¯é€†åŠ¹æœ â€” <strong>é€±3å›ã®è©±é¡Œ + æ¯æ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆ</strong>ãŒæœ€é©ãƒãƒ©ãƒ³ã‚¹ã€‚
    </div>

    <!-- ä»Šæ—¥ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ -->
    <div class="table-wrap" style="margin-bottom:16px;">
      <div class="table-header"><h3 id="calTodayTitle">ğŸ“Œ ä»Šæ—¥ã®æŠ•ç¨¿ãƒ†ãƒ¼ãƒ</h3></div>
      <div id="calTodayContent" style="padding:16px;font-size:13px;line-height:1.8;">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <!-- é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
    <div class="cal-grid" id="calGrid">
      <!-- JSç”Ÿæˆ -->
    </div>

    <!-- è©±é¡Œã‚¹ãƒˆãƒƒã‚¯ -->
    <div class="table-wrap" style="margin-top:20px;">
      <div class="table-header"><h3>ğŸ¯ è©±é¡Œã‚¹ãƒˆãƒƒã‚¯ï¼ˆãƒã‚¿åˆ‡ã‚Œæ™‚ã«ä½¿ç”¨ï¼‰</h3></div>
      <div style="padding:0;">
        <table style="width:100%;border-collapse:collapse;font-size:12px;">
          <thead><tr><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--s500);">ã‚«ãƒ†ã‚´ãƒª</th><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--s500);">è©±é¡Œä¾‹</th><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--s500);">ã‚³ãƒ”ãƒ¼</th></tr></thead>
          <tbody id="topicStock">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- â•â•â• ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ â•â•â• -->
  <div class="tab-content" id="tab-oc_moderation">
    <div class="topbar"><h2>ğŸ›¡ï¸ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2><button class="btn btn-outline btn-sm" onclick="loadModLog()">ğŸ”„ æ›´æ–°</button></div>

    <div class="ops-hint err">
      <strong>ğŸš¨ å³æ™‚å‰Šé™¤ï¼†é€€å‡ºï¼š</strong>åºƒå‘Šã‚¹ãƒ‘ãƒ  / å€‹äººæ”»æ’ƒ / ãƒšãƒƒãƒˆè™å¾… / å€‹äººæƒ…å ±ã®éœ²å‡º<br>
      <strong>ğŸŸ¡ ãƒãƒ¼ãƒ ç›¸è«‡ï¼š</strong>ã‚°ãƒ¬ãƒ¼ã‚¾ãƒ¼ãƒ³ã¯ã‚¹ã‚¯ã‚·ãƒ§ä¿å­˜â†’ãƒãƒ¼ãƒ ç›¸è«‡ã€‚å˜ç‹¬åˆ¤æ–­ã—ãªã„ã€‚
    </div>

    <!-- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè¨˜éŒ² -->
    <div class="table-wrap" style="margin-bottom:16px;">
      <div class="table-header"><h3>ğŸš¨ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆè¨˜éŒ²</h3></div>
      <div style="padding:16px;">
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
          <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">å¯¾è±¡ã‚°ãƒ«ãƒ¼ãƒ—</label><select id="modOc" style="width:100%;padding:8px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;background:var(--card);"><option value="">é¸æŠ...</option></select></div>
          <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">æ·±åˆ»åº¦</label><select id="modSev" style="width:100%;padding:8px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;background:var(--card);"><option value="red">ğŸ”´ å³æ™‚å¯¾å¿œ</option><option value="yellow">ğŸŸ¡ è¦ç›¸è«‡</option><option value="info">ğŸ”µ æƒ…å ±å…±æœ‰</option></select></div>
          <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ã‚«ãƒ†ã‚´ãƒª</label><select id="modCat" style="width:100%;padding:8px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;background:var(--card);"><option>åºƒå‘Šã‚¹ãƒ‘ãƒ </option><option>å€‹äººæ”»æ’ƒ</option><option>å‹•ç‰©è™å¾…</option><option>å€‹äººæƒ…å ±</option><option>ãƒ¡ãƒ³ãƒãƒ¼é–“ãƒˆãƒ©ãƒ–ãƒ«</option><option>ãã®ä»–</option></select></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;">
          <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">å†…å®¹</label><textarea id="modDesc" rows="2" placeholder="ä½•ãŒèµ·ããŸã‹..." style="width:100%;padding:8px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;resize:vertical;font-family:inherit;"></textarea></div>
          <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">å¯¾å¿œå†…å®¹</label><textarea id="modAction" rows="2" placeholder="å‰Šé™¤/é€€å‡º/æ³¨æ„/ç›¸è«‡ä¸­..." style="width:100%;padding:8px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;resize:vertical;font-family:inherit;"></textarea></div>
        </div>
        <button class="btn btn-primary btn-sm" style="margin-top:12px;" onclick="saveModLog()">ğŸ’¾ è¨˜éŒ²ã™ã‚‹</button>
      </div>
    </div>

    <!-- ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ -->
    <div class="table-wrap" style="margin-bottom:16px;">
      <div class="table-header"><h3>ğŸ“œ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´</h3></div>
      <div id="modLogList" style="padding:12px 16px;max-height:400px;overflow-y:auto;"><div style="color:var(--s400);font-size:12px;">æ¥ç¶šå¾Œã«ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</div></div>
    </div>

    <!-- NGãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ -->
    <div class="table-wrap">
      <div class="table-header"><h3>âš™ï¸ NGãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒªã‚¹ãƒˆï¼ˆOpenChatç®¡ç†ç”»é¢ã§è¨­å®šï¼‰</h3></div>
      <div style="padding:16px;font-size:12px;line-height:2;color:var(--s500);">
        <strong>ã‚¹ãƒ‘ãƒ ç³»ï¼š</strong>å‰¯æ¥­, ç¨¼ã’ã‚‹, åœ¨å®…ãƒ¯ãƒ¼ã‚¯, LINE@, æŠ•è³‡, ä»®æƒ³é€šè²¨, æš—å·è³‡ç”£, FX, ã‚«ã‚¸ãƒ<br>
        <strong>æš´åŠ›ç³»ï¼š</strong>è™å¾…, æš´åŠ›, æ®´ã‚‹, è¹´ã‚‹, æ¨ã¦ã‚‹ <span style="color:var(--s400);">ï¼ˆæ–‡è„ˆä¾å­˜ã®ãŸã‚è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿å¾Œã«ç›®è¦–ç¢ºèªï¼‰</span><br>
        <strong>ãã®ä»–ï¼š</strong>æ­»ã­, æ®ºã™<br>
        <span style="color:var(--amber-d,#B8860B);">âš ï¸ éå‰°ãªãƒ•ã‚£ãƒ«ã‚¿ã¯æ­£å¸¸ãªä¼šè©±ã‚’é˜»å®³ã€‚æœ€å°é™ã«è¨­å®šã—ã€ç›®è¦–è£œå®Œã‚’æ¨å¥¨ã€‚</span>
      </div>
    </div>
  </div>

  <!-- â•â•â• é‹å–¶ãƒãƒ‹ãƒ¥ã‚¢ãƒ« â•â•â• -->
  <div class="tab-content" id="tab-oc_manual">
    <div class="topbar"><h2>ğŸ“– é‹å–¶ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</h2></div>

    <div class="ops-hint">
      å…¨ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±ä¸€ãƒ«ãƒ¼ãƒ«ã¨æ‰‹é †æ›¸ã€‚æ–°ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚„å“è³ªç¢ºèªã«ä½¿ç”¨ã€‚å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹ã€‚
    </div>

    <!-- CMè¡Œå‹•æŒ‡é‡ -->
    <div class="manual-section">
      <div class="manual-header" onclick="toggleManual(this)">ğŸ‘¤ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ è¡Œå‹•æŒ‡é‡<span class="arrow">â–¼</span></div>
      <div class="manual-body"><table>
        <tr><th style="width:110px;">è¡Œå‹•</th><th style="width:60px;">é »åº¦</th><th>ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</th><th style="width:70px;">æ‰€è¦æ™‚é–“</th></tr>
        <tr><td><strong>ğŸŒ… æœã®æŒ¨æ‹¶</strong></td><td>æ¯æ—¥</td><td>ãƒ¬ãƒãƒ¼ãƒˆæŠ•ç¨¿æ™‚ã«ä¸€è¨€è¿½åŠ ã€‚å­£ç¯€æ„Ÿã®ã‚ã‚‹è‡ªç„¶ãªä¸€è¨€ã€‚<strong>å®šå‹æ–‡ã¯ç¦æ­¢</strong>ã€æ¯æ—¥å¤‰ãˆã‚‹</td><td>1åˆ†</td></tr>
        <tr><td><strong>ğŸ’¬ è©±é¡ŒæŠ•ã’ã‹ã‘</strong></td><td>é€±2-3å›</td><td>è³ªå•å½¢å¼ã§æŠ•ç¨¿ã—è¿”ç­”ã‚’å¾…ã¤ã€‚<strong>é€£æŠ•ã—ãªã„</strong></td><td>2åˆ†</td></tr>
        <tr><td><strong>â†©ï¸ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</strong></td><td>éšæ™‚</td><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸã‚‰<strong>å¿…ãš</strong>åå¿œã€‚ç‰¹ã«åˆæŠ•ç¨¿è€…ã€‚ã‚¹ã‚¿ãƒ³ãƒ—ã§ã‚‚OKã€‚<strong>ã€Œç„¡è¦–ã•ã‚ŒãŸæ„Ÿã€ã‚’çµ¶å¯¾ã«ç”Ÿã¾ãªã„</strong></td><td>1åˆ†/ä»¶</td></tr>
        <tr><td><strong>ğŸ†• æ–°ãƒ¡ãƒ³ãƒãƒ¼æ­“è¿</strong></td><td>éšæ™‚</td><td>å‚åŠ é€šçŸ¥ã‚’è¦‹ãŸã‚‰å³æ­“è¿ã€‚<strong>ãƒšãƒƒãƒˆåã§å‘¼ã¶</strong>ï¼ˆå€‹äººåç¦æ­¢ï¼‰</td><td>1åˆ†</td></tr>
        <tr><td><strong>ğŸ›¡ï¸ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</strong></td><td>éšæ™‚</td><td>åºƒå‘Šã‚¹ãƒ‘ãƒ ãƒ»å€‹äººæ”»æ’ƒãƒ»ãƒšãƒƒãƒˆè™å¾…ã¯<strong>å³å‰Šé™¤ï¼†é€€å‡º</strong>ã€‚åˆ¤æ–­è¿·ã„â†’ãƒãƒ¼ãƒ ç›¸è«‡</td><td>éšæ™‚</td></tr>
        <tr><td><strong>ğŸ“¢ ãŠçŸ¥ã‚‰ã›</strong></td><td>æœˆ2-3å›</td><td><strong>é•·æ–‡ç¦æ­¢</strong>ã€‚ç”»åƒ1æš+çŸ­æ–‡ã€‚<strong>é€±æœ«å¤•æ–¹</strong>ãŒé–‹å°ç‡é«˜ã„</td><td>5åˆ†</td></tr>
      </table>
      <div class="ops-hint err" style="margin-top:12px;">
        <strong>ğŸš« ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨ï¼š</strong>å®šå‹æ–‡ã®ç¹°ã‚Šè¿”ã— / é€£æŠ• / å€‹äººåã§ã®å‘¼ã³ã‹ã‘ / æŠ•ç¨¿ã®ç„¡è¦– / å•†æ¥­çš„å£²ã‚Šè¾¼ã¿ / ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å˜ç‹¬åˆ¤æ–­
      </div>
      </div>
    </div>

    <!-- ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ« -->
    <div class="manual-section">
      <div class="manual-header" onclick="toggleManual(this)">ğŸ“œ ã‚°ãƒ«ãƒ¼ãƒ—å…±é€šãƒ«ãƒ¼ãƒ«ï¼ˆå…¨ç¾¤ã«æ²ç¤ºï¼‰<span class="arrow">â–¼</span></div>
      <div class="manual-body">
        <div style="background:#E8F8ED;border:2px solid #06c755;border-radius:12px;padding:20px;max-width:420px;">
          <div id="tmpl-rules" style="font-size:12px;line-height:2.2;white-space:pre-line;">ğŸ¾ PawBon ãƒšãƒƒãƒˆå…ƒæ°—ãƒã‚§ãƒƒã‚¯ ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ«

âœ… ã‚„ã•ã—ã„è¨€è‘‰ã§è©±ã—ã¾ã—ã‚‡ã†
âœ… ãƒšãƒƒãƒˆã®åå‰ã§å‘¼ã³åˆã„ã¾ã—ã‚‡ã†
âœ… å›°ã£ãŸæ™‚ã¯åŠ©ã‘åˆã„ã¾ã—ã‚‡ã†
âœ… å†™çœŸã‚„ãŠæ•£æ­©ã®è©±é¡Œã‚’æ¥½ã—ã¿ã¾ã—ã‚‡ã†

âŒ å€‹äººæƒ…å ±ï¼ˆä½æ‰€ãƒ»é›»è©±ç•ªå·ï¼‰ã®æŠ•ç¨¿
âŒ å•†å“ã®å®£ä¼ãƒ»å‹§èª˜
âŒ ãƒšãƒƒãƒˆã¸ã®æš´åŠ›çš„ãªå†…å®¹
âŒ ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®æ‰¹åˆ¤ãƒ»æ”»æ’ƒ

ğŸ›¡ï¸ ãƒ«ãƒ¼ãƒ«é•åã¯å‰Šé™¤ãƒ»é€€å‡ºå¯¾è±¡ã§ã™
â“ å›°ã£ãŸã“ã¨ãŒã‚ã‚Œã°ç®¡ç†è€…ã«ç›¸è«‡ï¼</div>
        </div>
        <button class="btn btn-primary btn-sm" style="margin-top:12px;" onclick="copyText('tmpl-rules')">ğŸ“‹ ãƒ«ãƒ¼ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>
    </div>

    <!-- ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« -->
    <div class="manual-section">
      <div class="manual-header" onclick="toggleManual(this)">ğŸ˜ï¸ OpenChatã‚°ãƒ«ãƒ¼ãƒ— ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†<span class="arrow">â–¼</span></div>
      <div class="manual-body">
        <div class="lifecycle-bar">
          <div class="lc-node lc-seed"><div class="lc-icon">ğŸŒ±</div><div class="lc-name">ä½œæˆåˆ¤æ–­</div><div class="lc-cond">åœ°åŸŸ10äºº+</div></div>
          <div class="lc-arrow">â†’</div>
          <div class="lc-node lc-seed"><div class="lc-icon">ğŸ“£</div><div class="lc-name">å‘ŠçŸ¥ï¼†èª˜å°</div><div class="lc-cond">ä½œæˆç›´å¾Œ</div></div>
          <div class="lc-arrow">â†’</div>
          <div class="lc-node lc-nurture"><div class="lc-icon">ğŸŒ¿</div><div class="lc-name">è‚²æˆæœŸ</div><div class="lc-cond">10-50äºº</div></div>
          <div class="lc-arrow">â†’</div>
          <div class="lc-node lc-selfrun"><div class="lc-icon">ğŸŒ³</div><div class="lc-name">è‡ªèµ°æœŸ</div><div class="lc-cond">50äºº+</div></div>
          <div class="lc-arrow">â†’</div>
          <div class="lc-node lc-split"><div class="lc-icon">ğŸ”€</div><div class="lc-name">åˆ†å‰²åˆ¤æ–­</div><div class="lc-cond">500äºº+</div></div>
        </div>
        <table style="margin-top:16px;">
        <tr><th>æ®µéš</th><th>ç¾¤æ•°</th><th>æ—¥æ¬¡å·¥æ•°</th><th>é‹å–¶æ–¹é‡</th></tr>
        <tr><td>P1-P3ï¼ˆ2-3æœˆï¼‰</td><td>1ç¾¤</td><td>5åˆ†/æ—¥</td><td>ç®¡ç†è€…1äººã€‚æ‰‹å‹•é‹å–¶ã§å¯†åº¦ã®é«˜ã„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</td></tr>
        <tr><td>P4-P5ï¼ˆ4-6æœˆï¼‰</td><td>5-15ç¾¤</td><td>30-45åˆ†/æ—¥</td><td>ä¸€æ‹¬ãƒ†ãƒ³ãƒ—ãƒ¬â†’é †æ¬¡ã‚³ãƒ”ãƒšã€‚å…¨ç¾¤å…±é€šãƒ†ãƒ¼ãƒã§åŠ¹ç‡åŒ–</td></tr>
        <tr><td>P6ï¼ˆ7-9æœˆï¼‰</td><td>15-30ç¾¤</td><td>60-90åˆ†/æ—¥</td><td>åœ°åŸŸãƒªãƒ¼ãƒ€ãƒ¼ä»»å‘½é–‹å§‹ã€‚ãƒ¬ãƒãƒ¼ãƒˆï¼‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚µãƒãƒ¼ãƒˆã«é›†ä¸­</td></tr>
        <tr><td>P7ï¼ˆ10-12æœˆï¼‰</td><td>30ç¾¤+</td><td>è»½æ¸›</td><td>Appã‚¢ãƒ—ãƒªå†…ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«æ®µéšçš„ç§»è¡Œ</td></tr>
        </table>
      </div>
    </div>

    <!-- GASè‡ªå‹•åŒ– -->
    <div class="manual-section">
      <div class="manual-header" onclick="toggleManual(this)">âš™ï¸ GASè‡ªå‹•åŒ– å®Ÿè£…ä»•æ§˜<span class="arrow">â–¼</span></div>
      <div class="manual-body"><table>
        <tr><th>é–¢æ•°å</th><th style="width:100px;">Trigger</th><th>å‡¦ç†å†…å®¹</th></tr>
        <tr><td><code>generateDailyReport()</code></td><td>æ¯æ—¥ 8:25</td><td>æ‰“åˆ»ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºâ†’åœ°åŸŸåˆ¥é›†è¨ˆâ†’ãƒ†ãƒ³ãƒ—ãƒ¬ç”Ÿæˆâ†’LINE Notify</td></tr>
        <tr><td><code>generateWeeklyReport()</code></td><td>æ¯é€±æœˆ 8:55</td><td>7æ—¥åˆ†ãƒ‡ãƒ¼ã‚¿â†’æ›œæ—¥åˆ¥æ‰“åˆ»ç‡ãƒ»TOP3â†’ãƒ†ãƒ³ãƒ—ãƒ¬ç”Ÿæˆâ†’LINE Notify</td></tr>
        <tr><td><code>checkAchievements()</code></td><td>æ‰“åˆ»æ™‚</td><td>é€£ç¶šæ—¥æ•°ãƒã‚§ãƒƒã‚¯â†’7/30/100/365æ—¥é”æˆâ†’è¡¨å½°ãƒ†ãƒ³ãƒ—ãƒ¬â†’LINE Notify</td></tr>
        <tr><td><code>monitorRegionGrowth()</code></td><td>æ¯é€±æœˆ 9:30</td><td>åœ°åŸŸåˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°â†’10äºº+æœªä½œæˆæ¤œå‡º / 500äºº+åˆ†å‰²å€™è£œâ†’é€šçŸ¥</td></tr>
      </table>
      <div class="ops-hint" style="margin-top:12px;">
        <strong>ğŸ”® è‡ªå‹•åŒ–ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼š</strong>ç¾åœ¨ã¯åŠè‡ªå‹•ï¼ˆGASâ†’LINE Notifyâ†’ã‚³ãƒ”ãƒšï¼‰ã€‚Phase 7ã§ã‚¢ãƒ—ãƒªå†…è‡ªå‹•é…ä¿¡ã€‚2027å¹´ä»¥é™ï¼šOpenChat APIä¸€èˆ¬é–‹æ”¾ã§å®Œå…¨è‡ªå‹•åŒ–ã€‚
      </div>
      </div>
    </div>

    <!-- åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒªãƒ¼ãƒ€ãƒ¼ -->
    <div class="manual-section">
      <div class="manual-header" onclick="toggleManual(this)">ğŸŒŸ åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒªãƒ¼ãƒ€ãƒ¼åˆ¶åº¦ï¼ˆç¾¤æ•°15+ã§å°å…¥ï¼‰<span class="arrow">â–¼</span></div>
      <div class="manual-body">
        <div class="ops-hint">
          <strong>å¯¾è±¡ï¼š</strong>å„ç¾¤ã®æœ€ã‚‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒªãƒ¼ãƒ€ãƒ¼ã€ã‚’æ‰“è¨ºã€‚<br>
          <strong>å½¹å‰²ï¼š</strong>è©±é¡ŒæŠ•ç¨¿ï¼†æ–°ãƒ¡ãƒ³ãƒãƒ¼æ­“è¿ã®ã¿ï¼ˆãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¨©é™ã¯ä»˜ä¸ã—ãªã„ï¼‰<br>
          <strong>ç‰¹å…¸ï¼š</strong>é™å®šãƒãƒƒã‚¸ã€ŒğŸŒŸ åœ°åŸŸãƒªãƒ¼ãƒ€ãƒ¼ã€ï¼‹ PetPhoneå„ªå…ˆä½“é¨“æ¨©<br>
          <strong>ç›®çš„ï¼š</strong>ç®¡ç†è€…ã®è² è·ã‚’åˆ†æ•£ã—ã¤ã¤ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸»å°ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ–‡åŒ–ã‚’é†¸æˆ
        </div>
      </div>
    </div>

    <!-- æ–°è¦OpenChatä½œæˆæ‰‹é † -->
    <div class="manual-section">
      <div class="manual-header" onclick="toggleManual(this)">ğŸ“‹ æ–°è¦OpenChatä½œæˆ æ‰‹é †ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ<span class="arrow">â–¼</span></div>
      <div class="manual-body">
        <ul class="ops-checklist">
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">LINE OpenChatã§æ–°è¦ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ</div><div class="ck-meta">åå‰ï¼šã€ŒPawBon ğŸ¾ [åœ°åŸŸå]ãƒšãƒƒãƒˆå…ƒæ°—ãƒã‚§ãƒƒã‚¯ã€</div></div></li>
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ«ã‚’ãƒ”ãƒ³ç•™ã‚æŠ•ç¨¿</div><div class="ck-meta">ä¸Šã®ã€ŒğŸ“œ ã‚°ãƒ«ãƒ¼ãƒ—å…±é€šãƒ«ãƒ¼ãƒ«ã€ã®ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ã‚³ãƒ”ãƒ¼</div></div></li>
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">NGãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ã‚’è¨­å®š</div><div class="ck-meta">ã€ŒğŸ›¡ï¸ ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¿ãƒ–ã®NGãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆå‚ç…§</div></div></li>
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">ç®¡ç†è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šï¼ˆã‚¢ã‚¤ã‚³ãƒ³: PawBonãƒ­ã‚´ / åå‰: PawBoné‹å–¶ãƒãƒ¼ãƒ ï¼‰</div></div></li>
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">Adminç®¡ç†ç”»é¢ã€ŒğŸ’¬ OpenChatä¸€è¦§ã€ã§æ–°è¦ç™»éŒ² â†’ URLã¨åœ°åŸŸã‚’è¨­å®š</div></div></li>
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">è©²å½“åœ°åŸŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«LINEå…¬å¼ã‹ã‚‰å‚åŠ ãƒªãƒ³ã‚¯ä»˜ãé€šçŸ¥ã‚’é€ä¿¡</div></div></li>
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">GASé…ä¿¡ãƒªã‚¹ãƒˆã«æ–°ç¾¤ã‚’è¿½åŠ </div></div></li>
          <li class="ops-check" onclick="toggleOpsCheck(this)"><div class="ck">âœ“</div><div class="ck-body"><div class="ck-title">åˆå›æ­“è¿æŠ•ç¨¿ã‚’è¡Œã†</div></div></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- â•â•â• SQL â•â•â• -->
  <!-- â•â•â• ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† â•â•â• -->
  <div class="tab-content" id="tab-admin_users">
    <div class="topbar"><h2>ğŸ‘¤ ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2><button class="btn btn-primary btn-sm" onclick="showAddAdminForm()">ï¼‹ æ–°è¦è¿½åŠ </button><button class="btn btn-outline btn-sm" style="margin-left:8px;" onclick="loadAdminUsers()">ğŸ”„ æ›´æ–°</button></div>

    <div class="table-wrap" id="addAdminForm" style="display:none;padding:20px;margin-bottom:16px;">
      <h3 style="font-size:14px;font-weight:700;margin-bottom:16px;">ğŸ‘¤ æ–°è¦ç®¡ç†è€…è¿½åŠ </h3>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:12px;align-items:end;">
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label><input type="email" id="newAdminEmail" placeholder="admin@example.com" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;"></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ *</label><input type="password" id="newAdminPass" placeholder="8æ–‡å­—ä»¥ä¸Š" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;"></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">è¡¨ç¤ºå</label><input type="text" id="newAdminName" placeholder="ç”°ä¸­å¤ªéƒ" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;"></div>
        <div><label style="font-size:11px;font-weight:700;color:var(--s500);display:block;margin-bottom:4px;">ãƒ­ãƒ¼ãƒ«</label><select id="newAdminRole" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-size:13px;background:var(--card);"><option value="viewer">viewerï¼ˆé–²è¦§ã®ã¿ï¼‰</option><option value="admin">adminï¼ˆé–²è¦§ï¼‹ç·¨é›†ï¼‰</option><option value="super_admin">super_adminï¼ˆå…¨æ¨©é™ï¼‰</option></select></div>
      </div>
      <div style="display:flex;gap:8px;margin-top:16px;">
        <button class="btn btn-primary btn-sm" onclick="createAdminUser()">ä½œæˆ</button>
        <button class="btn btn-outline btn-sm" onclick="document.getElementById('addAdminForm').style.display='none'">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>

    <div id="adminUsersList"><div class="empty"><div class="icon">ğŸ‘¤</div><p>ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</p></div></div>
  </div>

  <div class="tab-content" id="tab-sql">
    <div class="topbar"><h2>âš¡ SQL / REST ã‚¯ã‚¨ãƒª</h2></div>
    <div class="table-wrap" style="padding:20px;">
      <p style="color:var(--s500);font-size:12px;margin-bottom:12px;">PostgREST ã‚¯ã‚¨ãƒªå½¢å¼ã§å®Ÿè¡Œã§ãã¾ã™</p>
      <input type="text" id="restQuery" placeholder="/rest/v1/pet_families?limit=10" style="width:100%;padding:10px;border:1.5px solid var(--s200);border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:12px;">
      <button class="btn btn-primary btn-sm" style="margin-top:8px;" onclick="runREST()">â–¶ å®Ÿè¡Œ</button>
      <div id="restResult" style="margin-top:12px;"></div>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â• State â•â•â•
var API_BASE = '';  // api-admin Edge Function URLï¼ˆè‡ªå‹•è¨­å®šï¼‰
var connected = false;
var currentUser = null;  // { email, role, display_name }
var allFamiliesQuota = [];

// â•â•â• Role Hierarchy â•â•â•
var ROLE_LEVEL = { viewer: 1, admin: 2, super_admin: 3 };
function hasPermission(userRole, requiredRole) {
  return (ROLE_LEVEL[userRole] || 0) >= (ROLE_LEVEL[requiredRole] || 99);
}

// â•â•â• Admin Auth â•â•â•
async function adminLogin() {
  var email = document.getElementById('loginEmail').value.trim();
  var pass = document.getElementById('loginPass').value;
  var errEl = document.getElementById('loginError');
  var btn = document.getElementById('loginBtn');
  errEl.style.display = 'none';
  if (!email || !pass) { errEl.textContent = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'; errEl.style.display = 'block'; return; }
  btn.disabled = true; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
  try {
    var res = await fetch(API_BASE + '?action=login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email, password: pass })
    });
    var json = await res.json();
    if (!json.success) {
      errEl.textContent = json.error ? json.error.message : 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ';
      errEl.style.display = 'block';
      btn.disabled = false; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
      return;
    }
    // JWT + ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
    localStorage.setItem('admin_jwt', json.data.token);
    localStorage.setItem('admin_refresh', json.data.refresh_token || '');
    localStorage.setItem('admin_user', JSON.stringify(json.data.user));
    onLoginSuccess(json.data.user);
  } catch(e) {
    errEl.textContent = 'æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + e.message;
    errEl.style.display = 'block';
    btn.disabled = false; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
  }
}

function onLoginSuccess(user) {
  currentUser = user;
  connected = true;
  document.getElementById('loginOverlay').style.display = 'none';
  document.getElementById('connDot').className = 'status-dot on';
  document.getElementById('connLabel').textContent = user.display_name + ' ã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­';
  // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
  document.getElementById('userBar').style.display = 'flex';
  document.getElementById('userDisplayName').textContent = user.display_name || user.email;
  var badge = document.getElementById('userRoleBadge');
  badge.textContent = user.role;
  badge.className = 'role-badge ' + user.role;
  // ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ UI åˆ¶å¾¡
  applyRolePermissions(user.role);
  toast('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ ' + user.role, 'ok');
  refreshAll();
}

function adminLogout() {
  localStorage.removeItem('admin_jwt');
  localStorage.removeItem('admin_refresh');
  localStorage.removeItem('admin_user');
  currentUser = null;
  connected = false;
  location.reload();
}

function applyRolePermissions(role) {
  document.querySelectorAll('[data-min-role]').forEach(function(el) {
    var minRole = el.dataset.minRole;
    el.style.display = hasPermission(role, minRole) ? '' : 'none';
  });
  // viewer: ç·¨é›†ãƒœã‚¿ãƒ³éè¡¨ç¤º
  if (role === 'viewer') {
    document.querySelectorAll('.btn-primary, .btn-danger, .btn-amber').forEach(function(btn) {
      if (btn.id === 'loginBtn') return;
      // æ›´æ–°ãƒœã‚¿ãƒ³ã¯æ®‹ã™
      if (btn.textContent.indexOf('æ›´æ–°') !== -1) return;
      btn.style.display = 'none';
    });
  }
}

// â•â•â• API Communication â•â•â•
function adminFetch(action, params, options) {
  var jwt = localStorage.getItem('admin_jwt') || '';
  var url = API_BASE + '?' + new URLSearchParams(Object.assign({ action: action }, params || {}));
  return fetch(url, Object.assign({
    headers: { 'Authorization': 'Bearer ' + jwt, 'Content-Type': 'application/json' }
  }, options || {}));
}

function adminPost(action, body) {
  var jwt = localStorage.getItem('admin_jwt') || '';
  return fetch(API_BASE + '?action=' + action, {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + jwt, 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });
}

// Legacy wrapper: REST ã‚¯ã‚¨ãƒª â†’ api-admin query çµŒç”±
// query action ã¯ super_admin ã®ã¿ã ãŒã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚’æƒãˆã‚‹
async function supaFetch(path) {
  var res = await adminFetch('query', { path: path });
  var json = await res.json();
  // supaFetch ã®å‘¼ã³å‡ºã—å…ƒã¯ res.json() ã‚’æœŸå¾…ã™ã‚‹ã®ã§ã€
  // query ã® result ã‚’ç›´æ¥è¿”ã™æ¨¡æ“¬ Response ã‚’ç”Ÿæˆ
  var result = (json.success && json.data) ? json.data.result : json;
  return {
    ok: json.success,
    status: (json.success && json.data) ? json.data.status : 400,
    json: function() { return Promise.resolve(result); },
    text: function() { return Promise.resolve(JSON.stringify(result)); },
    headers: { get: function() { return null; } }
  };
}
async function supaPatch(table, query, data) {
  // PATCH â†’ api-admin patch çµŒç”±
  var match = {};
  query.split('&').forEach(function(pair) {
    var parts = pair.split('=eq.');
    if (parts.length === 2) match[parts[0]] = decodeURIComponent(parts[1]);
  });
  var res = await adminPost('patch', { table: table, match: match, data: data });
  var json = await res.json();
  return { ok: json.success, text: function() { return Promise.resolve(json.error?json.error.message:''); } };
}

// â•â•â• Table Config â•â•â•
var TABLE_CONFIG = {
  pet_families: {
    order: 'created_at.desc',
    columns: ['family_code','referral_code','owner_name','pet_names','breeds','pet_count','country','area','area_detail','max_members','bonus_slots','paid_slots','openchat_id','created_at'],
    labels: { family_code:'å®¶æ—ã‚³ãƒ¼ãƒ‰', referral_code:'ç´¹ä»‹ã‚³ãƒ¼ãƒ‰', owner_name:'é£¼ã„ä¸»', pet_names:'ãƒšãƒƒãƒˆå', breeds:'å“ç¨®', pet_count:'é ­æ•°', country:'å›½', area:'éƒ½é“åºœçœŒ', area_detail:'å¸‚åŒºç”ºæ‘', max_members:'åŸºæœ¬æ ', bonus_slots:'æ‹›å¾…æ ', paid_slots:'èª²é‡‘æ ', openchat_id:'OpenChat', created_at:'ç™»éŒ²æ—¥' },
    formatters: {
      created_at: function(v){ return v ? v.substring(0,10) : '-'; },
      family_code: function(v){ return '<strong style="color:var(--rose)">'+v+'</strong>'; },
      referral_code: function(v){ return v ? '<span class="mono" style="color:var(--teal-d)">'+v+'</span>' : '<span style="color:var(--s300)">-</span>'; },
      max_members: function(v){ return '<span style="color:var(--teal-d);font-weight:700">'+(v||2)+'</span>'; },
      bonus_slots: function(v){ return '<span style="color:var(--teal-d);font-weight:700">'+(v||0)+'</span>'; },
      paid_slots: function(v){ return v>0 ? '<span style="color:var(--orange);font-weight:700">'+v+'</span>' : '<span style="color:var(--s300)">0</span>'; },
      openchat_id: function(v){ return v ? '<span class="tag active">ID:'+v+'</span>' : '<span style="color:var(--s300)">-</span>'; }
    }
  },
  family_members: {
    order: 'registered_at.desc',
    columns: ['family_code','member_line_id','display_name','relation','registered_at'],
    labels: { family_code:'å®¶æ—ã‚³ãƒ¼ãƒ‰', member_line_id:'LINE ID', display_name:'è¡¨ç¤ºå', relation:'ç¶šæŸ„', registered_at:'ç™»éŒ²æ—¥' },
    formatters: {
      registered_at: function(v){ return v ? v.substring(0,10) : '-'; },
      member_line_id: function(v){ return '<span class="mono">'+(v?v.substring(0,12)+'...':'-')+'</span>'; }
    }
  },
  checkins: {
    order: 'id.desc',
    limit: 100,
    labels: { id:'ID', checkin_date:'æ—¥ä»˜', check_date:'æ—¥ä»˜', family_code:'å®¶æ—', status:'çŠ¶æ…‹', reporter_line_id:'å ±å‘Šè€…', worried_pets:'å¿ƒé…ãªå­', symptoms:'ç—‡çŠ¶', memo:'ãƒ¡ãƒ¢', created_at:'ä½œæˆæ—¥æ™‚', streak_days:'é€£ç¶šæ—¥æ•°' },
    formatters: {
      status: function(v){ return v ? '<span class="tag '+v+'">'+(v==='genki'?'âœ… å…ƒæ°—':'âš ï¸ å¿ƒé…')+'</span>' : '-'; },
      family_code: function(v){ return v ? '<strong style="color:var(--rose)">'+v+'</strong>' : '-'; },
      reporter_line_id: function(v){ return '<span class="mono">'+(v?v.substring(0,12)+'...':'-')+'</span>'; },
      checkin_date: function(v){ return v ? v.substring(0,10) : '-'; },
      check_date: function(v){ return v ? v.substring(0,10) : '-'; },
      created_at: function(v){ return v ? v.substring(0,16).replace('T',' ') : '-'; }
    },
    hideColumns: ['id']
  },
  referrals: {
    order: 'created_at.desc',
    columns: ['referral_code','owner_family_code','owner_line_id','referred_family_code','referred_line_id','status','created_at'],
    labels: { referral_code:'ç´¹ä»‹ã‚³ãƒ¼ãƒ‰', owner_family_code:'ç´¹ä»‹è€…', owner_line_id:'ç´¹ä»‹è€…LINE', referred_family_code:'è¢«ç´¹ä»‹è€…', referred_line_id:'è¢«ç´¹ä»‹è€…LINE', status:'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', created_at:'æ—¥æ™‚' },
    formatters: {
      referral_code: function(v){ return '<span class="mono" style="color:var(--teal-d);font-weight:700">'+v+'</span>'; },
      owner_family_code: function(v){ return '<strong style="color:var(--rose)">'+(v||'-')+'</strong>'; },
      referred_family_code: function(v){ return '<strong style="color:var(--rose)">'+(v||'-')+'</strong>'; },
      owner_line_id: function(v){ return '<span class="mono">'+(v?v.substring(0,12)+'...':'-')+'</span>'; },
      referred_line_id: function(v){ return '<span class="mono">'+(v?v.substring(0,12)+'...':'-')+'</span>'; },
      status: function(v){ return '<span class="tag active">'+(v||'completed')+'</span>'; },
      created_at: function(v){ return v ? v.substring(0,16).replace('T',' ') : '-'; }
    }
  },
  today_summary: {
    order: 'area',
    columns: ['area','area_detail','checked_count','genki_count','worry_count'],
    labels: { area:'éƒ½é“åºœçœŒ', area_detail:'å¸‚åŒºç”ºæ‘', checked_count:'æ‰“åˆ»æ•°', genki_count:'å…ƒæ°—', worry_count:'å¿ƒé…' },
    formatters: {
      genki_count: function(v){ return '<span style="color:var(--teal-d);font-weight:700">'+v+'</span>'; },
      worry_count: function(v){ return v>0?'<span style="color:var(--rose);font-weight:700">'+v+'</span>':'0'; }
    }
  },
  family_overview: {
    order: 'last_checkin.desc.nullslast',
    columns: ['family_code','pet_names','location','pet_count','member_count','total_days','last_checkin'],
    labels: { family_code:'å®¶æ—', pet_names:'ãƒšãƒƒãƒˆ', location:'åœ°åŸŸ', pet_count:'é ­æ•°', member_count:'ãƒ¡ãƒ³ãƒãƒ¼æ•°', total_days:'æ‰“åˆ»æ—¥æ•°', last_checkin:'æœ€çµ‚æ‰“åˆ»' },
    formatters: {
      family_code: function(v){ return '<strong style="color:var(--rose)">'+v+'</strong>'; },
      last_checkin: function(v){ return v||'<span style="color:var(--s400)">æœªæ‰“åˆ»</span>'; }
    }
  }
};

// â•â•â• Load Table â•â•â•
async function loadTable(name) {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }
  var container = document.getElementById('table-' + name);
  if (!container) return;
  container.innerHTML = '<div class="loading"><span class="spinner"></span>èª­ã¿è¾¼ã¿ä¸­...</div>';
  var cfg = TABLE_CONFIG[name] || {};
  var limit = cfg.limit || 200;
  var orderStr = cfg.order || 'id.desc';
  var orderCol = orderStr.split('.')[0];
  var asc = orderStr.indexOf('.asc') !== -1 ? 'true' : 'false';
  try {
    var res = await adminFetch('table', { name: name, limit: limit, order: orderCol, asc: asc });
    var json = await res.json();
    if (!json.success) {
      container.innerHTML='<div class="empty"><div class="icon">âš ï¸</div><p>ã‚¨ãƒ©ãƒ¼: '+escapeHtml(json.error?json.error.message:'ä¸æ˜')+'</p></div>';
      return;
    }
    var data = json.data.rows;
    var count = json.data.total;
    var badges = { pet_families:'badge-families', family_members:'badge-members', checkins:'badge-checkins' };
    var b = document.getElementById(badges[name]);
    if (b) b.textContent = count;
    if (!Array.isArray(data) || data.length === 0) {
      container.innerHTML='<div class="empty"><div class="icon">ğŸ“­</div><p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
      return;
    }
    var allCols = Object.keys(data[0]);
    var cols = cfg.columns || allCols;
    var hide = cfg.hideColumns || [];
    cols = cols.filter(function(c){ return hide.indexOf(c) === -1; });
    var labels = cfg.labels || {};
    var fmt = cfg.formatters || {};
    var html = '<div class="table-wrap"><div class="table-header"><h3>'+name+' <span class="count">('+data.length+'/'+count+' ä»¶)</span></h3></div><div class="table-scroll"><table><thead><tr>';
    cols.forEach(function(c){ html += '<th>'+(labels[c]||c)+'</th>'; });
    html += '</tr></thead><tbody>';
    data.forEach(function(row){
      html += '<tr>';
      cols.forEach(function(c){
        var val = row[c];
        var display = fmt[c] ? fmt[c](val) : (val===null||val===undefined||val===''?'<span style="color:var(--s300)">-</span>':escapeHtml(String(val)));
        html += '<td>'+display+'</td>';
      });
      html += '</tr>';
    });
    html += '</tbody></table></div></div>';
    container.innerHTML = html;
  } catch(e) { container.innerHTML='<div class="empty"><div class="icon">âŒ</div><p>ã‚¨ãƒ©ãƒ¼: '+e.message+'</p></div>'; }
}

// â•â•â• Refresh All â•â•â•
async function refreshAll() {
  if (!connected) return;
  try {
    var res = await adminFetch('dashboard');
    var json = await res.json();
    if (!json.success) { console.error('dashboard error:', json.error); return; }
    var d = json.data;
    var c = d.counts;
    document.getElementById('stat-families').textContent = c.families;
    document.getElementById('stat-members').textContent = c.members;
    document.getElementById('stat-checkins').textContent = c.checkins;
    document.getElementById('stat-worry').textContent = c.worries;
    document.getElementById('stat-revenue').textContent = 'Â¥' + (d.revenue||0).toLocaleString();
    document.getElementById('badge-families').textContent = c.families;
    document.getElementById('badge-members').textContent = c.members;
    document.getElementById('badge-checkins').textContent = c.checkins;
    document.getElementById('badge-referrals').textContent = c.referrals;
    document.getElementById('badge-openchats').textContent = c.openchats;

    // æœ€è¿‘ã®ç™»éŒ²å®¶æ—
    var data = d.recentFamilies || [];
    var html = '<div class="table-wrap"><div class="table-header"><h3>ğŸ“ˆ æœ€è¿‘ã®ç™»éŒ²å®¶æ—</h3></div>';
    html += '<div class="table-scroll"><table><thead><tr><th>å®¶æ—ã‚³ãƒ¼ãƒ‰</th><th>ãƒšãƒƒãƒˆå</th><th>åœ°åŸŸ</th><th>é ­æ•°</th><th>åŸºæœ¬æ </th><th>æ‹›å¾…æ </th><th>èª²é‡‘æ </th><th>åˆè¨ˆæ </th><th>ç™»éŒ²æ—¥</th></tr></thead><tbody>';
    if (data.length > 0) {
      data.forEach(function(r){
        var base = r.max_members || 2;
        var total = base + (r.bonus_slots||0) + (r.paid_slots||0);
        html += '<tr>';
        html += '<td><strong style="color:var(--rose)">'+r.family_code+'</strong></td>';
        html += '<td>'+escapeHtml(r.pet_names||'')+'</td>';
        html += '<td>'+escapeHtml((r.area||'')+' '+(r.area_detail||''))+'</td>';
        html += '<td>'+(r.pet_count||0)+'</td>';
        html += '<td>'+base+'</td>';
        html += '<td style="color:var(--teal-d);font-weight:700">'+(r.bonus_slots||0)+'</td>';
        html += '<td style="color:var(--orange);font-weight:700">'+(r.paid_slots||0)+'</td>';
        html += '<td><strong>'+total+'</strong></td>';
        html += '<td>'+(r.created_at?r.created_at.substring(0,10):'-')+'</td>';
        html += '</tr>';
      });
    } else { html += '<tr><td colspan="9" style="text-align:center;color:var(--s400);padding:24px;">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>'; }
    html += '</tbody></table></div></div>';
    document.getElementById('dashboardContent').innerHTML = html;
  } catch(e) { console.error('refreshAll error:', e); }

  var activeTab = document.querySelector('.sidebar-item.active');
  if (activeTab) {
    var tab = activeTab.dataset.tab;
    if (tab !== 'dashboard' && tab !== 'sql' && tab !== 'quota_mgmt' && tab !== 'admin_users') loadTable(tab);
    if (tab === 'quota_mgmt') loadQuotaMgmt();
  }
}

// â•â•â• Quota Management â•â•â•
async function loadQuotaMgmt() {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }
  var container = document.getElementById('quotaList');
  container.innerHTML = '<div class="loading"><span class="spinner"></span>èª­ã¿è¾¼ã¿ä¸­...</div>';

  try {
    var [famRes, memRes] = await Promise.all([
      adminFetch('table', { name: 'pet_families', limit: 500, order: 'created_at', asc: 'false' }),
      adminFetch('table', { name: 'family_members', limit: 500, order: 'registered_at', asc: 'false' })
    ]);
    var famJson = await famRes.json();
    var memJson = await memRes.json();
    var families = (famJson.success && famJson.data) ? famJson.data.rows : [];
    var memData = (memJson.success && memJson.data) ? memJson.data.rows : [];
    if (!Array.isArray(families) || families.length === 0) { container.innerHTML='<div class="empty"><div class="icon">ğŸ“­</div><p>ãƒ‡ãƒ¼ã‚¿ãªã—</p></div>'; return; }

    allFamiliesQuota = families;

    var memCounts = {};
    if (Array.isArray(memData)) {
      memData.forEach(function(m) {
        memCounts[m.family_code] = (memCounts[m.family_code]||0) + 1;
      });
    }

    var totalBase = 0, totalBonus = 0, totalPaid = 0;
    families.forEach(function(f){ totalBase += (f.max_members||2); totalBonus += (f.bonus_slots||0); totalPaid += (f.paid_slots||0); });
    document.getElementById('q-total-free').textContent = totalBase;
    document.getElementById('q-total-bonus').textContent = totalBonus;
    document.getElementById('q-total-paid').textContent = totalPaid;
    document.getElementById('q-monthly-revenue').textContent = 'Â¥' + (totalPaid * 100).toLocaleString();

    renderQuotaList(families, memCounts);
  } catch(e) { container.innerHTML='<div class="empty"><div class="icon">âŒ</div><p>'+e.message+'</p></div>'; }
}

function renderQuotaList(families, memCounts) {
  var html = '';
  families.forEach(function(f){
    var code = f.family_code;
    var bonus = f.bonus_slots || 0;
    var paid = f.paid_slots || 0;
    var maxMem = f.max_members || 2;
    var totalSlots = maxMem + bonus + paid;
    var used = (memCounts[code]||0);
    var ownerInMembers = 1;
    var actualOther = Math.max(0, used - ownerInMembers);
    var remaining = totalSlots - actualOther;

    html += '<div class="quota-family-card" data-code="'+escapeHtml(code)+'" data-pets="'+escapeHtml(f.pet_names||'')+'">';
    html += '<div class="quota-family-header">';
    html += '<span class="code">'+escapeHtml(code)+'</span>';
    html += '<span class="pets">ğŸ¾ '+escapeHtml(f.pet_names||'')+'</span>';
    html += '<span class="area">ğŸ“ '+escapeHtml((f.area||'')+' '+(f.area_detail||''))+'</span>';
    html += '</div>';

    html += '<div class="quota-body" style="grid-template-columns:repeat(5,1fr);">';
    html += '<div class="quota-item"><div class="val teal">'+maxMem+'</div><div class="lbl">åŸºæœ¬æ </div></div>';
    html += '<div class="quota-item"><div class="val amber">'+bonus+'</div><div class="lbl">æ‹›å¾…ãƒœãƒ¼ãƒŠã‚¹</div></div>';
    html += '<div class="quota-item"><div class="val purple">'+paid+'</div><div class="lbl">èª²é‡‘æ </div></div>';
    html += '<div class="quota-item"><div class="val" style="color:var(--ink);font-weight:900;">'+totalSlots+'</div><div class="lbl">åˆè¨ˆæ </div></div>';
    html += '<div class="quota-item"><div class="val blue">'+actualOther+' / '+totalSlots+'</div><div class="lbl">ä½¿ç”¨ä¸­</div></div>';
    html += '</div>';

    html += '<div class="quota-actions">';
    html += '<div class="group"><label>åŸºæœ¬æ </label><input type="number" id="max_'+code+'" value="'+maxMem+'" min="1" max="99"></div>';
    html += '<div class="group"><label>æ‹›å¾…æ </label><input type="number" id="bonus_'+code+'" value="'+bonus+'" min="0" max="99"></div>';
    html += '<div class="group"><label>èª²é‡‘æ </label><input type="number" id="paid_'+code+'" value="'+paid+'" min="0" max="99"></div>';
    html += '<button class="btn btn-primary btn-sm" onclick="saveQuota(\''+escapeHtml(code)+'\')">ğŸ’¾ ä¿å­˜</button>';
    html += '<span class="total-quota">åˆè¨ˆ: <strong>'+totalSlots+'æ </strong> / æ®‹ã‚Š: '+(remaining > 0 ? remaining : '<span style="color:var(--rose)">0</span>')+'æ </span>';
    html += '</div>';
    html += '</div>';
  });

  document.getElementById('quotaList').innerHTML = html || '<div class="empty"><div class="icon">ğŸ“­</div><p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
}

async function saveQuota(code) {
  var maxEl = document.getElementById('max_' + code);
  var bonusEl = document.getElementById('bonus_' + code);
  var paidEl = document.getElementById('paid_' + code);
  if (!maxEl || !bonusEl || !paidEl) return;

  var maxMem = parseInt(maxEl.value) || 2;
  var bonus = parseInt(bonusEl.value) || 0;
  var paid = parseInt(paidEl.value) || 0;

  try {
    var res = await supaPatch('pet_families', 'family_code=eq.' + encodeURIComponent(code), {
      max_members: maxMem,
      bonus_slots: bonus,
      paid_slots: paid
    });
    if (res.ok) {
      toast(code + ' ã®æ ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼ˆåŸºæœ¬:'+maxMem+' / æ‹›å¾…:'+bonus+' / èª²é‡‘:'+paid+'ï¼‰','ok');
      loadQuotaMgmt();
    } else {
      var err = await res.text();
      toast('ã‚¨ãƒ©ãƒ¼: '+err, 'err');
    }
  } catch(e) {
    toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err');
  }
}

function filterQuota() {
  var q = document.getElementById('quotaSearch').value.toLowerCase();
  document.querySelectorAll('.quota-family-card').forEach(function(card) {
    var code = (card.getAttribute('data-code')||'').toLowerCase();
    var pets = (card.getAttribute('data-pets')||'').toLowerCase();
    card.style.display = (!q || code.indexOf(q)!==-1 || pets.indexOf(q)!==-1) ? '' : 'none';
  });
}

// â•â•â• OpenChatä¸€è¦§ç®¡ç† â•â•â•
var allOpenchats = [];
var countryAreaMap = {}; // { country: { area: [area_detail, ...] } }

// å†…è”µã‚¨ãƒªã‚¢ãƒ‡ãƒ¼ã‚¿ï¼ˆå…¨ä¸–ç•Œï¼‰
var BUILTIN_AREAS={"æ—¥æœ¬":{"åŒ—æµ·é“":["æœ­å¹Œå¸‚","æ—­å·å¸‚","å‡½é¤¨å¸‚","å¸¯åºƒå¸‚","é‡§è·¯å¸‚","å°æ¨½å¸‚","åŒ—è¦‹å¸‚","è‹«å°ç‰§å¸‚"],"é’æ£®çœŒ":["é’æ£®å¸‚","å…«æˆ¸å¸‚","å¼˜å‰å¸‚"],"å²©æ‰‹çœŒ":["ç››å²¡å¸‚","ä¸€é–¢å¸‚","å¥¥å·å¸‚"],"å®®åŸçœŒ":["ä»™å°å¸‚","çŸ³å·»å¸‚","å¤§å´å¸‚"],"ç§‹ç”°çœŒ":["ç§‹ç”°å¸‚","æ¨ªæ‰‹å¸‚"],"å±±å½¢çœŒ":["å±±å½¢å¸‚","é¶´å²¡å¸‚","é…’ç”°å¸‚"],"ç¦å³¶çœŒ":["ç¦å³¶å¸‚","éƒ¡å±±å¸‚","ã„ã‚ãå¸‚"],"èŒ¨åŸçœŒ":["æ°´æˆ¸å¸‚","ã¤ãã°å¸‚","æ—¥ç«‹å¸‚"],"æ ƒæœ¨çœŒ":["å®‡éƒ½å®®å¸‚","å°å±±å¸‚","è¶³åˆ©å¸‚"],"ç¾¤é¦¬çœŒ":["å‰æ©‹å¸‚","é«˜å´å¸‚","å¤ªç”°å¸‚"],"åŸ¼ç‰çœŒ":["ã•ã„ãŸã¾å¸‚","å·å£å¸‚","æ‰€æ²¢å¸‚","å·è¶Šå¸‚","è¶Šè°·å¸‚","æ˜¥æ—¥éƒ¨å¸‚","è‰åŠ å¸‚","ä¸Šå°¾å¸‚","ç†Šè°·å¸‚"],"åƒè‘‰çœŒ":["åƒè‘‰å¸‚","èˆ¹æ©‹å¸‚","æŸå¸‚","æ¾æˆ¸å¸‚","å¸‚å·å¸‚","æµ¦å®‰å¸‚","ç¿’å¿—é‡å¸‚","æµå±±å¸‚","å…«åƒä»£å¸‚"],"æ±äº¬éƒ½":["åƒä»£ç”°åŒº","ä¸­å¤®åŒº","æ¸¯åŒº","æ–°å®¿åŒº","æ–‡äº¬åŒº","å°æ±åŒº","å¢¨ç”°åŒº","æ±Ÿæ±åŒº","å“å·åŒº","ç›®é»’åŒº","å¤§ç”°åŒº","ä¸–ç”°è°·åŒº","æ¸‹è°·åŒº","ä¸­é‡åŒº","æ‰ä¸¦åŒº","è±Šå³¶åŒº","åŒ—åŒº","è’å·åŒº","æ¿æ©‹åŒº","ç·´é¦¬åŒº","è¶³ç«‹åŒº","è‘›é£¾åŒº","æ±Ÿæˆ¸å·åŒº","å…«ç‹å­å¸‚","ç”ºç”°å¸‚","åºœä¸­å¸‚","èª¿å¸ƒå¸‚","æ­¦è”µé‡å¸‚","ä¸‰é·¹å¸‚","ç«‹å·å¸‚","å›½åˆ†å¯ºå¸‚"],"ç¥å¥ˆå·çœŒ":["æ¨ªæµœå¸‚","å·å´å¸‚","ç›¸æ¨¡åŸå¸‚","è—¤æ²¢å¸‚","æ¨ªé ˆè³€å¸‚","éŒå€‰å¸‚","èŒ…ãƒ¶å´å¸‚","å¹³å¡šå¸‚","åšæœ¨å¸‚","å¤§å’Œå¸‚","å°ç”°åŸå¸‚"],"æ–°æ½ŸçœŒ":["æ–°æ½Ÿå¸‚","é•·å²¡å¸‚","ä¸Šè¶Šå¸‚"],"å¯Œå±±çœŒ":["å¯Œå±±å¸‚","é«˜å²¡å¸‚"],"çŸ³å·çœŒ":["é‡‘æ²¢å¸‚","ç™½å±±å¸‚"],"ç¦äº•çœŒ":["ç¦äº•å¸‚","å‚äº•å¸‚"],"å±±æ¢¨çœŒ":["ç”²åºœå¸‚","å¯Œå£«å‰ç”°å¸‚"],"é•·é‡çœŒ":["é•·é‡å¸‚","æ¾æœ¬å¸‚","ä¸Šç”°å¸‚"],"å²é˜œçœŒ":["å²é˜œå¸‚","å¤§å£å¸‚","å„å‹™åŸå¸‚"],"é™å²¡çœŒ":["é™å²¡å¸‚","æµœæ¾å¸‚","å¯Œå£«å¸‚","æ²¼æ´¥å¸‚"],"æ„›çŸ¥çœŒ":["åå¤å±‹å¸‚","è±Šç”°å¸‚","å²¡å´å¸‚","ä¸€å®®å¸‚","è±Šæ©‹å¸‚","æ˜¥æ—¥äº•å¸‚"],"ä¸‰é‡çœŒ":["æ´¥å¸‚","å››æ—¥å¸‚å¸‚","éˆ´é¹¿å¸‚"],"æ»‹è³€çœŒ":["å¤§æ´¥å¸‚","è‰æ´¥å¸‚","é•·æµœå¸‚"],"äº¬éƒ½åºœ":["äº¬éƒ½å¸‚","å®‡æ²»å¸‚","äº€å²¡å¸‚"],"å¤§é˜ªåºœ":["å¤§é˜ªå¸‚","å ºå¸‚","è±Šä¸­å¸‚","å¹ç”°å¸‚","é«˜æ§»å¸‚","æšæ–¹å¸‚","æ±å¤§é˜ªå¸‚","èŒ¨æœ¨å¸‚","å…«å°¾å¸‚","å¯å±‹å·å¸‚"],"å…µåº«çœŒ":["ç¥æˆ¸å¸‚","å§«è·¯å¸‚","è¥¿å®®å¸‚","å°¼å´å¸‚","æ˜çŸ³å¸‚","åŠ å¤å·å¸‚","å®å¡šå¸‚","ä¼Šä¸¹å¸‚"],"å¥ˆè‰¯çœŒ":["å¥ˆè‰¯å¸‚","æ©¿åŸå¸‚","ç”Ÿé§’å¸‚"],"å’Œæ­Œå±±çœŒ":["å’Œæ­Œå±±å¸‚","ç”°è¾ºå¸‚"],"é³¥å–çœŒ":["é³¥å–å¸‚","ç±³å­å¸‚"],"å³¶æ ¹çœŒ":["æ¾æ±Ÿå¸‚","å‡ºé›²å¸‚"],"å²¡å±±çœŒ":["å²¡å±±å¸‚","å€‰æ•·å¸‚","æ´¥å±±å¸‚"],"åºƒå³¶çœŒ":["åºƒå³¶å¸‚","ç¦å±±å¸‚","å‘‰å¸‚","æ±åºƒå³¶å¸‚"],"å±±å£çœŒ":["ä¸‹é–¢å¸‚","å±±å£å¸‚","å‘¨å—å¸‚"],"å¾³å³¶çœŒ":["å¾³å³¶å¸‚","é˜¿å—å¸‚"],"é¦™å·çœŒ":["é«˜æ¾å¸‚","ä¸¸äº€å¸‚"],"æ„›åª›çœŒ":["æ¾å±±å¸‚","ä»Šæ²»å¸‚","æ–°å±…æµœå¸‚"],"é«˜çŸ¥çœŒ":["é«˜çŸ¥å¸‚","å—å›½å¸‚"],"ç¦å²¡çœŒ":["ç¦å²¡å¸‚","åŒ—ä¹å·å¸‚","ä¹…ç•™ç±³å¸‚","é£¯å¡šå¸‚","æ˜¥æ—¥å¸‚"],"ä½è³€çœŒ":["ä½è³€å¸‚","å”æ´¥å¸‚"],"é•·å´çœŒ":["é•·å´å¸‚","ä½ä¸–ä¿å¸‚"],"ç†Šæœ¬çœŒ":["ç†Šæœ¬å¸‚","å…«ä»£å¸‚"],"å¤§åˆ†çœŒ":["å¤§åˆ†å¸‚","åˆ¥åºœå¸‚"],"å®®å´çœŒ":["å®®å´å¸‚","éƒ½åŸå¸‚"],"é¹¿å…å³¶çœŒ":["é¹¿å…å³¶å¸‚","éœ§å³¶å¸‚"],"æ²–ç¸„çœŒ":["é‚£è¦‡å¸‚","æ²–ç¸„å¸‚","ã†ã‚‹ã¾å¸‚","æµ¦æ·»å¸‚","å®œé‡æ¹¾å¸‚"]},"éŸ“å›½":{"ã‚½ã‚¦ãƒ«ç‰¹åˆ¥å¸‚":["æ±Ÿå—åŒº","æ±Ÿæ±åŒº","æ±Ÿè¥¿åŒº","å† å²³åŒº","åºƒæ´¥åŒº","ä¹è€åŒº","åŸåŒ—åŒº","æ¾å¡åŒº","æ°¸ç™»æµ¦åŒº","éº»æµ¦åŒº"],"é‡œå±±åºƒåŸŸå¸‚":["æµ·é›²å°åŒº","é‡œå±±é®åŒº","æ±è±åŒº","å—åŒº"],"ä»å·åºƒåŸŸå¸‚":["å—æ´åŒº","å¯Œå¹³åŒº","å»¶å¯¿åŒº"],"å¤§é‚±åºƒåŸŸå¸‚":["ä¸­åŒº","æ±åŒº","å¯¿åŸåŒº"],"å¤§ç”°åºƒåŸŸå¸‚":["å„’åŸåŒº","è¥¿åŒº"],"å…‰å·åºƒåŸŸå¸‚":["åŒ—åŒº","è¥¿åŒº"],"è”šå±±åºƒåŸŸå¸‚":["å—åŒº","ä¸­åŒº"],"ä¸–å®—ç‰¹åˆ¥è‡ªæ²»å¸‚":[],"äº¬ç•¿é“":["æ°´åŸå¸‚","åŸå—å¸‚","é«˜é™½å¸‚","é¾ä»å¸‚","å¯Œå·å¸‚","å®‰å±±å¸‚","å®‰é¤Šå¸‚","å—æ¥Šå·å¸‚","è¯åŸå¸‚","å¹³æ²¢å¸‚"],"æ±ŸåŸé“":["æ˜¥å·å¸‚","åŸå·å¸‚","æ±Ÿé™µå¸‚"],"å¿ æ¸…åŒ—é“":["æ¸…å·å¸‚","å¿ å·å¸‚"],"å¿ æ¸…å—é“":["å¤©å®‰å¸‚","ç‰™å±±å¸‚"],"å…¨ç¾…åŒ—é“":["å…¨å·å¸‚","ç¾¤å±±å¸‚","ç›Šå±±å¸‚"],"å…¨ç¾…å—é“":["æœ¨æµ¦å¸‚","éº—æ°´å¸‚","é †å¤©å¸‚"],"æ…¶å°šåŒ—é“":["æµ¦é …å¸‚","æ…¶å·å¸‚","äº€å°¾å¸‚"],"æ…¶å°šå—é“":["æ˜ŒåŸå¸‚","é‡‘æµ·å¸‚","æ™‹å·å¸‚"],"æ¸ˆå·ç‰¹åˆ¥è‡ªæ²»é“":["æ¸ˆå·å¸‚","è¥¿å¸°æµ¦å¸‚"]},"ä¸­å›½":{"åŒ—äº¬å¸‚":["æ±åŸåŒº","è¥¿åŸåŒº","æœé™½åŒº","æµ·æ·€åŒº","è±Šå°åŒº","çŸ³æ™¯å±±åŒº","é€šå·åŒº","é †ç¾©åŒº"],"ä¸Šæµ·å¸‚":["é»„æµ¦åŒº","å¾åŒ¯åŒº","é•·å¯§åŒº","é™å®‰åŒº","æ™®é™€åŒº","æµ¦æ±æ–°åŒº","é–”è¡ŒåŒº","å®å±±åŒº"],"å¤©æ´¥å¸‚":["å’Œå¹³åŒº","æ²³è¥¿åŒº","å—é–‹åŒº","æµœæµ·æ–°åŒº"],"é‡æ…¶å¸‚":["æ¸ä¸­åŒº","æ±ŸåŒ—åŒº","æ²™åªå£©åŒº","å—å²¸åŒº"],"åºƒæ±çœ":["åºƒå·å¸‚","æ·±åœ³å¸‚","ç æµ·å¸‚","æ±èå¸‚","ä»å±±å¸‚","ä¸­å±±å¸‚","æµå·å¸‚","æ±•é ­å¸‚"],"æµ™æ±Ÿçœ":["æ­å·å¸‚","å¯§æ³¢å¸‚","æ¸©å·å¸‚","ç´¹èˆˆå¸‚","å˜‰èˆˆå¸‚","é‡‘è¯å¸‚"],"æ±Ÿè˜‡çœ":["å—äº¬å¸‚","è˜‡å·å¸‚","ç„¡éŒ«å¸‚","å¸¸å·å¸‚","å—é€šå¸‚","å¾å·å¸‚"],"å››å·çœ":["æˆéƒ½å¸‚","ç¶¿é™½å¸‚","æ¥½å±±å¸‚","å®œè³“å¸‚"],"æ¹–åŒ—çœ":["æ­¦æ¼¢å¸‚","å®œæ˜Œå¸‚","è¥„é™½å¸‚"],"æ¹–å—çœ":["é•·æ²™å¸‚","æ ªæ´²å¸‚","å²³é™½å¸‚"],"ç¦å»ºçœ":["ç¦å·å¸‚","å»ˆé–€å¸‚","æ³‰å·å¸‚"],"å±±æ±çœ":["æ¸ˆå—å¸‚","é’å³¶å¸‚","ç…™å°å¸‚","æ¿°åŠå¸‚"],"æ²³å—çœ":["é„­å·å¸‚","æ´›é™½å¸‚","é–‹å°å¸‚"],"æ²³åŒ—çœ":["çŸ³å®¶è˜å¸‚","å”å±±å¸‚","ä¿å®šå¸‚"],"é¼å¯§çœ":["ç€‹é™½å¸‚","å¤§é€£å¸‚","éå±±å¸‚"],"å‰æ—çœ":["é•·æ˜¥å¸‚","å‰æ—å¸‚"],"é»’ç«œæ±Ÿçœ":["ãƒãƒ«ãƒ“ãƒ³å¸‚","å¤§æ…¶å¸‚"],"é™è¥¿çœ":["è¥¿å®‰å¸‚","å’¸é™½å¸‚","å®é¶å¸‚"],"é›²å—çœ":["æ˜†æ˜å¸‚","å¤§ç†å¸‚","éº—æ±Ÿå¸‚"],"æµ·å—çœ":["æµ·å£å¸‚","ä¸‰äºœå¸‚"],"è²´å·çœ":["è²´é™½å¸‚","éµç¾©å¸‚"],"ç”˜ç²›çœ":["è˜­å·å¸‚"],"å±±è¥¿çœ":["å¤ªåŸå¸‚","å¤§åŒå¸‚"],"æ±Ÿè¥¿çœ":["å—æ˜Œå¸‚","ä¹æ±Ÿå¸‚"],"å®‰å¾½çœ":["åˆè‚¥å¸‚","è•ªæ¹–å¸‚"],"åºƒè¥¿ãƒãƒ¯ãƒ³æ—è‡ªæ²»åŒº":["å—å¯§å¸‚","æ¡‚æ—å¸‚"],"å†…ãƒ¢ãƒ³ã‚´ãƒ«è‡ªæ²»åŒº":["ãƒ•ãƒ•ãƒ›ãƒˆå¸‚","åŒ…é ­å¸‚"],"ãƒãƒ™ãƒƒãƒˆè‡ªæ²»åŒº":["ãƒ©ã‚µå¸‚"],"æ–°ç–†ã‚¦ã‚¤ã‚°ãƒ«è‡ªæ²»åŒº":["ã‚¦ãƒ«ãƒ ãƒå¸‚","ã‚«ã‚·ãƒ¥ã‚¬ãƒ«å¸‚"],"å¯§å¤å›æ—è‡ªæ²»åŒº":["éŠ€å·å¸‚"],"é¦™æ¸¯ç‰¹åˆ¥è¡Œæ”¿åŒº":[],"ãƒã‚«ã‚ªç‰¹åˆ¥è¡Œæ”¿åŒº":[],"å°æ¹¾":["å°åŒ—å¸‚","é«˜é›„å¸‚","å°ä¸­å¸‚","å°å—å¸‚","æ–°åŒ—å¸‚","æ¡ƒåœ’å¸‚"]},"ãƒ¢ãƒ³ã‚´ãƒ«":{"ã‚¦ãƒ©ãƒ³ãƒãƒ¼ãƒˆãƒ«":["ãƒãƒ¤ãƒ³ã‚´ãƒ«åŒº","ãƒãƒ³ã‚²ãƒ«ãƒ†ã‚¤åŒº","ã‚¹ãƒ•ãƒãƒ¼ãƒˆãƒ«åŒº"],"ãƒ€ãƒ«ãƒãƒ³ãƒ»ã‚ªãƒ¼ãƒ«çœŒ":["ãƒ€ãƒ«ãƒãƒ³å¸‚"],"ã‚ªãƒ«ãƒ›ãƒ³çœŒ":["ã‚¨ãƒ«ãƒ‡ãƒãƒˆå¸‚"]},"ã‚¿ã‚¤":{"ãƒãƒ³ã‚³ã‚¯éƒ½":["ãƒ¯ã‚¿ãƒŠãƒ¼åŒº","ãƒ‘ãƒˆã‚¥ãƒ ãƒ¯ãƒ³åŒº","ãƒãƒ£ãƒˆã‚¥ãƒãƒ£ãƒƒã‚¯åŒº","ãƒãƒ¼ãƒ³ãƒ©ãƒƒã‚¯åŒº","ãƒ‰ã‚¥ã‚·ãƒƒãƒˆåŒº"],"ãƒã‚§ãƒ³ãƒã‚¤çœŒ":["ãƒ ã‚¢ãƒ³ãƒã‚§ãƒ³ãƒã‚¤"],"ãƒ—ãƒ¼ã‚±ãƒƒãƒˆçœŒ":["ãƒ ã‚¢ãƒ³ãƒ—ãƒ¼ã‚±ãƒƒãƒˆ"],"ãƒãƒ§ãƒ³ãƒ–ãƒªãƒ¼çœŒ":["ãƒ‘ã‚¿ãƒ¤","ã‚·ãƒ©ãƒãƒ£"],"ãƒãƒ³ã‚¿ãƒ–ãƒªãƒ¼çœŒ":[],"ãƒ‘ãƒˆã‚¥ãƒ ã‚¿ãƒ¼ãƒ‹ãƒ¼çœŒ":[],"ã‚µãƒ ãƒƒãƒˆãƒ—ãƒ©ãƒ¼ã‚«ãƒ¼ãƒ³çœŒ":[],"ãƒã‚§ãƒ³ãƒ©ã‚¤çœŒ":["ãƒ ã‚¢ãƒ³ãƒã‚§ãƒ³ãƒ©ã‚¤"],"ã‚³ãƒ³ã‚±ãƒ³çœŒ":[],"ãƒŠã‚³ãƒ³ãƒ©ãƒ¼ãƒãƒ£ã‚·ãƒ¼ãƒãƒ¼çœŒ":[],"ã‚½ãƒ³ã‚¯ãƒ©ãƒ¼çœŒ":["ãƒã‚¸ãƒ£ã‚¤"]},"ãƒ™ãƒˆãƒŠãƒ ":{"ãƒãƒã‚¤å¸‚":["ãƒ›ã‚¢ãƒ³ã‚­ã‚¨ãƒ åŒº","ãƒãƒ¼ãƒ‡ã‚£ãƒ³åŒº","ã‚«ã‚¦ã‚¶ã‚¤åŒº","ã‚¿ã‚¤ãƒ›ãƒ¼åŒº"],"ãƒ›ãƒ¼ãƒãƒŸãƒ³å¸‚":["1åŒº","2åŒº","3åŒº","7åŒº","ãƒ“ãƒ³ã‚¿ãƒ³åŒº","ã‚¿ãƒ³ãƒ“ãƒ³åŒº"],"ãƒ€ãƒŠãƒ³å¸‚":[],"ãƒã‚¤ãƒ•ã‚©ãƒ³å¸‚":[],"ã‚«ãƒ³ãƒˆãƒ¼å¸‚":[],"ãƒ•ã‚¨å¸‚":[],"ãƒ‹ãƒ£ãƒãƒ£ãƒ³å¸‚":[],"ãƒ€ãƒ©ãƒƒãƒˆå¸‚":[]},"ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«":{"Central":["Orchard","Marina Bay","Bugis","Tanjong Pagar"],"North":["Woodlands","Yishun","Ang Mo Kio"],"East":["Tampines","Bedok","Changi"],"West":["Jurong","Clementi","Bukit Batok"],"North-East":["Sengkang","Punggol","Hougang"]},"ãƒãƒ¬ãƒ¼ã‚·ã‚¢":{"ã‚¯ã‚¢ãƒ©ãƒ«ãƒ³ãƒ—ãƒ¼ãƒ«":["ãƒ–ã‚­ãƒ“ãƒ³ã‚¿ãƒ³","ãƒãƒ§ã‚¦ã‚­ãƒƒãƒˆ","ãƒ¢ãƒ³ãƒˆã‚­ã‚¢ãƒ©"],"ã‚»ãƒ©ãƒ³ã‚´ãƒ¼ãƒ«å·":["ãƒšã‚¿ãƒªãƒ³ã‚¸ãƒ£ãƒ¤","ã‚¹ãƒãƒ³ã‚¸ãƒ£ãƒ¤","ã‚·ãƒ£ãƒ¼ã‚¢ãƒ©ãƒ "],"ãƒšãƒŠãƒ³å·":["ã‚¸ãƒ§ãƒ¼ã‚¸ã‚¿ã‚¦ãƒ³"],"ã‚¸ãƒ§ãƒ›ãƒ¼ãƒ«å·":["ã‚¸ãƒ§ãƒ›ãƒ¼ãƒ«ãƒãƒ«"],"ã‚µãƒå·":["ã‚³ã‚¿ã‚­ãƒŠãƒãƒ«"],"ã‚µãƒ©ãƒ¯ã‚¯å·":["ã‚¯ãƒãƒ³"]},"ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢":{"ã‚¸ãƒ£ã‚«ãƒ«ã‚¿é¦–éƒ½ç‰¹åˆ¥å·":["ä¸­å¤®ã‚¸ãƒ£ã‚«ãƒ«ã‚¿","å—ã‚¸ãƒ£ã‚«ãƒ«ã‚¿","æ±ã‚¸ãƒ£ã‚«ãƒ«ã‚¿","è¥¿ã‚¸ãƒ£ã‚«ãƒ«ã‚¿","åŒ—ã‚¸ãƒ£ã‚«ãƒ«ã‚¿"],"ãƒãƒªå·":["ãƒ‡ãƒ³ãƒ‘ã‚µãƒ¼ãƒ«","ã‚¦ãƒ–ãƒ‰","ã‚¯ã‚¿"],"è¥¿ã‚¸ãƒ£ãƒ¯å·":["ãƒãƒ³ãƒ‰ãƒ³","ãƒœã‚´ãƒ¼ãƒ«","ãƒ–ã‚«ã‚·"],"æ±ã‚¸ãƒ£ãƒ¯å·":["ã‚¹ãƒ©ãƒãƒ¤","ãƒãƒ©ãƒ³"],"ä¸­éƒ¨ã‚¸ãƒ£ãƒ¯å·":["ã‚¹ãƒãƒ©ãƒ³","ã‚¸ãƒ§ã‚°ã‚¸ãƒ£ã‚«ãƒ«ã‚¿"],"åŒ—ã‚¹ãƒãƒˆãƒ©å·":["ãƒ¡ãƒ€ãƒ³"],"å—ã‚¹ãƒ©ã‚¦ã‚§ã‚·å·":["ãƒã‚«ãƒƒã‚µãƒ«"]},"ãƒ•ã‚£ãƒªãƒ”ãƒ³":{"ãƒãƒ‹ãƒ©é¦–éƒ½åœ":["ãƒã‚«ãƒ†ã‚£","ãƒãƒ‹ãƒ©","ã‚±ã‚½ãƒ³","ã‚¿ã‚®ãƒƒã‚°","ãƒ‘ã‚µã‚¤","ãƒ‘ã‚·ãƒƒã‚°"],"ã‚»ãƒ–å·":["ã‚»ãƒ–å¸‚","ãƒãƒ³ãƒ€ã‚¦ã‚¨","ãƒ©ãƒ—ãƒ©ãƒ—"],"ãƒ€ãƒã‚ªåœ°æ–¹":["ãƒ€ãƒã‚ªå¸‚"],"ãƒ‘ãƒ³ãƒ‘ãƒ³ã‚¬å·":["ã‚¢ãƒ³ãƒ˜ãƒ¬ã‚¹","ã‚µãƒ³ãƒ•ã‚§ãƒ«ãƒŠãƒ³ãƒ‰"],"ãƒã‚¿ãƒ³ã‚¬ã‚¹å·":[],"ãƒ©ã‚°ãƒŠå·":[]},"ãƒŸãƒ£ãƒ³ãƒãƒ¼":{"ãƒ¤ãƒ³ã‚´ãƒ³ç®¡åŒº":["ãƒ¤ãƒ³ã‚´ãƒ³å¸‚"],"ãƒãƒ³ãƒ€ãƒ¬ãƒ¼ç®¡åŒº":["ãƒãƒ³ãƒ€ãƒ¬ãƒ¼å¸‚"],"ãƒãƒ¼ãƒ”ãƒ¼ãƒ‰ãƒ¼é€£é‚¦ç›´è½„åœ°åŸŸ":[]},"ã‚«ãƒ³ãƒœã‚¸ã‚¢":{"ãƒ—ãƒãƒ³ãƒšãƒ³":[],"ã‚·ã‚§ãƒ ãƒªã‚¢ãƒƒãƒ—å·":["ã‚·ã‚§ãƒ ãƒªã‚¢ãƒƒãƒ—"],"ã‚·ãƒãƒŒãƒ¼ã‚¯ãƒ“ãƒ«":[]},"ãƒ©ã‚ªã‚¹":{"ãƒ“ã‚¨ãƒ³ãƒãƒ£ãƒ³éƒ½":["ãƒ“ã‚¨ãƒ³ãƒãƒ£ãƒ³"],"ãƒ«ã‚¢ãƒ³ãƒ‘ãƒãƒ¼ãƒ³çœŒ":["ãƒ«ã‚¢ãƒ³ãƒ‘ãƒãƒ¼ãƒ³"]},"ã‚¤ãƒ³ãƒ‰":{"ãƒ‡ãƒªãƒ¼é¦–éƒ½åœ":["ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒªãƒ¼","ã‚µã‚¦ã‚¹ãƒ‡ãƒªãƒ¼","ãƒãƒ¼ã‚¹ãƒ‡ãƒªãƒ¼"],"ãƒãƒãƒ¼ãƒ©ãƒ¼ã‚·ãƒ¥ãƒˆãƒ©å·":["ãƒ ãƒ³ãƒã‚¤","ãƒ—ãƒãƒ¼","ãƒŠãƒ¼ã‚°ãƒ—ãƒ«","ãƒŠãƒ¼ã‚·ã‚¯"],"ã‚«ãƒ«ãƒŠãƒ¼ã‚¿ã‚«å·":["ãƒãƒ³ã‚¬ãƒ­ãƒ¼ãƒ«","ãƒã‚¤ã‚½ãƒ¼ãƒ«"],"ã‚¿ãƒŸãƒ«ãƒ»ãƒŠãƒ¼ãƒ‰ã‚¥å·":["ãƒã‚§ãƒ³ãƒŠã‚¤","ã‚³ã‚¤ãƒ³ãƒãƒˆãƒ¼ãƒ«"],"ãƒ†ãƒ©ãƒ³ã‚¬ãƒ¼ãƒŠå·":["ãƒã‚¤ãƒ‡ãƒ©ãƒãƒ¼ãƒ‰"],"ã‚±ãƒ¼ãƒ©ãƒ©å·":["ã‚³ãƒ¼ãƒ","ãƒˆãƒªãƒãƒ³ãƒ‰ãƒ©ãƒ "],"ã‚¦ãƒƒã‚¿ãƒ«ãƒ»ãƒ—ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ¥å·":["ãƒ©ã‚¯ãƒŠã‚¦","ã‚«ãƒ¼ãƒ³ãƒ—ãƒ«","ã‚¢ãƒ¼ã‚°ãƒ©ãƒ¼","ãƒãƒ©ãƒŠã‚·"],"è¥¿ãƒ™ãƒ³ã‚¬ãƒ«å·":["ã‚³ãƒ«ã‚«ã‚¿","ãƒ€ãƒ¼ã‚¸ãƒªãƒ³"],"ã‚°ã‚¸ãƒ£ãƒ©ãƒ¼ãƒˆå·":["ã‚¢ãƒ¼ãƒ¡ãƒ€ãƒãƒ¼ãƒ‰","ã‚¹ãƒ¼ãƒ©ãƒˆ","ãƒãƒ‰ãƒ¼ãƒ€ãƒ©ãƒ¼"],"ãƒ©ãƒ¼ã‚¸ãƒ£ã‚¹ã‚¿ãƒ¼ãƒ³å·":["ã‚¸ãƒ£ã‚¤ãƒ—ãƒ«","ã‚¸ãƒ§ãƒ¼ãƒ‰ãƒ—ãƒ«","ã‚¦ãƒ€ã‚¤ãƒ—ãƒ«"],"ãƒ‘ãƒ³ã‚¸ãƒ£ãƒ¼ãƒ–å·":["ãƒãƒ£ãƒ³ãƒ‡ã‚£ãƒ¼ã‚¬ãƒ«","ã‚¢ãƒ ãƒªãƒˆã‚µãƒ«"],"ã‚´ã‚¢å·":["ãƒ‘ãƒŠã‚¸"]},"ã‚¹ãƒªãƒ©ãƒ³ã‚«":{"è¥¿éƒ¨å·":["ã‚³ãƒ­ãƒ³ãƒœ","ãƒ‡ãƒ’ãƒ¯ãƒ©"],"ä¸­éƒ¨å·":["ã‚­ãƒ£ãƒ³ãƒ‡ã‚£"],"å—éƒ¨å·":["ã‚´ãƒ¼ãƒ«"]},"ãƒãƒ‘ãƒ¼ãƒ«":{"ãƒã‚°ãƒãƒ†ã‚£å·":["ã‚«ãƒˆãƒãƒ³ã‚º","ãƒ‘ã‚¿ãƒ³","ãƒã‚¯ã‚¿ãƒ—ãƒ«"],"ã‚¬ãƒ³ãƒ€ã‚­å·":["ãƒã‚«ãƒ©"]},"ãƒãƒ³ã‚°ãƒ©ãƒ‡ã‚·ãƒ¥":{"ãƒ€ãƒƒã‚«ç®¡åŒº":["ãƒ€ãƒƒã‚«å¸‚"],"ãƒãƒƒã‚¿ã‚´ãƒ³ç®¡åŒº":["ãƒãƒƒã‚¿ã‚´ãƒ³å¸‚"]},"ãƒ‘ã‚­ã‚¹ã‚¿ãƒ³":{"ãƒ‘ãƒ³ã‚¸ãƒ£ãƒ¼ãƒ–å·":["ãƒ©ãƒ›ãƒ¼ãƒ«","ãƒ•ã‚¡ã‚¤ã‚µãƒ©ãƒ¼ãƒãƒ¼ãƒ‰"],"ã‚·ãƒ³ãƒ‰å·":["ã‚«ãƒ©ãƒ","ãƒã‚¤ãƒ‡ãƒ©ãƒãƒ¼ãƒ‰"],"ã‚¤ã‚¹ãƒ©ãƒãƒãƒ¼ãƒ‰é¦–éƒ½åœ":["ã‚¤ã‚¹ãƒ©ãƒãƒãƒ¼ãƒ‰"],"ã‚«ã‚¤ãƒãƒ«ãƒ»ãƒ‘ã‚¯ãƒˆã‚¥ãƒ³ã‚¯ãƒ¯å·":["ãƒšã‚·ãƒ£ãƒ¼ãƒ¯ãƒ«"]},"ã‚¢ãƒ©ãƒ–é¦–é•·å›½é€£é‚¦":{"ãƒ‰ãƒã‚¤":["ãƒ€ã‚¦ãƒ³ã‚¿ã‚¦ãƒ³","ãƒãƒªãƒ¼ãƒŠ","ã‚¸ãƒ¥ãƒ¡ã‚¤ãƒ©","ãƒ‡ã‚¤ãƒ©","ãƒãƒ¼ãƒ«ãƒ»ãƒ‰ãƒã‚¤"],"ã‚¢ãƒ–ãƒ€ãƒ“":["ã‚¢ãƒ«ãƒªãƒ¼ãƒ å³¶","ã‚µãƒ‡ã‚£ãƒ¤ãƒƒãƒˆå³¶","ãƒ¤ã‚¹å³¶"],"ã‚·ãƒ£ãƒ«ã‚¸ãƒ£":[],"ã‚¢ã‚¸ãƒ¥ãƒãƒ¼ãƒ³":[],"ãƒ©ã‚¹ã‚¢ãƒ«ãƒã‚¤ãƒ":[]},"ã‚µã‚¦ã‚¸ã‚¢ãƒ©ãƒ“ã‚¢":{"ãƒªãƒ¤ãƒ‰å·":["ãƒªãƒ¤ãƒ‰"],"ãƒãƒƒã‚«å·":["ã‚¸ã‚§ãƒƒãƒ€","ãƒ¡ãƒƒã‚«"],"æ±éƒ¨å·":["ãƒ€ãƒ³ãƒãƒ¼ãƒ ","ã‚¢ãƒ«ãƒ›ãƒãƒ«"],"ãƒãƒ‡ã‚£ãƒ¼ãƒŠå·":["ãƒ¡ãƒ‡ã‚£ãƒŠ"]},"ãƒˆãƒ«ã‚³":{"ã‚¤ã‚¹ã‚¿ãƒ³ãƒ–ãƒ¼ãƒ«çœŒ":["ãƒ™ã‚·ã‚¯ã‚¿ã‚·ãƒ¥","ã‚«ãƒ‰ã‚¥ã‚­ãƒ§ã‚¤","ãƒ™ã‚¤ã‚ªãƒ¼ãƒ«","ãƒ•ã‚¡ãƒ¼ãƒ†ã‚£ãƒ•","ã‚¦ã‚¹ã‚­ãƒ¥ãƒ€ãƒ«","ã‚·ã‚·ãƒ¥ãƒª"],"ã‚¢ãƒ³ã‚«ãƒ©çœŒ":["ãƒãƒ£ãƒ³ã‚«ãƒ¤","ã‚±ãƒã‚ªãƒ¬ãƒ³"],"ã‚¤ã‚ºãƒŸãƒ«çœŒ":["ã‚³ãƒŠãƒƒã‚¯","ãƒ–ã‚¸ãƒ£","ã‚«ãƒ«ã‚·ãƒ¤ã‚«"],"ã‚¢ãƒ³ã‚¿ãƒ«ãƒ¤çœŒ":["ãƒ ãƒ©ãƒˆãƒ‘ã‚·ãƒ£","ã‚±ãƒ¡ãƒ«"],"ãƒ–ãƒ«ã‚µçœŒ":[]},"ã‚¤ã‚¹ãƒ©ã‚¨ãƒ«":{"ãƒ†ãƒ«ã‚¢ãƒ“ãƒ–åœ°åŒº":["ãƒ†ãƒ«ã‚¢ãƒ“ãƒ–","ãƒ©ãƒãƒˆã‚¬ãƒ³","ãƒ˜ãƒ«ãƒ„ãƒªãƒ¤"],"ã‚¨ãƒ«ã‚µãƒ¬ãƒ åœ°åŒº":["ã‚¨ãƒ«ã‚µãƒ¬ãƒ "],"ãƒã‚¤ãƒ•ã‚¡åœ°åŒº":["ãƒã‚¤ãƒ•ã‚¡"],"ä¸­å¤®åœ°åŒº":["ãƒšã‚¿ãƒ•ãƒ†ã‚£ã‚¯ãƒ´ã‚¡","ãƒªã‚·ãƒ§ãƒ³ãƒ»ãƒ¬ã‚¸ã‚ªãƒ³"]},"ã‚«ã‚¿ãƒ¼ãƒ«":{"ãƒ‰ãƒ¼ãƒ":["ã‚¦ã‚§ã‚¹ãƒˆãƒ™ã‚¤","ã‚¶ãƒ»ãƒ‘ãƒ¼ãƒ«","ã‚¢ãƒ«ãƒ»ã‚µãƒƒãƒ‰"],"ã‚¢ãƒ«ãƒ»ãƒ¯ã‚¯ãƒ©":[]},"ã‚¯ã‚¦ã‚§ãƒ¼ãƒˆ":{"ã‚¯ã‚¦ã‚§ãƒ¼ãƒˆå¸‚":[],"ãƒãƒ¯ãƒªçœŒ":[],"ãƒ•ã‚¡ãƒ«ãƒ¯ãƒ¼ãƒ‹ãƒ¼ãƒ¤çœŒ":[]},"ãƒãƒ¼ãƒ¬ãƒ¼ãƒ³":{"ãƒãƒŠãƒ¼ãƒ":[],"ãƒ ãƒãƒƒãƒ©ã‚¯":[]},"ã‚ªãƒãƒ¼ãƒ³":{"ãƒã‚¹ã‚«ãƒƒãƒˆ":[],"ã‚µãƒ©ãƒ¼ãƒ©":[]},"ãƒ¨ãƒ«ãƒ€ãƒ³":{"ã‚¢ãƒ³ãƒãƒ³çœŒ":["ã‚¢ãƒ³ãƒãƒ³"],"ã‚¤ãƒ«ãƒ“ãƒ‰çœŒ":[],"ã‚¢ã‚«ãƒçœŒ":[]},"ãƒ¬ãƒãƒãƒ³":{"ãƒ™ã‚¤ãƒ«ãƒ¼ãƒˆ":[],"ãƒˆãƒªãƒãƒª":[]},"ã‚¤ãƒ©ã‚¯":{"ãƒã‚°ãƒ€ãƒ¼ãƒ‰çœŒ":["ãƒã‚°ãƒ€ãƒ¼ãƒ‰"],"ã‚¢ãƒ«ãƒ“ãƒ¼ãƒ«çœŒ":["ã‚¢ãƒ«ãƒ“ãƒ¼ãƒ«"]},"ã‚¤ãƒ©ãƒ³":{"ãƒ†ãƒ˜ãƒ©ãƒ³å·":["ãƒ†ãƒ˜ãƒ©ãƒ³"],"ã‚¤ã‚¹ãƒ•ã‚¡ãƒãƒ¼ãƒ³å·":["ã‚¤ã‚¹ãƒ•ã‚¡ãƒãƒ¼ãƒ³"],"ãƒ•ã‚¡ãƒ¼ãƒ«ã‚¹å·":["ã‚·ãƒ¼ãƒ©ãƒ¼ã‚º"]},"ã‚¤ã‚®ãƒªã‚¹":{"England":["London","Manchester","Birmingham","Liverpool","Leeds","Bristol","Sheffield","Newcastle","Nottingham","Brighton","Oxford","Cambridge","Bath","York","Canterbury"],"Scotland":["Edinburgh","Glasgow","Aberdeen","Dundee","Inverness"],"Wales":["Cardiff","Swansea","Newport"],"Northern Ireland":["Belfast","Londonderry"]},"ãƒ•ãƒ©ãƒ³ã‚¹":{"ã‚¤ãƒ«ãƒ»ãƒ‰ãƒ»ãƒ•ãƒ©ãƒ³ã‚¹":["Paris","Boulogne-Billancourt","Saint-Denis","Versailles","Nanterre"],"ãƒ—ãƒ­ãƒ´ã‚¡ãƒ³ã‚¹ï¼ã‚¢ãƒ«ãƒ—ï¼ã‚³ãƒ¼ãƒˆãƒ€ã‚¸ãƒ¥ãƒ¼ãƒ«":["Marseille","Nice","Aix-en-Provence","Cannes","Toulon"],"ã‚ªãƒ¼ãƒ´ã‚§ãƒ«ãƒ‹ãƒ¥ï¼ãƒ­ãƒ¼ãƒŒï¼ã‚¢ãƒ«ãƒ—":["Lyon","Grenoble","Saint-Ã‰tienne","Clermont-Ferrand","Annecy"],"ãƒŒãƒ¼ãƒ´ã‚§ãƒ«ï¼ã‚¢ã‚­ãƒ†ãƒ¼ãƒŒ":["Bordeaux","Limoges","Poitiers"],"ã‚ªã‚¯ã‚·ã‚¿ãƒ‹ãƒ¼":["Toulouse","Montpellier","NÃ®mes"],"ãƒ–ãƒ«ã‚¿ãƒ¼ãƒ‹ãƒ¥":["Rennes","Brest","Saint-Malo"],"ãƒãƒ«ãƒãƒ³ãƒ‡ã‚£ãƒ¼":["Rouen","Caen","Le Havre"],"ã‚°ãƒ©ãƒ³ãƒ»ãƒ†ã‚¹ãƒˆ":["Strasbourg","Metz","Nancy","Reims"],"ãƒšã‚¤ãƒ»ãƒ‰ãƒ»ãƒ©ãƒ»ãƒ­ãƒ¯ãƒ¼ãƒ«":["Nantes","Angers","Le Mans"],"ã‚ªãƒ¼ãƒ»ãƒ‰ãƒ»ãƒ•ãƒ©ãƒ³ã‚¹":["Lille","Amiens"]},"ãƒ‰ã‚¤ãƒ„":{"ãƒ™ãƒ«ãƒªãƒ³":["ãƒŸãƒƒãƒ†","ã‚·ãƒ£ãƒ«ãƒ­ãƒƒãƒ†ãƒ³ãƒ–ãƒ«ã‚¯","ã‚¯ãƒ­ã‚¤ãƒ„ãƒ™ãƒ«ã‚¯","ãƒ—ãƒ¬ãƒ³ãƒ„ãƒ©ã‚¦ã‚¢ãƒ¼ãƒ™ãƒ«ã‚¯","ãƒã‚¤ã‚±ãƒ«ãƒ³","ãƒ•ãƒªãƒ¼ãƒ‰ãƒªãƒ’ã‚¹ãƒã‚¤ãƒ³"],"ãƒã‚¤ã‚¨ãƒ«ãƒ³å·":["MÃ¼nchen","NÃ¼rnberg","Augsburg","Regensburg","WÃ¼rzburg"],"ãƒãƒ¼ãƒ‡ãƒ³ï¼ãƒ´ãƒ¥ãƒ«ãƒ†ãƒ³ãƒ™ãƒ«ã‚¯å·":["Stuttgart","Karlsruhe","Mannheim","Freiburg","Heidelberg"],"ãƒãƒ«ãƒˆãƒ©ã‚¤ãƒ³ï¼ãƒ´ã‚§ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ãƒ¬ãƒ³å·":["KÃ¶ln","DÃ¼sseldorf","Dortmund","Essen","Bonn"],"ãƒ˜ãƒƒã‚»ãƒ³å·":["Frankfurt am Main","Wiesbaden","Kassel","Darmstadt"],"ãƒ‹ãƒ¼ãƒ€ãƒ¼ã‚¶ã‚¯ã‚»ãƒ³å·":["Hannover","Braunschweig","GÃ¶ttingen","OsnabrÃ¼ck"],"ã‚¶ã‚¯ã‚»ãƒ³å·":["Dresden","Leipzig","Chemnitz"],"ãƒãƒ³ãƒ–ãƒ«ã‚¯":["Altona","EimsbÃ¼ttel","Wandsbek"],"ãƒ–ãƒ¬ãƒ¼ãƒ¡ãƒ³":[],"ãƒ–ãƒ©ãƒ³ãƒ‡ãƒ³ãƒ–ãƒ«ã‚¯å·":["Potsdam"],"ãƒ†ãƒ¥ãƒ¼ãƒªãƒ³ã‚²ãƒ³å·":["Erfurt","Jena","Weimar"],"ã‚·ãƒ¥ãƒ¬ãƒ¼ã‚¹ãƒ´ã‚£ãƒ’ï¼ãƒ›ãƒ«ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³å·":["Kiel","LÃ¼beck"]},"ã‚¤ã‚¿ãƒªã‚¢":{"ãƒ©ãƒ„ã‚£ã‚ªå·":["Roma","Latina"],"ãƒ­ãƒ³ãƒãƒ«ãƒ‡ã‚£ã‚¢å·":["Milano","Bergamo","Brescia","Como"],"ã‚«ãƒ³ãƒ‘ãƒ¼ãƒ‹ã‚¢å·":["Napoli","Salerno"],"ãƒ´ã‚§ãƒãƒˆå·":["Venezia","Verona","Padova"],"ãƒˆã‚¹ã‚«ãƒ¼ãƒŠå·":["Firenze","Pisa","Siena","Lucca"],"ãƒ”ã‚¨ãƒ¢ãƒ³ãƒ†å·":["Torino","Novara"],"ã‚¨ãƒŸãƒªã‚¢ï¼ãƒ­ãƒãƒ¼ãƒ‹ãƒ£å·":["Bologna","Parma","Modena"],"ã‚·ãƒãƒªã‚¢å·":["Palermo","Catania"],"ã‚µãƒ«ãƒ‡ãƒ¼ãƒ‹ãƒ£å·":["Cagliari","Sassari"],"ãƒ—ãƒ¼ãƒªã‚¢å·":["Bari","Lecce"],"ãƒªã‚°ãƒ¼ãƒªã‚¢å·":["Genova","Cinque Terre"]},"ã‚¹ãƒšã‚¤ãƒ³":{"ãƒãƒ‰ãƒªãƒ¼ãƒ‰å·":["Madrid","AlcalÃ¡ de Henares","Getafe"],"ã‚«ã‚¿ãƒ«ãƒ¼ãƒ‹ãƒ£å·":["Barcelona","Girona","Tarragona"],"ã‚¢ãƒ³ãƒ€ãƒ«ã‚·ã‚¢å·":["Sevilla","MÃ¡laga","Granada","CÃ³rdoba"],"ãƒãƒ¬ãƒ³ã‚·ã‚¢å·":["Valencia","Alicante"],"ãƒã‚¹ã‚¯å·":["Bilbao","San SebastiÃ¡n","Vitoria"],"ã‚¬ãƒªã‚·ã‚¢å·":["Santiago de Compostela","Vigo","A CoruÃ±a"],"ã‚«ãƒŠãƒªã‚¢è«¸å³¶":["Las Palmas","Santa Cruz de Tenerife"],"ãƒãƒ¬ã‚¢ãƒ¬ã‚¹è«¸å³¶":["Palma de Mallorca","Ibiza"]},"ãƒãƒ«ãƒˆã‚¬ãƒ«":{"ãƒªã‚¹ãƒœãƒ³çœŒ":["Lisbon","Sintra","Cascais"],"ãƒãƒ«ãƒˆçœŒ":["Porto","Vila Nova de Gaia"],"ãƒ•ã‚¡ãƒ¼ãƒ­çœŒ":["Faro","Albufeira","Lagos"]},"ã‚ªãƒ©ãƒ³ãƒ€":{"åŒ—ãƒ›ãƒ©ãƒ³ãƒˆå·":["Amsterdam","Haarlem"],"å—ãƒ›ãƒ©ãƒ³ãƒˆå·":["Rotterdam","Den Haag","Leiden","Delft"],"ãƒ¦ãƒˆãƒ¬ãƒ’ãƒˆå·":["Utrecht"],"åŒ—ãƒ–ãƒ©ãƒãƒ³ãƒˆå·":["Eindhoven","Tilburg","Breda"],"ãƒ˜ãƒ«ãƒ€ãƒ¼ãƒ©ãƒ³ãƒˆå·":["Arnhem","Nijmegen"],"ãƒ•ãƒ­ãƒ¼ãƒ‹ãƒ³ã‚²ãƒ³å·":["Groningen"]},"ãƒ™ãƒ«ã‚®ãƒ¼":{"ãƒ–ãƒªãƒ¥ãƒƒã‚»ãƒ«é¦–éƒ½åœ":["Brussels"],"ãƒ•ãƒ©ãƒ³ãƒ€ãƒ¼ã‚¹åœ°åŸŸ":["Antwerp","Ghent","Bruges","Leuven"],"ãƒ¯ãƒ­ãƒ³åœ°åŸŸ":["LiÃ¨ge","Namur","Charleroi"]},"ã‚¹ã‚¤ã‚¹":{"ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ’å·":["ZÃ¼rich","Winterthur"],"ãƒ™ãƒ«ãƒ³å·":["Bern","Thun","Biel"],"ã‚¸ãƒ¥ãƒãƒ¼ãƒ´å·":["GenÃ¨ve"],"ãƒãƒ¼ã‚¼ãƒ«ï¼ã‚·ãƒ¥ã‚¿ãƒƒãƒˆæº–å·":["Basel"],"ãƒ´ã‚©ãƒ¼å·":["Lausanne","Montreux"],"ãƒ«ãƒ„ã‚§ãƒ«ãƒ³å·":["Luzern"],"ãƒ†ã‚£ãƒãƒ¼ãƒå·":["Lugano","Locarno"]},"ã‚ªãƒ¼ã‚¹ãƒˆãƒªã‚¢":{"ã‚¦ã‚£ãƒ¼ãƒ³":["1åŒº","2åŒº","3åŒº","4åŒº","7åŒº","8åŒº","9åŒº"],"ã‚¶ãƒ«ãƒ„ãƒ–ãƒ«ã‚¯å·":["Salzburg"],"ãƒãƒ­ãƒ«å·":["Innsbruck"],"ã‚·ãƒ¥ã‚¿ã‚¤ã‚¢ãƒ¼ãƒãƒ«ã‚¯å·":["Graz"],"ã‚ªãƒ¼ãƒãƒ¼ã‚¨ã‚¹ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ’å·":["Linz"]},"ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³":{"ã‚¹ãƒˆãƒƒã‚¯ãƒ›ãƒ«ãƒ çœŒ":["Stockholm","Solna","Sundbyberg"],"ãƒ´ã‚§ã‚¹ãƒˆãƒ©ãƒ»ã‚¤ã‚§ãƒ¼ã‚¿ãƒ©ãƒ³ãƒ‰çœŒ":["GÃ¶teborg"],"ã‚¹ã‚³ãƒ¼ãƒçœŒ":["MalmÃ¶","Lund","Helsingborg"],"ã‚¦ãƒ—ã‚µãƒ©çœŒ":["Uppsala"]},"ãƒãƒ«ã‚¦ã‚§ãƒ¼":{"ã‚ªã‚¹ãƒ­":[],"ãƒ´ã‚§ã‚¹ãƒˆãƒ©ãƒ³ãƒ‰çœŒ":["Bergen","Stavanger"],"ãƒˆãƒ­ãƒ³ãƒ‡ãƒ©ãƒ¼ã‚°çœŒ":["Trondheim"]},"ãƒ‡ãƒ³ãƒãƒ¼ã‚¯":{"é¦–éƒ½åœ°åŸŸ":["Copenhagen","Frederiksberg"],"ä¸­å¤®ãƒ¦ãƒˆãƒ©ãƒ³ãƒ‰åœ°åŸŸ":["Aarhus"],"å—ãƒ‡ãƒ³ãƒãƒ¼ã‚¯åœ°åŸŸ":["Odense"]},"ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰":{"ã‚¦ãƒ¼ã‚·ãƒãƒ¼çœŒ":["Helsinki","Espoo","Vantaa"],"ãƒ”ãƒ«ã‚«ãƒ³ãƒãƒ¼çœŒ":["Tampere"],"å—è¥¿ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰çœŒ":["Turku"]},"ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰":{"ãƒ¬ãƒ³ã‚¹ã‚¿ãƒ¼":["Dublin","Kilkenny"],"ãƒãƒ³ã‚¹ã‚¿ãƒ¼":["Cork","Limerick","Galway"],"ã‚³ãƒŠãƒãƒˆ":[],"ã‚¢ãƒ«ã‚¹ã‚¿ãƒ¼":[]},"ãƒãƒ¼ãƒ©ãƒ³ãƒ‰":{"ãƒã‚¾ãƒ•ã‚·ã‚§çœŒ":["Warszawa"],"ãƒã‚¦ã‚©ãƒãƒ«ã‚¹ã‚«çœŒ":["KrakÃ³w"],"ãƒ´ã‚£ã‚¨ãƒ«ã‚³ãƒãƒ«ã‚¹ã‚«çœŒ":["PoznaÅ„"],"ãƒãƒ¢ãƒ¼ã‚¸ã‚§çœŒ":["GdaÅ„sk"],"ãƒ‰ãƒ«ãƒã‚·ãƒ­ãƒ³ã‚¹ã‚¯çœŒ":["WrocÅ‚aw"],"ã‚¦ãƒƒãƒçœŒ":["ÅÃ³dÅº"]},"ãƒã‚§ã‚³":{"ãƒ—ãƒ©ãƒ":["ãƒ—ãƒ©ãƒ1","ãƒ—ãƒ©ãƒ2","ãƒ—ãƒ©ãƒ3"],"å—ãƒ¢ãƒ©ãƒ´ã‚£ã‚¢å·":["Brno"],"ãƒ¢ãƒ©ãƒ´ã‚£ã‚¢ï¼ã‚·ãƒ¬ã‚¸ã‚¢å·":["Ostrava"]},"ãƒãƒ³ã‚¬ãƒªãƒ¼":{"ãƒ–ãƒ€ãƒšã‚¹ãƒˆ":["ãƒ–ãƒ€","ãƒšã‚¹ãƒˆ"],"ãƒšã‚·ãƒ¥ãƒˆçœŒ":[],"ãƒãƒ©ãƒ‹ãƒ£çœŒ":["PÃ©cs"]},"ã‚®ãƒªã‚·ãƒ£":{"ã‚¢ãƒƒãƒ†ã‚£ã‚«":["Athens","Piraeus"],"ä¸­å¤®ãƒã‚±ãƒ‰ãƒ‹ã‚¢":["Thessaloniki"],"ã‚¯ãƒ¬ã‚¿":["Heraklion","Chania"]},"ãƒ«ãƒ¼ãƒãƒ‹ã‚¢":{"ãƒ–ã‚«ãƒ¬ã‚¹ãƒˆ":[],"ã‚¯ãƒ«ã‚¸ãƒ¥çœŒ":["Cluj-Napoca"],"ãƒ†ã‚£ãƒŸã‚·ãƒ¥çœŒ":["TimiÈ™oara"]},"ãƒ–ãƒ«ã‚¬ãƒªã‚¢":{"ã‚½ãƒ•ã‚£ã‚¢å¸‚":["Sofia"],"ãƒ—ãƒ­ãƒ´ãƒ‡ã‚£ãƒ•å·":["Plovdiv"]},"ã‚¯ãƒ­ã‚¢ãƒã‚¢":{"ã‚¶ã‚°ãƒ¬ãƒ–å¸‚":["Zagreb"],"ã‚¹ãƒ—ãƒªãƒˆï¼ãƒ€ãƒ«ãƒãƒã‚¢éƒ¡":["Split"],"ãƒ‰ã‚¥ãƒ–ãƒ­ãƒ´ãƒ‹ã‚¯ï¼ãƒãƒ¬ãƒˆãƒ´ã‚¡éƒ¡":["Dubrovnik"]},"ã‚»ãƒ«ãƒ“ã‚¢":{"ãƒ™ã‚ªã‚°ãƒ©ãƒ¼ãƒ‰":[],"ãƒ´ã‚©ã‚¤ãƒ´ã‚©ãƒ‡ã‚£ãƒŠ":["Novi Sad"]},"ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠ":{"ã‚­ãƒ¼ã‚¦å¸‚":["ã‚­ãƒ¼ã‚¦"],"ãƒªãƒ´ã‚£ã‚¦å·":["ãƒªãƒ´ã‚£ã‚¦"],"ã‚ªãƒ‡ãƒƒã‚µå·":["ã‚ªãƒ‡ãƒƒã‚µ"]},"ãƒ­ã‚·ã‚¢":{"ãƒ¢ã‚¹ã‚¯ãƒ¯å¸‚":["ä¸­å¤®åŒº","åŒ—æ±åŒº","å—åŒº","è¥¿åŒº"],"ã‚µãƒ³ã‚¯ãƒˆãƒšãƒ†ãƒ«ãƒ–ãƒ«ã‚¯å¸‚":["ä¸­å¤®åŒº","ãƒšãƒˆãƒ­ã‚°ãƒ©ãƒ¼ãƒ‰åŒº"],"ãƒãƒ´ã‚©ã‚·ãƒ“ãƒ«ã‚¹ã‚¯å·":["ãƒãƒ´ã‚©ã‚·ãƒ“ãƒ«ã‚¹ã‚¯"],"ã‚¹ãƒ´ã‚§ãƒ«ãƒ‰ãƒ­ãƒ•ã‚¹ã‚¯å·":["ã‚¨ã‚«ãƒ†ãƒªãƒ³ãƒ–ãƒ«ã‚¯"],"ã‚¿ã‚¿ãƒ¼ãƒ«ã‚¹ã‚¿ãƒ³å…±å’Œå›½":["ã‚«ã‚¶ãƒ³"],"æ²¿æµ·åœ°æ–¹":["ã‚¦ãƒ©ã‚¸ã‚ªã‚¹ãƒˆã‚¯"]},"ã‚¢ã‚¤ã‚¹ãƒ©ãƒ³ãƒ‰":{"é¦–éƒ½åœ":["Reykjavik","KÃ³pavogur"]},"ãƒ«ã‚¯ã‚»ãƒ³ãƒ–ãƒ«ã‚¯":{"ãƒ«ã‚¯ã‚»ãƒ³ãƒ–ãƒ«ã‚¯":["ãƒ«ã‚¯ã‚»ãƒ³ãƒ–ãƒ«ã‚¯å¸‚"]},"ã‚¨ã‚¹ãƒˆãƒ‹ã‚¢":{"ãƒãƒªãƒ¥çœŒ":["Tallinn"],"ã‚¿ãƒ«ãƒˆã‚¥çœŒ":["Tartu"]},"ãƒ©ãƒˆãƒ“ã‚¢":{"ãƒªã‚¬":[]},"ãƒªãƒˆã‚¢ãƒ‹ã‚¢":{"ãƒ´ã‚£ãƒªãƒ‹ãƒ¥ã‚¹çœŒ":["Vilnius"],"ã‚«ã‚¦ãƒŠã‚¹çœŒ":["Kaunas"]},"ã‚¹ãƒ­ãƒ™ãƒ‹ã‚¢":{"ãƒªãƒ¥ãƒ–ãƒªãƒ£ãƒŠ":[]},"ã‚¹ãƒ­ãƒã‚­ã‚¢":{"ãƒ–ãƒ©ãƒã‚¹ãƒ©ãƒ´ã‚¡çœŒ":["Bratislava"],"ã‚³ã‚·ãƒ„ã‚§çœŒ":["KoÅ¡ice"]},"ãƒãƒ«ã‚¿":{"ãƒãƒ¬ãƒƒã‚¿":[],"ã‚¹ãƒªãƒ¼ãƒ":[],"ã‚»ãƒ³ãƒˆãƒ»ã‚¸ãƒ¥ãƒªã‚¢ãƒ³ã‚º":[]},"ã‚­ãƒ—ãƒ­ã‚¹":{"ãƒ‹ã‚³ã‚·ã‚¢åœ°åŒº":["Nicosia"],"ãƒªãƒã‚½ãƒ«åœ°åŒº":["Limassol"],"ãƒ‘ãƒ•ã‚©ã‚¹åœ°åŒº":["Paphos"]},"ã‚¢ãƒ¡ãƒªã‚«åˆè¡†å›½":{"California":["Los Angeles","San Francisco","San Diego","San Jose","Sacramento","Oakland","Irvine","Pasadena","Santa Monica","Berkeley"],"New York":["New York City","Buffalo","Albany","Rochester","Syracuse"],"Texas":["Houston","Austin","Dallas","San Antonio","Fort Worth","El Paso"],"Florida":["Miami","Orlando","Tampa","Jacksonville","Fort Lauderdale","St. Petersburg"],"Illinois":["Chicago","Springfield","Naperville","Evanston"],"Pennsylvania":["Philadelphia","Pittsburgh","Harrisburg"],"Ohio":["Columbus","Cleveland","Cincinnati","Toledo"],"Georgia":["Atlanta","Savannah","Augusta"],"North Carolina":["Charlotte","Raleigh","Durham","Asheville"],"Michigan":["Detroit","Ann Arbor","Grand Rapids"],"New Jersey":["Newark","Jersey City","Princeton","Hoboken"],"Virginia":["Richmond","Virginia Beach","Arlington","Alexandria"],"Washington":["Seattle","Tacoma","Spokane","Bellevue","Redmond"],"Arizona":["Phoenix","Tucson","Scottsdale","Mesa"],"Massachusetts":["Boston","Cambridge","Worcester","Salem"],"Tennessee":["Nashville","Memphis","Knoxville","Chattanooga"],"Indiana":["Indianapolis","Fort Wayne","Bloomington"],"Missouri":["Kansas City","St. Louis","Springfield"],"Maryland":["Baltimore","Bethesda","Annapolis","Rockville"],"Wisconsin":["Milwaukee","Madison","Green Bay"],"Colorado":["Denver","Colorado Springs","Boulder","Fort Collins"],"Minnesota":["Minneapolis","St. Paul","Rochester"],"Oregon":["Portland","Eugene","Salem","Bend"],"Nevada":["Las Vegas","Reno","Henderson"],"Connecticut":["Hartford","New Haven","Stamford"],"Utah":["Salt Lake City","Provo","Park City"],"Hawaii":["Honolulu","Maui","Kailua-Kona"],"Louisiana":["New Orleans","Baton Rouge"],"District of Columbia":["Washington DC"]},"ã‚«ãƒŠãƒ€":{"Quebec":["Montreal","Quebec City","Laval","Gatineau","Sherbrooke","Trois-RiviÃ¨res","Longueuil"],"Ontario":["Toronto","Ottawa","Mississauga","Hamilton","Brampton","London","Markham","Vaughan","Kitchener","Windsor"],"British Columbia":["Vancouver","Victoria","Burnaby","Surrey","Richmond","Kelowna","Nanaimo"],"Alberta":["Calgary","Edmonton","Red Deer","Lethbridge","Banff"],"Manitoba":["Winnipeg","Brandon"],"Saskatchewan":["Saskatoon","Regina"],"Nova Scotia":["Halifax","Sydney"],"New Brunswick":["Fredericton","Moncton","Saint John"],"Newfoundland and Labrador":["St. John's"],"Prince Edward Island":["Charlottetown"]},"ãƒ¡ã‚­ã‚·ã‚³":{"ãƒ¡ã‚­ã‚·ã‚³ã‚·ãƒ†ã‚£":["ã‚³ãƒ¨ã‚¢ã‚«ãƒ³","ãƒ™ãƒ‹ãƒ¼ãƒˆãƒ»ãƒ•ã‚¢ãƒ¬ã‚¹","ã‚¯ã‚¢ã‚¦ãƒ†ãƒ¢ãƒƒã‚¯","ãƒŸã‚²ãƒ«ãƒ»ã‚¤ãƒ€ãƒ«ã‚´"],"ãƒãƒªã‚¹ã‚³å·":["ã‚°ã‚¢ãƒ€ãƒ©ãƒãƒ©","ãƒ—ã‚¨ãƒ«ãƒˆãƒã‚¸ãƒ£ãƒ«ã‚¿"],"ãƒŒã‚¨ãƒœãƒ¬ã‚ªãƒ³å·":["ãƒ¢ãƒ³ãƒ†ãƒ¬ã‚¤"],"ã‚­ãƒ³ã‚¿ãƒŠãƒ»ãƒ­ãƒ¼å·":["ã‚«ãƒ³ã‚¯ãƒ³","ãƒ—ãƒ©ãƒ¤ãƒ»ãƒ‡ãƒ«ãƒ»ã‚«ãƒ«ãƒ¡ãƒ³"],"ãƒ¦ã‚«ã‚¿ãƒ³å·":["ãƒ¡ãƒªãƒ€"],"ãƒãƒãƒ»ã‚«ãƒªãƒ•ã‚©ãƒ«ãƒ‹ã‚¢å·":["ãƒ†ã‚£ãƒ•ã‚¡ãƒŠ","ã‚¨ãƒ³ã‚»ãƒŠãƒ¼ãƒ€"]},"ãƒ–ãƒ©ã‚¸ãƒ«":{"ã‚µãƒ³ãƒ‘ã‚¦ãƒ­å·":["SÃ£o Paulo","Campinas","Santos","Guarulhos"],"ãƒªã‚ªãƒ‡ã‚¸ãƒ£ãƒã‚¤ãƒ­å·":["Rio de Janeiro","NiterÃ³i"],"ãƒŸãƒŠã‚¹ã‚¸ã‚§ãƒ©ã‚¤ã‚¹å·":["Belo Horizonte","Ouro Preto"],"ãƒã‚¤ãƒ¼ã‚¢å·":["Salvador"],"é€£é‚¦ç›´è½„åŒº":["BrasÃ­lia"],"ãƒ‘ãƒ©ãƒŠå·":["Curitiba"],"ãƒªã‚ªã‚°ãƒ©ãƒ³ãƒ‡ãƒ»ãƒ‰ãƒ»ã‚¹ãƒ«å·":["Porto Alegre"],"ãƒšãƒ«ãƒŠãƒ³ãƒ–ãƒ¼ã‚³å·":["Recife"],"ã‚»ã‚¢ãƒ©ãƒ¼å·":["Fortaleza"],"ã‚¢ãƒã‚¾ãƒŠã‚¹å·":["Manaus"]},"ã‚¢ãƒ«ã‚¼ãƒ³ãƒãƒ³":{"ãƒ–ã‚¨ãƒã‚¹ã‚¢ã‚¤ãƒ¬ã‚¹è‡ªæ²»å¸‚":["ãƒ‘ãƒ¬ãƒ«ãƒ¢","ãƒ¬ã‚³ãƒ¬ãƒ¼ã‚¿","ã‚µãƒ³ãƒ†ãƒ«ãƒ¢","ãƒ™ãƒ«ã‚°ãƒ©ãƒ"],"ãƒ–ã‚¨ãƒã‚¹ã‚¢ã‚¤ãƒ¬ã‚¹å·":["ãƒ©ãƒ—ãƒ©ã‚¿","ãƒãƒ«ãƒ‡ãƒ«ãƒ—ãƒ©ã‚¿"],"ã‚³ãƒ«ãƒ‰ãƒå·":["CÃ³rdoba"],"ãƒ¡ãƒ³ãƒ‰ãƒ¼ã‚µå·":["Mendoza"],"ã‚µãƒ³ã‚¿ãƒ•ã‚§å·":["Rosario"]},"ãƒãƒª":{"ã‚µãƒ³ãƒ†ã‚£ã‚¢ã‚´é¦–éƒ½å·":["Santiago","Providencia","Las Condes"],"ãƒãƒ«ãƒ‘ãƒ©ã‚¤ã‚½å·":["ValparaÃ­so","ViÃ±a del Mar"]},"ã‚³ãƒ­ãƒ³ãƒ“ã‚¢":{"ãƒœã‚´ã‚¿é¦–éƒ½åœ°åŒº":["BogotÃ¡"],"ã‚¢ãƒ³ãƒ†ã‚£ã‚ªã‚­ã‚¢çœŒ":["MedellÃ­n"],"ãƒã‚¸ã‚§ãƒ»ãƒ‡ãƒ«ãƒ»ã‚«ã‚¦ã‚«çœŒ":["Cali"]},"ãƒšãƒ«ãƒ¼":{"ãƒªãƒçœŒ":["Lima","Miraflores","San Isidro"],"ã‚¯ã‚¹ã‚³çœŒ":["Cusco"],"ã‚¢ãƒ¬ã‚­ãƒ‘çœŒ":["Arequipa"]},"ã‚¨ã‚¯ã‚¢ãƒ‰ãƒ«":{"ãƒ”ãƒãƒ³ãƒãƒ£çœŒ":["Quito"],"ã‚°ã‚¢ãƒ¤ã‚¹çœŒ":["Guayaquil"]},"ã‚¦ãƒ«ã‚°ã‚¢ã‚¤":{"ãƒ¢ãƒ³ãƒ†ãƒ“ãƒ‡ã‚ªçœŒ":["Montevideo"]},"ãƒ‘ãƒ©ã‚°ã‚¢ã‚¤":{"ã‚¢ã‚¹ãƒ³ã‚·ã‚ªãƒ³":[]},"ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢":{"New South Wales":["Sydney","Newcastle","Wollongong","Byron Bay","Blue Mountains"],"Victoria":["Melbourne","Geelong","Ballarat","Bendigo"],"Queensland":["Brisbane","Gold Coast","Cairns","Sunshine Coast","Townsville"],"Western Australia":["Perth","Fremantle","Margaret River"],"South Australia":["Adelaide","Barossa Valley"],"Tasmania":["Hobart","Launceston"],"Australian Capital Territory":["Canberra"],"Northern Territory":["Darwin","Alice Springs"]},"ãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰":{"ã‚ªãƒ¼ã‚¯ãƒ©ãƒ³ãƒ‰åœ°æ–¹":["Auckland","North Shore","Manukau"],"ã‚¦ã‚§ãƒªãƒ³ãƒˆãƒ³åœ°æ–¹":["Wellington","Lower Hutt"],"ã‚«ãƒ³ã‚¿ãƒ™ãƒªãƒ¼åœ°æ–¹":["Christchurch"],"ã‚ªã‚¿ã‚´åœ°æ–¹":["Dunedin","Queenstown"],"ãƒ¯ã‚¤ã‚«ãƒˆåœ°æ–¹":["Hamilton"],"ãƒ™ã‚¤ãƒ»ã‚ªãƒ–ãƒ»ãƒ—ãƒ¬ãƒ³ãƒ†ã‚£åœ°æ–¹":["Tauranga","Rotorua"]},"ãƒ•ã‚£ã‚¸ãƒ¼":{"ã‚¹ãƒ":[],"ãƒŠãƒ³ãƒ‡ã‚£":[]},"å—ã‚¢ãƒ•ãƒªã‚«":{"ãƒã‚¦ãƒ†ãƒ³å·":["Johannesburg","Pretoria","Sandton"],"è¥¿ã‚±ãƒ¼ãƒ—å·":["Cape Town","Stellenbosch"],"ã‚¯ãƒ¯ã‚ºãƒ¼ãƒ«ãƒ¼ãƒ»ãƒŠã‚¿ãƒ¼ãƒ«å·":["Durban","Pietermaritzburg"],"æ±ã‚±ãƒ¼ãƒ—å·":["Port Elizabeth"]},"ã‚¨ã‚¸ãƒ—ãƒˆ":{"ã‚«ã‚¤ãƒ­çœŒ":["Cairo","Giza"],"ã‚¢ãƒ¬ã‚¯ã‚µãƒ³ãƒ‰ãƒªã‚¢çœŒ":["Alexandria"],"ç´…æµ·çœŒ":["Hurghada"]},"ã‚±ãƒ‹ã‚¢":{"ãƒŠã‚¤ãƒ­ãƒ“çœŒ":["Nairobi"],"ãƒ¢ãƒ³ãƒã‚µçœŒ":["Mombasa"]},"ãƒŠã‚¤ã‚¸ã‚§ãƒªã‚¢":{"ãƒ©ã‚´ã‚¹å·":["Lagos","Ikeja"],"é€£é‚¦é¦–éƒ½åœ°åŒº":["Abuja"]},"ãƒ¢ãƒ­ãƒƒã‚³":{"ã‚«ã‚µãƒ–ãƒ©ãƒ³ã‚«ï¼ã‚»ã‚¿ãƒƒãƒˆåœ°æ–¹":["Casablanca"],"ãƒ©ãƒãƒˆï¼ã‚µãƒ¬ï¼ã‚±ãƒ‹ãƒˆãƒ©åœ°æ–¹":["Rabat"],"ãƒãƒ©ã‚±ã‚·ãƒ¥ï¼ã‚µãƒ•ã‚£åœ°æ–¹":["Marrakech"]},"ã‚¬ãƒ¼ãƒŠ":{"ã‚°ãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¢ã‚¯ãƒ©å·":["Accra"]},"ã‚¿ãƒ³ã‚¶ãƒ‹ã‚¢":{"ãƒ€ãƒ«ã‚¨ã‚¹ã‚µãƒ©ãƒ¼ãƒ å·":["Dar es Salaam"]},"ã‚¨ãƒã‚ªãƒ”ã‚¢":{"ã‚¢ãƒ‡ã‚£ã‚¹ã‚¢ãƒ™ãƒç‰¹åˆ¥å¸‚":["Addis Ababa"]},"ãƒãƒ¥ãƒ‹ã‚¸ã‚¢":{"ãƒãƒ¥ãƒ‹ã‚¹çœŒ":["Tunis"]},"ã‚³ã‚¹ã‚¿ãƒªã‚«":{"ã‚µãƒ³ãƒ›ã‚»å·":["San JosÃ©"]},"ãƒ‘ãƒŠãƒ":{"ãƒ‘ãƒŠãƒçœŒ":["Panama City"]},"ã‚¸ãƒ£ãƒã‚¤ã‚«":{"ã‚­ãƒ³ã‚°ã‚¹ãƒˆãƒ³æ•™åŒº":["Kingston"]},"ãƒ—ã‚¨ãƒ«ãƒˆãƒªã‚³":{"ã‚µãƒ³ãƒ•ã‚¢ãƒ³":[]},"ã‚«ã‚¶ãƒ•ã‚¹ã‚¿ãƒ³":{"ã‚¢ãƒ«ãƒãƒˆã‚¤":[],"ã‚¢ã‚¹ã‚¿ãƒŠ":[]},"ã‚¦ã‚ºãƒ™ã‚­ã‚¹ã‚¿ãƒ³":{"ã‚¿ã‚·ã‚±ãƒ³ãƒˆå¸‚":["Tashkent"],"ã‚µãƒãƒ«ã‚«ãƒ³ãƒ‰å·":["Samarkand"]},"ã‚¸ãƒ§ãƒ¼ã‚¸ã‚¢":{"ãƒˆãƒ“ãƒªã‚·":[],"ãƒãƒˆã‚¥ãƒŸ":[]}};

function mergeAreaData(dbData) {
  // å†…è”µãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼
  countryAreaMap = {};
  Object.keys(BUILTIN_AREAS).forEach(function(c) {
    countryAreaMap[c] = {};
    Object.keys(BUILTIN_AREAS[c]).forEach(function(a) {
      countryAreaMap[c][a] = BUILTIN_AREAS[c][a].slice();
    });
  });
  // DBãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸
  if (Array.isArray(dbData)) {
    dbData.forEach(function(f) {
      var c = (f.country || 'æ—¥æœ¬').trim();
      var a = (f.area || '').trim();
      var d = (f.area_detail || '').trim();
      if (!c) return;
      if (!countryAreaMap[c]) countryAreaMap[c] = {};
      if (a && !countryAreaMap[c][a]) countryAreaMap[c][a] = [];
      if (a && d && countryAreaMap[c][a].indexOf(d) === -1) countryAreaMap[c][a].push(d);
    });
  }
  // ã‚½ãƒ¼ãƒˆ
  Object.keys(countryAreaMap).forEach(function(c) {
    Object.keys(countryAreaMap[c]).forEach(function(a) { countryAreaMap[c][a].sort(); });
  });
}

async function loadAreaData() {
  try {
    var [res1, res2] = await Promise.all([
      adminFetch('table', { name: 'pet_families', limit: 500, order: 'created_at', asc: 'false' }),
      adminFetch('table', { name: 'openchats', limit: 500, order: 'name', asc: 'true' })
    ]);
    var j1 = await res1.json();
    var j2 = await res2.json();
    var data1 = (j1.success && j1.data) ? j1.data.rows : [];
    var data2 = (j2.success && j2.data) ? j2.data.rows : [];
    var allData = [].concat(data1).concat(data2);
    mergeAreaData(allData);
  } catch(e) {
    console.error('loadAreaData error:', e);
    mergeAreaData([]);
  }
}

function populateCountrySelect(selectedCountry) {
  var el = document.getElementById('ocCountry');
  var html = '';
  var countries = Object.keys(countryAreaMap).sort(function(a,b) {
    if (a === 'æ—¥æœ¬') return -1;
    if (b === 'æ—¥æœ¬') return 1;
    return a.localeCompare(b);
  });
  countries.forEach(function(c) {
    var sel = (c === selectedCountry) ? ' selected' : '';
    html += '<option value="'+escapeHtml(c)+'"'+sel+'>'+escapeHtml(c)+'</option>';
  });
  el.innerHTML = html;
}

function onOcCountryChange() {
  var country = document.getElementById('ocCountry').value;
  populateAreaSelect(country, '', '');
}

function populateAreaSelect(country, selectedArea, selectedDetail) {
  var areaEl = document.getElementById('ocArea');
  var areas = countryAreaMap[country] || {};
  var html = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
  Object.keys(areas).sort().forEach(function(a) {
    var sel = (a === selectedArea) ? ' selected' : '';
    html += '<option value="'+escapeHtml(a)+'"'+sel+'>'+escapeHtml(a)+'</option>';
  });
  areaEl.innerHTML = html;
  updateOcAreaDetail(selectedDetail);
}

function updateOcAreaDetail(preselect) {
  var country = document.getElementById('ocCountry').value || 'æ—¥æœ¬';
  var area = document.getElementById('ocArea').value;
  var detailEl = document.getElementById('ocAreaDetail');
  var html = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
  if (area && countryAreaMap[country] && countryAreaMap[country][area]) {
    countryAreaMap[country][area].forEach(function(d) {
      var sel = (d === preselect) ? ' selected' : '';
      html += '<option value="'+escapeHtml(d)+'"'+sel+'>'+escapeHtml(d)+'</option>';
    });
  }
  detailEl.innerHTML = html;
}

function showOcForm(editData) {
  document.getElementById('ocFormWrap').style.display = 'block';
  if (editData) {
    document.getElementById('ocFormTitle').textContent = 'âœï¸ OpenChatç·¨é›† (ID:'+editData.id+')';
    document.getElementById('ocEditId').value = editData.id;
    document.getElementById('ocName').value = editData.name || '';
    document.getElementById('ocUrl').value = editData.url || '';
    populateCountrySelect(editData.country || 'æ—¥æœ¬');
    populateAreaSelect(editData.country || 'æ—¥æœ¬', editData.area || '', editData.area_detail || '');
    document.getElementById('ocMembers').value = editData.member_count || 0;
    document.getElementById('ocNotes').value = editData.notes || '';
    document.getElementById('ocDesc').value = editData.description || '';
    document.getElementById('ocPhase').value = editData.phase || 'seed';
    document.getElementById('ocLeader').value = editData.leader_name || '';
  } else {
    document.getElementById('ocFormTitle').textContent = 'ğŸ’¬ æ–°è¦OpenChatç™»éŒ²';
    document.getElementById('ocEditId').value = '';
    ['ocName','ocUrl','ocMembers','ocNotes','ocDesc','ocLeader'].forEach(function(id){ document.getElementById(id).value = ''; });
    document.getElementById('ocPhase').value = 'seed';
    populateCountrySelect('æ—¥æœ¬');
    populateAreaSelect('æ—¥æœ¬', '', '');
  }
}

function hideOcForm() {
  document.getElementById('ocFormWrap').style.display = 'none';
}

async function loadOcList() {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }
  var container = document.getElementById('ocListContainer');
  container.innerHTML = '<div class="loading"><span class="spinner"></span>èª­ã¿è¾¼ã¿ä¸­...</div>';

  try {
    // ã‚¨ãƒªã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’å…ˆã«ãƒ­ãƒ¼ãƒ‰
    await loadAreaData();

    var [ocRes, famTableRes] = await Promise.all([
      adminFetch('table', { name: 'openchats', limit: 500, order: 'name', asc: 'true' }),
      adminFetch('table', { name: 'pet_families', limit: 500, order: 'created_at', asc: 'false' })
    ]);
    var ocJson = await ocRes.json();
    var famJson = await famTableRes.json();
    var data = (ocJson.success && ocJson.data) ? ocJson.data.rows : [];
    if (!Array.isArray(data) || data.length === 0) { container.innerHTML='<div class="empty"><div class="icon">ğŸ“­</div><p>ãƒ‡ãƒ¼ã‚¿ãªã—</p></div>'; return; }
    allOpenchats = data;
    document.getElementById('badge-openchats').textContent = data.length;

    // å„OpenChatã®ç´ã¥ã‘å®¶æ—æ•°ã‚’å–å¾—
    var famData = (famJson.success && famJson.data) ? famJson.data.rows : [];
    var bindCounts = {};
    var totalBound = 0;
    if (Array.isArray(famData)) {
      famData.forEach(function(f) {
        if (f.openchat_id) { bindCounts[f.openchat_id] = (bindCounts[f.openchat_id]||0) + 1; totalBound++; }
      });
    }

    // KPI stats
    var today = new Date().toISOString().substring(0,10);
    var totalMembers = 0, reported = 0, pending = 0;
    data.forEach(function(oc) {
      totalMembers += (oc.member_count || 0);
      if (oc.last_report_at && oc.last_report_at.substring(0,10) >= today) reported++;
      else pending++;
    });
    document.getElementById('oc-stat-total').textContent = data.length;
    document.getElementById('oc-stat-members').textContent = totalMembers;
    document.getElementById('oc-stat-reported').textContent = reported;
    document.getElementById('oc-stat-pending').textContent = pending;
    document.getElementById('oc-stat-families').textContent = totalBound;

    renderOcList(data, bindCounts);
  } catch(e) { container.innerHTML='<div class="empty"><div class="icon">âŒ</div><p>'+e.message+'</p></div>'; }
}

function renderOcList(list, bindCounts) {
  if (list.length === 0) {
    document.getElementById('ocListContainer').innerHTML='<div class="empty"><div class="icon">ğŸ“­</div><p>OpenChatãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p></div>';
    return;
  }
  var phases = {seed:'ğŸŒ± ä½œæˆ',nurture:'ğŸŒ¿ è‚²æˆ',selfrun:'ğŸŒ³ è‡ªèµ°',split:'ğŸ”€ åˆ†å‰²æ¤œè¨',archived:'ğŸ“¦ çµ‚äº†'};
  var phaseColors = {seed:'#E0F2FE;color:#0369A1',nurture:'#E8F8ED;color:#05A847',selfrun:'#FFF8EE;color:#B8860B',split:'#FFF0F2;color:#D03A50',archived:'#F3F4F6;color:#6B7280'};
  var today = new Date().toISOString().substring(0,10);
  var html = '';
  list.forEach(function(oc){
    var binds = bindCounts[oc.id] || 0;
    var phase = oc.phase || 'seed';
    var repOk = oc.last_report_at && oc.last_report_at.substring(0,10) >= today;
    html += '<div class="quota-family-card" data-name="'+escapeHtml(oc.name||'')+'" data-area="'+escapeHtml(oc.area||'')+'" data-country="'+escapeHtml(oc.country||'')+'">';

    // Header
    html += '<div class="quota-family-header">';
    html += '<span class="code" style="color:var(--teal-d);">ID:'+oc.id+'</span>';
    html += '<span class="pets" style="font-size:14px;">ğŸ’¬ '+escapeHtml(oc.name)+'</span>';
    html += '<span style="font-size:10px;font-weight:700;padding:2px 10px;border-radius:6px;background:'+(phaseColors[phase]||'')+'">'+(phases[phase]||phase)+'</span>';
    html += '<span class="area">ğŸŒ '+escapeHtml(oc.country||'æ—¥æœ¬')+' ğŸ“ '+escapeHtml((oc.area||'')+(oc.area_detail?' '+oc.area_detail:''))+'</span>';
    html += '<span style="font-size:11px;background:#DBEAFE;color:#1E40AF;padding:2px 10px;border-radius:6px;font-weight:600;">ğŸ‘¥ '+oc.member_count+'äºº</span>';
    html += '<span style="font-size:11px;background:var(--teal-l);color:var(--teal-d);padding:2px 10px;border-radius:6px;font-weight:600;">ğŸ  '+binds+'å®¶æ—</span>';
    html += '</div>';

    // Body: Details + Operational Status
    html += '<div style="padding:12px 16px;">';

    // Operational status row
    html += '<div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">';
    html += '<span style="font-size:11px;padding:3px 10px;border-radius:6px;font-weight:600;'+(repOk?'background:#DCFCE7;color:#166534;':'background:#FEF3C7;color:#92400E;')+'">'+(repOk?'âœ… ãƒ¬ãƒãƒ¼ãƒˆæ¸ˆ':'âš ï¸ æœªãƒ¬ãƒãƒ¼ãƒˆ')+'</span>';
    var lastTopic = oc.last_topic_at ? oc.last_topic_at.substring(0,10) : null;
    html += '<span style="font-size:11px;padding:3px 10px;border-radius:6px;font-weight:600;background:#F0F4FF;color:#3B4C96;">ğŸ’¬ è©±é¡Œ: '+(lastTopic||'æœªæŠ•ç¨¿')+'</span>';
    if (oc.leader_name) html += '<span style="font-size:11px;padding:3px 10px;border-radius:6px;font-weight:600;background:#FEF3C7;color:#92400E;">ğŸŒŸ '+escapeHtml(oc.leader_name)+'</span>';
    html += '</div>';

    if (oc.description) html += '<div style="font-size:12px;color:var(--s500);margin-bottom:6px;line-height:1.6;">'+escapeHtml(oc.description)+'</div>';
    if (oc.url) html += '<div style="font-size:11px;margin-bottom:4px;"><span style="color:var(--s400);">URL:</span> <a href="'+escapeHtml(oc.url)+'" target="_blank" style="color:var(--teal-d);font-family:\'JetBrains Mono\',monospace;word-break:break-all;">'+escapeHtml(oc.url)+'</a></div>';
    if (oc.notes) html += '<div style="font-size:11px;color:var(--s400);">ğŸ“ '+escapeHtml(oc.notes)+'</div>';
    html += '</div>';

    // Actions
    html += '<div style="padding:8px 16px 12px;border-top:1px solid var(--s100);display:flex;gap:8px;flex-wrap:wrap;">';
    html += '<button class="btn btn-outline btn-sm" onclick=\'showOcForm('+JSON.stringify(oc).replace(/'/g,"\\'")+')\'> âœï¸ ç·¨é›†</button>';
    if (oc.url) html += '<a href="'+escapeHtml(oc.url)+'" target="_blank" class="btn btn-outline btn-sm" style="text-decoration:none;">ğŸ”— LINEã§é–‹ã</a>';
    if (!repOk) html += '<button class="btn btn-primary btn-sm" onclick="quickPostReport('+oc.id+')">ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆæ¸ˆ</button>';
    html += '<button class="btn btn-outline btn-sm" onclick="quickPostTopic('+oc.id+')">ğŸ’¬ è©±é¡ŒæŠ•ç¨¿æ¸ˆ</button>';
    html += '<button class="btn btn-danger btn-sm" style="margin-left:auto;" onclick="deleteOc('+oc.id+',\''+escapeHtml(oc.name)+'\')">ğŸ—‘ï¸ å‰Šé™¤</button>';
    html += '</div>';
    html += '</div>';
  });
  document.getElementById('ocListContainer').innerHTML = html;
}

async function quickPostTopic(ocId) {
  if (!connected) return;
  try {
    await adminPost('insert',{table:'oc_post_log',data:{openchat_id:ocId,post_type:'topic',content:'è©±é¡ŒæŠ•ç¨¿',posted_by:currentUser?currentUser.display_name:'ç®¡ç†è€…'}});
    await supaPatch('openchats','id=eq.'+ocId,{last_topic_at:new Date().toISOString()});
    toast('è©±é¡ŒæŠ•ç¨¿ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ','ok');
    loadOcList();
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message,'err'); }
}

async function saveOcEntry() {
  var name = document.getElementById('ocName').value.trim();
  if (!name) { toast('ã‚°ãƒ«ãƒ¼ãƒ—åã¯å¿…é ˆã§ã™','err'); return; }
  var url = document.getElementById('ocUrl').value.trim();
  if (url && !url.startsWith('https://')) { toast('URLã¯ https:// ã§å§‹ã‚ã¦ãã ã•ã„','err'); return; }

  var payload = {
    name: name,
    description: document.getElementById('ocDesc').value.trim() || null,
    country: document.getElementById('ocCountry').value.trim() || 'æ—¥æœ¬',
    area: document.getElementById('ocArea').value.trim() || null,
    area_detail: document.getElementById('ocAreaDetail').value.trim() || null,
    member_count: parseInt(document.getElementById('ocMembers').value) || 0,
    url: url || null,
    notes: document.getElementById('ocNotes').value.trim() || null,
    phase: document.getElementById('ocPhase').value || 'seed',
    leader_name: document.getElementById('ocLeader').value.trim() || null
  };

  var editId = document.getElementById('ocEditId').value;

  try {
    if (editId) {
      var res = await supaPatch('openchats', 'id=eq.' + editId, payload);
      if (res.ok) {
        toast('OpenChatã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'ok');
        hideOcForm(); loadOcList();
      } else { toast('ã‚¨ãƒ©ãƒ¼: ' + await res.text(), 'err'); }
    } else {
      var res = await adminPost('insert', { table: 'openchats', data: payload });
      var json = await res.json();
      if (json.success) {
        toast('OpenChatã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'ok');
        hideOcForm(); loadOcList();
      } else { toast('ã‚¨ãƒ©ãƒ¼: '+(json.error?json.error.message:'è¿½åŠ å¤±æ•—'), 'err'); }
    }
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err'); }
}

async function deleteOc(id, name) {
  if (!confirm('ã€Œ'+name+'ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nç´ã¥ã‘ä¸­ã®å®¶æ—ã¯è‡ªå‹•çš„ã«è§£é™¤ã•ã‚Œã¾ã™ã€‚')) return;
  try {
    var res = await adminPost('delete-row', { table: 'openchats', match: { id: id } });
    var json = await res.json();
    if (json.success) {
      toast('ã€Œ'+name+'ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'ok');
      loadOcList();
    } else { toast('ã‚¨ãƒ©ãƒ¼: '+(json.error?json.error.message:'å‰Šé™¤å¤±æ•—'), 'err'); }
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err'); }
}

function filterOcList() {
  var q = (document.getElementById('ocListSearch').value || '').toLowerCase();
  document.querySelectorAll('#ocListContainer .quota-family-card').forEach(function(card) {
    var name = (card.getAttribute('data-name')||'').toLowerCase();
    var area = (card.getAttribute('data-area')||'').toLowerCase();
    var country = (card.getAttribute('data-country')||'').toLowerCase();
    card.style.display = (!q || name.indexOf(q)!==-1 || area.indexOf(q)!==-1 || country.indexOf(q)!==-1) ? '' : 'none';
  });
}

// â•â•â• å®¶æ— Ã— OpenChatç´ã¥ã‘ â•â•â•
async function loadOcBind() {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }
  var container = document.getElementById('bindList');
  container.innerHTML = '<div class="loading"><span class="spinner"></span>èª­ã¿è¾¼ã¿ä¸­...</div>';

  try {
    // å®¶æ—ä¸€è¦§ + OpenChatä¸€è¦§
    var [famTableRes, ocTableRes] = await Promise.all([
      adminFetch('table', { name: 'pet_families', limit: 500, order: 'created_at', asc: 'false' }),
      adminFetch('table', { name: 'openchats', limit: 500, order: 'name', asc: 'true' })
    ]);
    var famJson = await famTableRes.json();
    var ocJson = await ocTableRes.json();
    var families = (famJson.success && famJson.data) ? famJson.data.rows : [];
    if (!Array.isArray(families) || families.length === 0) { container.innerHTML='<div class="empty"><div class="icon">ğŸ“­</div><p>ãƒ‡ãƒ¼ã‚¿ãªã—</p></div>'; return; }
    var openchats = (ocJson.success && ocJson.data) ? ocJson.data.rows : [];

    var linked = families.filter(function(f){ return f.openchat_id; }).length;
    document.getElementById('bind-total').textContent = families.length;
    document.getElementById('bind-linked').textContent = linked;
    document.getElementById('bind-unlinked').textContent = families.length - linked;

    renderBindList(families, openchats);
  } catch(e) { container.innerHTML='<div class="empty"><div class="icon">âŒ</div><p>'+e.message+'</p></div>'; }
}

function renderBindList(families, openchats) {
  var html = '';
  families.forEach(function(f){
    var code = f.family_code;
    var hasLink = f.openchat_id ? true : false;
    var linkedOc = null;
    if (hasLink) {
      openchats.forEach(function(oc){ if (oc.id === f.openchat_id) linkedOc = oc; });
    }

    // åœ°åŸŸãƒãƒƒãƒãƒ³ã‚°: åŒå›½ï¼‹åŒã‚¨ãƒªã‚¢ã®OpenChatã‚’å„ªå…ˆè¡¨ç¤º
    var fCountry = (f.country || 'æ—¥æœ¬').trim();
    var fArea = (f.area || '').trim();
    var fDetail = (f.area_detail || '').trim();
    var matched = [];
    var sameCountry = [];
    var others = [];
    openchats.forEach(function(oc) {
      var ocCountry = (oc.country || 'æ—¥æœ¬').trim();
      var ocArea = (oc.area || '').trim();
      if (fCountry === ocCountry && fArea && ocArea && fArea === ocArea) {
        matched.push(oc);
      } else if (fCountry === ocCountry) {
        sameCountry.push(oc);
      } else {
        others.push(oc);
      }
    });

    // ã‚»ãƒ¬ã‚¯ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆï¼ˆåŒã‚¨ãƒªã‚¢â†’åŒå›½â†’ãã®ä»–ï¼‰
    var optHtml = '<option value="">â€” æœªè¨­å®š â€”</option>';
    if (matched.length > 0) {
      optHtml += '<optgroup label="â­ '+escapeHtml(fCountry+' '+fArea+(fDetail?' '+fDetail:''))+'ï¼ˆåŒã‚¨ãƒªã‚¢ï¼‰">';
      matched.forEach(function(oc) {
        var label = oc.name + (oc.area_detail ? ' ('+oc.area_detail+')' : '');
        var sel = (f.openchat_id === oc.id) ? ' selected' : '';
        optHtml += '<option value="'+oc.id+'"'+sel+'>â­ '+escapeHtml(label)+'</option>';
      });
      optHtml += '</optgroup>';
    }
    if (sameCountry.length > 0) {
      optHtml += '<optgroup label="ğŸŒ '+escapeHtml(fCountry)+'ï¼ˆä»–ã‚¨ãƒªã‚¢ï¼‰">';
      sameCountry.forEach(function(oc) {
        var label = oc.name + ' (' + (oc.area||'æœªè¨­å®š') + (oc.area_detail?' '+oc.area_detail:'') + ')';
        var sel = (f.openchat_id === oc.id) ? ' selected' : '';
        optHtml += '<option value="'+oc.id+'"'+sel+'>'+escapeHtml(label)+'</option>';
      });
      optHtml += '</optgroup>';
    }
    if (others.length > 0) {
      optHtml += '<optgroup label="ğŸŒ ãã®ä»–ã®å›½">';
      others.forEach(function(oc) {
        var label = oc.name + ' (' + (oc.country||'') + ' ' + (oc.area||'') + ')';
        var sel = (f.openchat_id === oc.id) ? ' selected' : '';
        optHtml += '<option value="'+oc.id+'"'+sel+'>'+escapeHtml(label)+'</option>';
      });
      optHtml += '</optgroup>';
    }

    html += '<div class="quota-family-card" data-code="'+escapeHtml(code)+'" data-pets="'+escapeHtml(f.pet_names||'')+'" data-bind="'+(hasLink?'linked':'unlinked')+'">';
    html += '<div class="quota-family-header">';
    html += '<span class="code">'+escapeHtml(code)+'</span>';
    html += '<span class="pets">ğŸ¾ '+escapeHtml(f.pet_names||'')+' <span style="font-size:11px;color:var(--s400);font-weight:400;">ï¼ˆ'+escapeHtml(f.owner_name||'')+'ï¼‰</span></span>';
    html += '<span class="area">ğŸŒ '+escapeHtml(fCountry)+' ğŸ“ '+escapeHtml((f.area||'')+' '+(f.area_detail||''))+'</span>';
    if (hasLink && linkedOc) {
      html += '<span style="font-size:11px;background:#DCFCE7;color:#166534;padding:2px 10px;border-radius:6px;font-weight:600;">âœ… '+escapeHtml(linkedOc.name)+'</span>';
    } else if (hasLink) {
      html += '<span style="font-size:11px;background:#FEF3C7;color:#92400E;padding:2px 10px;border-radius:6px;font-weight:600;">âš ï¸ ID:'+f.openchat_id+'ï¼ˆå‰Šé™¤æ¸ˆã¿?ï¼‰</span>';
    } else if (matched.length > 0) {
      html += '<span style="font-size:11px;background:#DBEAFE;color:#1E40AF;padding:2px 10px;border-radius:6px;font-weight:600;">ğŸ’¡ '+matched.length+'ä»¶ãŠã™ã™ã‚</span>';
    } else {
      html += '<span style="font-size:11px;background:var(--s100);color:var(--s400);padding:2px 10px;border-radius:6px;font-weight:600;">æœªè¨­å®š</span>';
    }
    html += '</div>';

    html += '<div style="padding:12px 16px;display:flex;gap:8px;align-items:center;">';
    html += '<span style="font-size:12px;font-weight:700;color:var(--s500);white-space:nowrap;">ğŸ’¬ OpenChat</span>';
    html += '<select id="bind_'+code+'" style="flex:1;padding:8px 12px;border:1.5px solid var(--s200);border-radius:8px;font-size:12px;background:var(--card);">';
    html += optHtml;
    html += '</select>';
    html += '<button class="btn btn-primary btn-sm" onclick="saveBind(\''+escapeHtml(code)+'\')">ğŸ’¾ ä¿å­˜</button>';
    if (hasLink) {
      html += '<button class="btn btn-outline btn-sm" onclick="unbind(\''+escapeHtml(code)+'\')">è§£é™¤</button>';
    }
    html += '</div>';
    html += '</div>';
  });

  document.getElementById('bindList').innerHTML = html || '<div class="empty"><div class="icon">ğŸ“­</div><p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
}

async function saveBind(code) {
  var el = document.getElementById('bind_' + code);
  if (!el) return;
  var ocId = el.value ? parseInt(el.value) : null;

  try {
    var res = await supaPatch('pet_families', 'family_code=eq.' + encodeURIComponent(code), {
      openchat_id: ocId
    });
    if (res.ok) {
      toast(code + ' ã®OpenChatã‚’' + (ocId ? 'ç´ã¥ã‘' : 'è§£é™¤') + 'ã—ã¾ã—ãŸ', 'ok');
      loadOcBind();
    } else {
      toast('ã‚¨ãƒ©ãƒ¼: ' + await res.text(), 'err');
    }
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err'); }
}

async function unbind(code) {
  try {
    var res = await supaPatch('pet_families', 'family_code=eq.' + encodeURIComponent(code), {
      openchat_id: null
    });
    if (res.ok) {
      toast(code + ' ã®OpenChatç´ã¥ã‘ã‚’è§£é™¤ã—ã¾ã—ãŸ', 'ok');
      loadOcBind();
    } else {
      toast('ã‚¨ãƒ©ãƒ¼: ' + await res.text(), 'err');
    }
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err'); }
}

function filterBind() {
  var q = (document.getElementById('bindSearch').value || '').toLowerCase();
  var filter = document.getElementById('bindFilter').value;
  document.querySelectorAll('#bindList .quota-family-card').forEach(function(card) {
    var code = (card.getAttribute('data-code')||'').toLowerCase();
    var pets = (card.getAttribute('data-pets')||'').toLowerCase();
    var bind = card.getAttribute('data-bind') || '';
    var matchText = !q || code.indexOf(q)!==-1 || pets.indexOf(q)!==-1;
    var matchFilter = filter === 'all' || bind === filter;
    card.style.display = (matchText && matchFilter) ? '' : 'none';
  });
}

async function autoBind() {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }

  // æœªç´ã¥ã‘å®¶æ— + OpenChatä¸€è¦§ã‚’å–å¾—
  var [famTableRes, ocTableRes] = await Promise.all([
    adminFetch('table', { name: 'pet_families', limit: 500, order: 'created_at', asc: 'false' }),
    adminFetch('table', { name: 'openchats', limit: 500, order: 'name', asc: 'true' })
  ]);
  var famJson = await famTableRes.json();
  var ocJson = await ocTableRes.json();
  var allFam = (famJson.success && famJson.data) ? famJson.data.rows : [];
  var families = allFam.filter(function(f){ return !f.openchat_id; });
  if (families.length === 0) { toast('æœªç´ã¥ã‘ã®å®¶æ—ã¯ã‚ã‚Šã¾ã›ã‚“','ok'); return; }
  var openchats = (ocJson.success && ocJson.data) ? ocJson.data.rows : [];
  if (openchats.length === 0) { toast('OpenChatãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“','err'); return; }

  // ã‚¨ãƒªã‚¢ãƒãƒƒãƒãƒ³ã‚°ï¼ˆåŒå›½ + åŒã‚¨ãƒªã‚¢ï¼‰
  var count = 0;
  var promises = [];
  families.forEach(function(f) {
    var fCountry = (f.country || 'æ—¥æœ¬').trim();
    var fArea = (f.area || '').trim();
    if (!fArea) return;
    var fDetail = (f.area_detail || '').trim();
    var bestMatch = null;
    var bestScore = 0;
    openchats.forEach(function(oc) {
      var ocCountry = (oc.country || 'æ—¥æœ¬').trim();
      var ocArea = (oc.area || '').trim();
      var ocDetail = (oc.area_detail || '').trim();
      if (fCountry !== ocCountry) return; // å›½ãŒé•ãˆã°ã‚¹ã‚­ãƒƒãƒ—
      if (fArea === ocArea) {
        var score = 1; // éƒ½é“åºœçœŒä¸€è‡´
        if (fDetail && ocDetail && fDetail === ocDetail) score = 2; // å¸‚åŒºç”ºæ‘ã‚‚ä¸€è‡´
        if (score > bestScore) { bestMatch = oc; bestScore = score; }
      }
    });
    if (bestMatch) {
      count++;
      promises.push(
        supaPatch('pet_families', 'family_code=eq.' + encodeURIComponent(f.family_code), { openchat_id: bestMatch.id })
      );
    }
  });

  if (count === 0) { toast('ãƒãƒƒãƒã™ã‚‹ã‚¨ãƒªã‚¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ','err'); return; }
  if (!confirm(count + 'ä»¶ã®å®¶æ—ã‚’ã‚¨ãƒªã‚¢ã«åŸºã¥ã„ã¦è‡ªå‹•ç´ã¥ã‘ã—ã¾ã™ã‹ï¼Ÿ')) return;

  await Promise.all(promises);
  toast(count + 'ä»¶ã‚’è‡ªå‹•ç´ã¥ã‘ã—ã¾ã—ãŸï¼', 'ok');
  loadOcBind();
}

// â•â•â• OpenChaté‹å–¶: æ—¥æ¬¡ãƒ‘ãƒãƒ« â•â•â•
async function loadOcDaily() {
  if (!connected) return;
  try {
    var [ocTableRes, postTableRes, modTableRes] = await Promise.all([
      adminFetch('table', { name: 'openchats', limit: 500, order: 'name', asc: 'true' }),
      adminFetch('table', { name: 'oc_post_log', limit: 500, order: 'posted_at', asc: 'false' }),
      adminFetch('table', { name: 'oc_mod_log', limit: 500, order: 'reported_at', asc: 'false' })
    ]);
    var ocJson = await ocTableRes.json();
    var postJson = await postTableRes.json();
    var modJson = await modTableRes.json();
    var ocs = (ocJson.success && ocJson.data) ? ocJson.data.rows : [];
    var allPosts = (postJson.success && postJson.data) ? postJson.data.rows : [];
    var allMods = (modJson.success && modJson.data) ? modJson.data.rows : [];
    document.getElementById('od-groups').textContent = ocs.length;

    // ä»Šæ—¥ã®æŠ•ç¨¿æ•°
    var today = new Date().toISOString().substring(0,10);
    var todayPosts = allPosts.filter(function(p){ return p.posted_at && p.posted_at.substring(0,10) >= today; });
    document.getElementById('od-today-posts').textContent = todayPosts.length;

    // æœªãƒ¬ãƒãƒ¼ãƒˆç¾¤ï¼ˆä»Šæ—¥ã¾ã ãƒ¬ãƒãƒ¼ãƒˆã—ã¦ãªã„ç¾¤ï¼‰
    var pending = 0;
    ocs.forEach(function(oc) {
      if (!oc.last_report_at || oc.last_report_at.substring(0,10) < today) pending++;
    });
    document.getElementById('od-pending').textContent = pending;

    // ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä»¶æ•°
    var todayMods = allMods.filter(function(m){ return m.reported_at && m.reported_at.substring(0,10) >= today; });
    document.getElementById('od-mod').textContent = todayMods.length;

    // ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    renderDailyStatus(ocs, today);
  } catch(e) {}
}

function renderDailyStatus(ocs, today) {
  if (ocs.length === 0) {
    document.getElementById('ocDailyStatus').innerHTML = '<div class="empty"><div class="icon">ğŸ“­</div><p>OpenChatãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p></div>';
    return;
  }
  var phases = {seed:'ğŸŒ± ä½œæˆ',nurture:'ğŸŒ¿ è‚²æˆ',selfrun:'ğŸŒ³ è‡ªèµ°',split:'ğŸ”€ åˆ†å‰²æ¤œè¨',archived:'ğŸ“¦ çµ‚äº†'};
  var phaseColors = {seed:'#E0F2FE',nurture:'#E8F8ED',selfrun:'#FFF8EE',split:'#FFF0F2',archived:'#F3F4F6'};
  var html = '<table style="width:100%;border-collapse:collapse;font-size:12px;">';
  html += '<thead><tr><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);">ã‚°ãƒ«ãƒ¼ãƒ—</th><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);">ãƒ•ã‚§ãƒ¼ã‚º</th><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);">äººæ•°</th><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);">æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ</th><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);">æœ€çµ‚è©±é¡Œ</th><th style="padding:8px 12px;text-align:left;background:var(--s50);border-bottom:2px solid var(--s200);">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th></tr></thead><tbody>';
  ocs.forEach(function(oc) {
    var phase = oc.phase || 'seed';
    var repOk = oc.last_report_at && oc.last_report_at.substring(0,10) >= today;
    var lastRep = oc.last_report_at ? oc.last_report_at.substring(0,10) : 'â€”';
    var lastTop = oc.last_topic_at ? oc.last_topic_at.substring(0,10) : 'â€”';
    html += '<tr>';
    html += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);"><strong>'+escapeHtml(oc.name)+'</strong></td>';
    html += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);"><span style="background:'+phaseColors[phase]+';padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700;">'+(phases[phase]||phase)+'</span></td>';
    html += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);">'+oc.member_count+'</td>';
    html += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);">'+(repOk ? '<span style="color:var(--teal-d);font-weight:700;">âœ… '+lastRep+'</span>' : '<span style="color:var(--rose);font-weight:700;">âš ï¸ '+lastRep+'</span>')+'</td>';
    html += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);">'+lastTop+'</td>';
    html += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);">';
    if (!repOk) html += '<button class="btn btn-primary btn-sm" onclick="quickPostReport('+oc.id+')">ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆæŠ•ç¨¿æ¸ˆ</button> ';
    if (oc.url) html += '<a href="'+escapeHtml(oc.url)+'" target="_blank" class="btn btn-outline btn-sm" style="text-decoration:none;">ğŸ”— é–‹ã</a>';
    html += '</td></tr>';
  });
  html += '</tbody></table>';
  document.getElementById('ocDailyStatus').innerHTML = html;
}

async function quickPostReport(ocId) {
  if (!connected) return;
  try {
    await adminPost('insert',{table:'oc_post_log',data:{openchat_id:ocId,post_type:'daily_report',content:'æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆæŠ•ç¨¿',posted_by:currentUser?currentUser.display_name:'ç®¡ç†è€…'}});
    await supaPatch('openchats','id=eq.'+ocId,{last_report_at:new Date().toISOString()});
    toast('ãƒ¬ãƒãƒ¼ãƒˆæŠ•ç¨¿ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ','ok');
    loadOcDaily();
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message,'err'); }
}

function toggleOpsCheck(el) {
  var ck = el.querySelector('.ck');
  if (ck.classList.contains('done')) { ck.classList.remove('done'); el.classList.remove('is-done'); }
  else { ck.classList.add('done'); el.classList.add('is-done'); }
}
function resetDailyChecks() {
  document.querySelectorAll('#tab-oc_daily .ck').forEach(function(c){c.classList.remove('done');});
  document.querySelectorAll('#tab-oc_daily .ops-check').forEach(function(c){c.classList.remove('is-done');});
}

// â•â•â• OpenChaté‹å–¶: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ â•â•â•
var TMPL_DATA = [
  {id:'OC-01',title:'æ—¥æ¬¡å…ƒæ°—ãƒ¬ãƒãƒ¼ãƒˆ',bg:'#06c755',type:'daily_report',freq:'æ¯æ—¥ 8:30',
    text:'ğŸ¾ {date} {area}ãƒšãƒƒãƒˆå…ƒæ°—ãƒ¬ãƒãƒ¼ãƒˆ\n\nâœ… ä»Šæ—¥ã®å…ƒæ°—ãƒã‚§ãƒƒã‚¯ï¼š{total}åŒ¹\nğŸ• çŠ¬ {dog}åŒ¹ ï½œ ğŸˆ çŒ« {cat}åŒ¹ ï½œ ğŸ¾ ãã®ä»– {other}åŒ¹\n\nğŸ”¥ é€£ç¶šæœ€é•·ï¼š{topPet}ï¼ˆDay {topDays}ï¼ï¼‰\nğŸ†• ä»Šæ—¥ã®æ–°ãƒ¡ãƒ³ãƒãƒ¼ï¼š{new}åŒ¹\nâš ï¸ ã¡ã‚‡ã£ã¨å¿ƒé…ï¼š{worry}åŒ¹ï¼ˆãŠå¤§äº‹ã« ğŸ’›ï¼‰\n\nã¿ã‚“ãªä»Šæ—¥ã‚‚å…ƒæ°—ã§éã”ã—ã¾ã—ã‚‡ã†ï¼'},
  {id:'OC-02',title:'é€±é–“ãƒ¬ãƒãƒ¼ãƒˆ',bg:'#06c755',type:'weekly_report',freq:'æ¯é€±æœˆæ›œ 9:00',
    text:'ğŸ“Š {area} é€±é–“å…ƒæ°—ãƒ¬ãƒãƒ¼ãƒˆ\n{dateRange}\n\nğŸ“ˆ ä»Šé€±ã®å…ƒæ°—ç‡æœ€é«˜æ—¥ï¼š{bestDay}ï¼ˆ{bestRate}%ï¼‰\nğŸ“‰ æœ€ä½æ—¥ï¼š{worstDay}ï¼ˆ{worstRate}%ï¼‰\n\nğŸ† é€£ç¶šæ‰“åˆ»ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP3\nã€€ğŸ¥‡ {top1}\nã€€ğŸ¥ˆ {top2}\nã€€ğŸ¥‰ {top3}\n\nğŸ†• ä»Šé€±ã®æ–°ãƒ¡ãƒ³ãƒãƒ¼ï¼š{newWeek}åŒ¹\nğŸ“Š ç´¯è¨ˆãƒ¡ãƒ³ãƒãƒ¼ï¼š{total}åŒ¹\n\nä»Šé€±ã‚‚ã¿ã‚“ãªã§å…ƒæ°—ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼ğŸ¾'},
  {id:'WC-01',title:'ğŸ†• æ–°ãƒ¡ãƒ³ãƒãƒ¼æ­“è¿',bg:'#2ECDA7',type:'welcome',freq:'éšæ™‚',
    text:'ğŸ¾ ã€‡ã€‡ã¡ã‚ƒã‚“ã®é£¼ã„ä¸»ã•ã‚“ã€ã‚ˆã†ã“ãï¼\n\nPawBonã®å…ƒæ°—ãƒã‚§ãƒƒã‚¯ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸\nã‚ˆã†ã“ãã€œï¼ğŸ‰\n\næ¯æ—¥ã®ã€Œå…ƒæ°—ã§ã™ã‹ï¼Ÿã€ã§\nã€‡ã€‡ã¡ã‚ƒã‚“ã®å¥åº·ã‚’ä¸€ç·’ã«è¦‹å®ˆã‚Šã¾ã—ã‚‡ã† ğŸ’›\n\næ°—è»½ã«å†™çœŸã‚„ãŠæ•£æ­©ã®è©±ã‚‚\nã‚·ã‚§ã‚¢ã—ã¦ãã ã•ã„ã­ï¼\n\nã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ ğŸ•âœ¨'},
  {id:'AW-01',title:'ğŸ¥‰ 7æ—¥é€£ç¶šé”æˆ',bg:'#FFB347',type:'achievement',freq:'é”æˆæ™‚',
    text:'ğŸ‰ 7æ—¥é€£ç¶šé”æˆï¼\n\nğŸ¾ ã€‡ã€‡ã¡ã‚ƒã‚“ãŒ\n7æ—¥é€£ç¶šã§å…ƒæ°—ãƒã‚§ãƒƒã‚¯ã‚’é”æˆã—ã¾ã—ãŸï¼\n\nğŸ¥‰ã€Œå…ƒæ°—ãƒ«ãƒ¼ã‚­ãƒ¼ã€ãƒãƒƒã‚¸ç²å¾— âœ¨\n\n1é€±é–“ç¶šã‘ã‚‹ã®ã¯ã™ã”ã„ã“ã¨ï¼\nã“ã®èª¿å­ã§30æ—¥ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã† ğŸ”¥'},
  {id:'AW-02',title:'ğŸ¥ˆ 30æ—¥é€£ç¶šé”æˆ',bg:'#FF7B54',type:'achievement',freq:'é”æˆæ™‚',
    text:'ğŸ‰ğŸ‰ğŸ‰\n\nãŠ—ï¸ 30æ—¥é€£ç¶šé”æˆï¼\n\nğŸ¾ ã€‡ã€‡ã¡ã‚ƒã‚“ãŒ\n30æ—¥é€£ç¶šå…ƒæ°—ãƒã‚§ãƒƒã‚¯ã‚’é”æˆã—ã¾ã—ãŸï¼\n\nğŸ¥ˆã€Œå…ƒæ°—ãƒã‚¹ã‚¿ãƒ¼ã€ãƒãƒƒã‚¸ç²å¾— âœ¨\n\né£¼ã„ä¸»ã•ã‚“ã®æ¯æ—¥ã®æ„›æƒ…ãŒ\nå®¶æ—ã«å±Šã„ã¦ã„ã¾ã™ ğŸ’Œ\n\næ¬¡ã®ç›®æ¨™ã¯ 100æ—¥ï¼å¿œæ´ã—ã¦ã¾ã™ ğŸ”¥'},
  {id:'AW-03',title:'ğŸ¥‡ 100æ—¥é€£ç¶šé”æˆ',bg:'#E8475F',type:'achievement',freq:'é”æˆæ™‚',
    text:'ğŸŠğŸŠğŸŠğŸŠğŸŠ\n\nğŸ† 100æ—¥é€£ç¶šé”æˆï¼ï¼\n\nğŸ¾ ã€‡ã€‡ã¡ã‚ƒã‚“ãŒ\n100æ—¥é€£ç¶šå…ƒæ°—ãƒã‚§ãƒƒã‚¯ã‚’é”æˆï¼ï¼\n\nğŸ¥‡ã€Œå…ƒæ°—ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã€ãƒãƒƒã‚¸ç²å¾— âœ¨âœ¨\n\n100æ—¥é–“æ¯æ—¥ç¶šã‘ã‚‹ãªã‚“ã¦\næœ¬å½“ã«ã™ã”ã„ã§ã™ï¼ï¼\n\næ¬¡ã¯ã„ã‚ˆã„ã‚ˆ 365æ—¥â€¦ï¼\nä¼èª¬ã‚’ä½œã‚Šã¾ã—ã‚‡ã† ğŸŒŸ'},
  {id:'AW-04',title:'ğŸ… 365æ—¥ æ®¿å ‚å…¥ã‚Š',bg:'linear-gradient(135deg,#E8475F,#FF7B54)',type:'achievement',freq:'é”æˆæ™‚',
    text:'ğŸ…âœ¨ğŸ…âœ¨ğŸ…âœ¨ğŸ…\n\nğŸ‘‘ 365æ—¥é€£ç¶šé”æˆ\nã€œ æ®¿å ‚å…¥ã‚Š ã€œ\n\nğŸ¾ ã€‡ã€‡ã¡ã‚ƒã‚“ãŒ\n1å¹´é–“æ¯æ—¥æ¬ ã‹ã•ãš\nå…ƒæ°—ãƒã‚§ãƒƒã‚¯ã‚’ç¶šã‘ã¾ã—ãŸï¼ï¼\n\nğŸ…ã€Œæ®¿å ‚å…¥ã‚Šã€èªå®š âœ¨âœ¨âœ¨\n\nPawBonã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®èª‡ã‚Šã§ã™ï¼\n\nğŸ ç‰¹åˆ¥ãªè¨˜å¿µå“ã‚’ã”ç”¨æ„ã—ã¦ã„ã¾ã™\nç®¡ç†è€…ã«DMãã ã•ã„ ğŸ’Œ\n\nãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ï¼ğŸŠğŸŠğŸŠ'}
];

var MORNING_GREETINGS = [
  'â˜€ï¸ ä»Šæ—¥ã‚‚ã„ã„ãŠå¤©æ°—ã§ã™ã­ã€ãŠæ•£æ­©æ—¥å’Œï¼','ğŸŒ¸ æ¡œãŒãã‚Œã„ãªå­£ç¯€ã§ã™ã­ã€œ','ğŸŒ§ï¸ é›¨ã§ã™ãŒã€å®¤å†…ã§ã¾ã£ãŸã‚Šã‚‚è‰¯ã„ã§ã™ã‚ˆã­',
  'ğŸ‚ ç§‹ã®é¢¨ãŒæ°—æŒã¡ã„ã„ï¼ãŠæ•£æ­©ãŒæ¥½ã—ã„å­£ç¯€','â„ï¸ å¯’ããªã£ã¦ãã¾ã—ãŸã€é˜²å¯’å¯¾ç­–ãƒãƒƒãƒãƒªã§ã™ã‹ï¼Ÿ',
  'ğŸŒˆ é›¨ä¸ŠãŒã‚Šã®è™¹ã€è¦‹ã¾ã—ãŸã‹ï¼Ÿ','ğŸŒ¤ï¸ å°‘ã—é›²ãŒã‚ã‚Šã¾ã™ãŒéã”ã—ã‚„ã™ã„æ—¥ã§ã™ã­',
  'ğŸŒ æ—¥å·®ã—ãŒå¼·ã„ã§ã™ã€‚ãƒšãƒƒãƒˆã®ç†±ä¸­ç—‡ã«æ°—ã‚’ã¤ã‘ã¦ï¼','ğŸ’¨ é¢¨ãŒå¼·ã„æ—¥ã¯é£›æ¥ç‰©ã«æ³¨æ„ã§ã™ã­','ğŸŒ™ æ˜¨å¤œã¯è‰¯ã„æœˆã§ã—ãŸã­ã€œ'
];

function loadTmplTab() {
  // æŠ•ç¨¿å…ˆã‚»ãƒ¬ã‚¯ãƒˆæ›´æ–°
  var sel = document.getElementById('tmplTarget');
  sel.innerHTML = '<option value="">OpenChatã‚’é¸æŠ...</option>';
  if (Array.isArray(allOpenchats)) {
    allOpenchats.forEach(function(oc) {
      sel.innerHTML += '<option value="'+oc.id+'" data-url="'+(oc.url||'')+'">'+escapeHtml(oc.name)+'</option>';
    });
  }

  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæç”»
  var html = '';
  TMPL_DATA.forEach(function(t) {
    html += '<div class="tmpl-card">';
    html += '<div class="tmpl-head" style="background:'+t.bg+';"><span class="tmpl-id">'+t.id+'</span>'+escapeHtml(t.title)+'<span style="margin-left:auto;font-size:10px;opacity:.8;">'+t.freq+'</span></div>';
    html += '<div class="tmpl-content" id="tmpl-'+t.id+'">'+escapeHtml(t.text)+'</div>';
    html += '<div class="tmpl-foot">';
    html += '<button class="btn btn-primary btn-sm" onclick="copyText(\'tmpl-'+t.id+'\')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>';
    html += '<button class="btn btn-outline btn-sm" onclick="logPost(\''+t.type+'\',\''+t.id+'\')">âœ… æŠ•ç¨¿æ¸ˆ</button>';
    html += '</div></div>';
  });

  // æœã®ä¸€è¨€
  html += '<div class="tmpl-card">';
  html += '<div class="tmpl-head" style="background:var(--s500);"><span class="tmpl-id">MISC</span>ğŸŒ… æœã®ä¸€è¨€ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰</div>';
  var rndIdx = Math.floor(Math.random()*MORNING_GREETINGS.length);
  html += '<div class="tmpl-content" id="tmpl-morning">'+escapeHtml(MORNING_GREETINGS[rndIdx])+'</div>';
  html += '<div class="tmpl-foot"><button class="btn btn-primary btn-sm" onclick="copyText(\'tmpl-morning\')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>';
  html += '<button class="btn btn-outline btn-sm" onclick="shuffleMorning()">ğŸ”„ åˆ¥ã®ä¸€è¨€</button></div></div>';

  document.getElementById('tmplContainer').innerHTML = html;
  loadPostLog();
}

function shuffleMorning() {
  var idx = Math.floor(Math.random()*MORNING_GREETINGS.length);
  document.getElementById('tmpl-morning').textContent = MORNING_GREETINGS[idx];
}

async function onTmplTargetChange() {
  var sel = document.getElementById('tmplTarget');
  var opt = sel.options[sel.selectedIndex];
  var url = opt ? opt.getAttribute('data-url') : '';
  document.getElementById('tmplOpenLink').style.display = url ? '' : 'none';

  var ocId = sel.value;
  if (!ocId || !connected) return;

  // é¸æŠã—ãŸOCã®æƒ…å ±
  var oc = allOpenchats.find(function(o){ return o.id == ocId; });
  var area = oc ? (oc.area_detail || oc.area || '') : '';

  // ã“ã®OCã«ç´ã¥ãå®¶æ—ã®æ‰“åˆ»ãƒ‡ãƒ¼ã‚¿å–å¾—
  var todayStr = new Date().toISOString().substring(0,10);
  var stats = { total:0, dog:0, cat:0, other:0, worry:0, newToday:0, topPet:'---', topDays:0 };

  try {
    // OCç´ã¥ã‘å®¶æ—ã‚’å–å¾—
    var famRes = await supaFetch('/rest/v1/pet_families?openchat_id=eq.'+ocId+'&select=family_code,pet_names,breeds,created_at');
    var families = await famRes.json();
    if (!Array.isArray(families)) families = [];
    var codes = families.map(function(f){ return f.family_code; });

    if (codes.length > 0) {
      // ä»Šæ—¥ã®æ‰“åˆ»ã‚’å–å¾—
      var ckRes = await supaFetch('/rest/v1/checkins?checkin_date=eq.'+todayStr+'&family_code=in.('+codes.map(encodeURIComponent).join(',')+')&select=family_code,status,worried_pets');
      var checkins = await ckRes.json();
      if (!Array.isArray(checkins)) checkins = [];

      // é‡è¤‡é™¤å¤–ï¼ˆfamily_codeå˜ä½ã§é›†è¨ˆï¼‰
      var checked = {};
      checkins.forEach(function(c){
        if (!checked[c.family_code]) {
          checked[c.family_code] = c;
          stats.total++;
          if (c.status === 'worry') stats.worry++;
        }
      });

      // çŠ¬çŒ«åˆ†é¡
      var dogPattern = /çŠ¬|ãƒ‰ãƒƒã‚°|ãƒ†ãƒªã‚¢|ãƒ–ãƒ«|ãƒ¬ãƒˆãƒªãƒãƒ¼|ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰|ãƒ—ãƒ¼ãƒ‰ãƒ«|ãƒã‚¹ã‚­ãƒ¼|ã‚³ãƒ¼ã‚®ãƒ¼|æŸ´|ç§‹ç”°|mix|ãƒ€ãƒƒã‚¯ã‚¹|ãƒãƒ¯ãƒ¯|ãƒãƒ¡ãƒ©ãƒ‹ã‚¢ãƒ³|ãƒ•ãƒ¬ãƒ³ãƒ|ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³/i;
      var catPattern = /çŒ«|ã‚­ãƒ£ãƒƒãƒˆ|ãƒšãƒ«ã‚·ãƒ£|ã‚·ãƒ£ãƒ |ãƒ™ãƒ³ã‚¬ãƒ«|ã‚¹ã‚³ãƒ†ã‚£ãƒƒã‚·ãƒ¥|ãƒãƒ³ãƒã‚«ãƒ³|ã‚¢ãƒ¡ãƒªã‚«ãƒ³ã‚·ãƒ§ãƒ¼ãƒˆ|ãƒ©ã‚°ãƒ‰ãƒ¼ãƒ«/i;
      families.forEach(function(f){
        var breed = (f.breeds || '');
        if (dogPattern.test(breed)) stats.dog++;
        else if (catPattern.test(breed)) stats.cat++;
        else stats.other++;
      });

      // ä»Šæ—¥ç™»éŒ²ã®æ–°ãƒ¡ãƒ³ãƒãƒ¼
      families.forEach(function(f){
        if (f.created_at && f.created_at.substring(0,10) === todayStr) stats.newToday++;
      });

      // é€£ç¶šæœ€é•·ã‚’å–å¾—
      try {
        var streakRes = await supaFetch('/rest/v1/checkins?family_code=in.('+codes.map(encodeURIComponent).join(',')+')&select=family_code,streak_days&order=streak_days.desc.nullslast&limit=1');
        var streakData = await streakRes.json();
        if (Array.isArray(streakData) && streakData.length > 0 && streakData[0].streak_days) {
          var topFam = families.find(function(f){ return f.family_code === streakData[0].family_code; });
          stats.topPet = topFam ? topFam.pet_names : '---';
          stats.topDays = streakData[0].streak_days || 0;
        }
      } catch(se) {}
    }
  } catch(e) {
    console.error('Template data fetch error:', e);
  }

  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã‚’å®Ÿãƒ‡ãƒ¼ã‚¿ã§ç½®æ›
  var dateStr = todayStr.replace(/-/g, '/');
  TMPL_DATA.forEach(function(t) {
    var el = document.getElementById('tmpl-' + t.id);
    if (!el) return;
    var text = t.text
      .replace(/\{date\}/g, dateStr)
      .replace(/\{area\}/g, area)
      .replace(/\{total\}/g, stats.total)
      .replace(/\{dog\}/g, stats.dog)
      .replace(/\{cat\}/g, stats.cat)
      .replace(/\{other\}/g, stats.other)
      .replace(/\{worry\}/g, stats.worry)
      .replace(/\{new\}/g, stats.newToday)
      .replace(/\{topPet\}/g, stats.topPet)
      .replace(/\{topDays\}/g, stats.topDays);
    el.textContent = text;
  });

  toast('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸ âœ…', 'ok');
}
function openTmplTarget() {
  var sel = document.getElementById('tmplTarget');
  var opt = sel.options[sel.selectedIndex];
  var url = opt ? opt.getAttribute('data-url') : '';
  if (url) window.open(url,'_blank');
}

async function logPost(type, tmplId) {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }
  var ocId = document.getElementById('tmplTarget').value;
  if (!ocId) { toast('æŠ•ç¨¿å…ˆã®OpenChatã‚’é¸æŠã—ã¦ãã ã•ã„','err'); return; }
  try {
    await adminPost('insert',{table:'oc_post_log',data:{openchat_id:parseInt(ocId),post_type:type,content:tmplId+'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æŠ•ç¨¿',posted_by:currentUser?currentUser.display_name:'ç®¡ç†è€…'}});
    // ãƒ¬ãƒãƒ¼ãƒˆç³»ãªã‚‰ last_report_at æ›´æ–°
    if (type==='daily_report'||type==='weekly_report') {
      await supaPatch('openchats','id=eq.'+ocId,{last_report_at:new Date().toISOString()});
    }
    if (type==='topic') {
      await supaPatch('openchats','id=eq.'+ocId,{last_topic_at:new Date().toISOString()});
    }
    toast('æŠ•ç¨¿ãƒ­ã‚°ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ âœ…','ok');
    loadPostLog();
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message,'err'); }
}

async function loadPostLog() {
  if (!connected) return;
  try {
    var postRes = await adminFetch('table', { name: 'oc_post_log', limit: 20, order: 'posted_at', asc: 'false' });
    var postJson = await postRes.json();
    var logs = (postJson.success && postJson.data) ? postJson.data.rows : [];
    if (!Array.isArray(logs) || logs.length === 0) {
      document.getElementById('postLogList').innerHTML = '<div style="color:var(--s400);font-size:12px;padding:8px;">æŠ•ç¨¿ãƒ­ã‚°ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
      return;
    }
    var typeLabels = {daily_report:'ğŸ“ˆ æ—¥æ¬¡',weekly_report:'ğŸ“Š é€±é–“',achievement:'ğŸ† è¡¨å½°',welcome:'ğŸ†• æ­“è¿',topic:'ğŸ’¬ è©±é¡Œ',announcement:'ğŸ“¢ å‘ŠçŸ¥',moderation:'ğŸ›¡ï¸ ãƒ¢ãƒ‡'};
    var typeClasses = {daily_report:'ptype-daily',weekly_report:'ptype-weekly',achievement:'ptype-achieve',welcome:'ptype-welcome',topic:'ptype-topic',announcement:'ptype-announce'};
    var html = '';
    logs.forEach(function(l) {
      html += '<div class="post-log-item">';
      html += '<span class="ptime">'+(l.posted_at?l.posted_at.substring(5,16).replace('T',' '):'')+'</span>';
      html += '<span class="ptype '+(typeClasses[l.post_type]||'')+'">'+(typeLabels[l.post_type]||l.post_type)+'</span>';
      html += '<span style="flex:1;">'+escapeHtml(l.openchats?l.openchats.name:'ID:'+l.openchat_id)+'</span>';
      html += '<span style="color:var(--s400);">'+escapeHtml(l.posted_by||'')+'</span>';
      html += '</div>';
    });
    document.getElementById('postLogList').innerHTML = html;
  } catch(e) {}
}

// â•â•â• OpenChaté‹å–¶: è©±é¡Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ â•â•â•
var WEEKLY_TOPICS = [
  {day:1,label:'æœˆæ›œ MON',topic:'ğŸ“Š é€±é–“ãƒ¬ãƒãƒ¼ãƒˆ',example:'å…ˆé€±ã®ãƒ‡ãƒ¼ã‚¿ã¨ä»Šé€±ã®ç›®æ¨™ã€‚ã€Œå…ˆé€±ã¯98%ã®å­ãŒå…ƒæ°—ã§ã—ãŸï¼ä»Šé€±ã‚‚é ‘å¼µã‚ã†ã€',type:'semi',hasTopic:true},
  {day:2,label:'ç«æ›œ TUE',topic:'â€” ãƒ¬ãƒãƒ¼ãƒˆã®ã¿',example:'è¿½åŠ æŠ•ç¨¿ãªã—ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç„¶ãªå¯¾è©±ã‚’è¦‹å®ˆã‚‹æ—¥ã€‚',type:'',hasTopic:false},
  {day:3,label:'æ°´æ›œ WED',topic:'ğŸ’¬ ãŠæ•£æ­©ãƒˆãƒ¼ã‚¯',example:'ã€Œä»Šæ—¥ã®ãŠæ•£æ­©ã¯ã©ã“è¡Œãã¾ã—ãŸã‹ï¼ŸãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆãŒã‚ã‚Œã°æ•™ãˆã¦ï¼ğŸ•ã€',type:'manual',hasTopic:true},
  {day:4,label:'æœ¨æ›œ THU',topic:'â€” ãƒ¬ãƒãƒ¼ãƒˆã®ã¿',example:'è¿½åŠ æŠ•ç¨¿ãªã—ã€‚é™ã‹ã«å¯¾è©±ã‚’è¦‹å®ˆã‚‹ã€‚',type:'',hasTopic:false},
  {day:5,label:'é‡‘æ›œ FRI',topic:'ğŸ‰ é€±æœ«ã®ãŠæ¥½ã—ã¿',example:'ã€Œé€±æœ«ã®ãŠå‡ºã‹ã‘äºˆå®šã‚ã‚Šã¾ã™ã‹ï¼Ÿãƒ‰ãƒƒã‚°ãƒ©ãƒ³è¡Œãæ–¹ã„ã‚‹ã‹ãªï¼ŸğŸ¾ã€',type:'manual',hasTopic:true},
  {day:6,label:'åœŸæ›œ SAT',topic:'â€” ãƒ¬ãƒãƒ¼ãƒˆã®ã¿',example:'ãŠå‡ºã‹ã‘å ±å‘ŠãŒã‚ã‚Œã°ç©æ¥µçš„ã«ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚',type:'',hasTopic:false},
  {day:0,label:'æ—¥æ›œ SUN',topic:'ğŸ“¸ å†™çœŸã‚¿ã‚¤ãƒ ',example:'ã€Œä»Šé€±ã®ãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆã€ã‚ã‚Œã°è¦‹ã›ã¦ï¼ğŸ“¸ ã†ã¡ã®å­ã¯ã“ã‚“ãªé¡”ã—ã¦ã¾ã—ãŸï¼ˆç¬‘ï¼‰ã€',type:'manual',hasTopic:true}
];

var TOPIC_STOCK = [
  {cat:'ğŸŒ¸ å­£ç¯€',text:'æ¡œã®å­£ç¯€ã§ã™ã­ã€ãŠèŠ±è¦‹æ•£æ­©ã—ãŸæ–¹ã„ã¾ã™ã‹ï¼Ÿ',timing:'å­£ç¯€ã®å¤‰ã‚ã‚Šç›®'},
  {cat:'ğŸ¥ å¥åº·',text:'ãƒ•ã‚£ãƒ©ãƒªã‚¢äºˆé˜²ã®å­£ç¯€ã§ã™ã­ï¼ã¿ãªã•ã‚“ã‚‚ã†å§‹ã‚ã¾ã—ãŸã‹ï¼Ÿ',timing:'æ˜¥ã€œå¤å‰'},
  {cat:'ğŸ½ï¸ ãƒ•ãƒ¼ãƒ‰',text:'ãŠã™ã™ã‚ã®ãƒ•ãƒ¼ãƒ‰ã‚„ãŠã‚„ã¤ã€ã‚ã‚Šã¾ã™ã‹ï¼Ÿã†ã¡ã®å­ã¯ã€‡ã€‡ãŒå¥½ãã§ã™',timing:'ã„ã¤ã§ã‚‚'},
  {cat:'ğŸ® éŠã³',text:'é›¨ã®æ—¥ã®å®¤å†…éŠã³ã€ã¿ãªã•ã‚“ã©ã†ã—ã¦ã¾ã™ã‹ï¼Ÿ',timing:'æ¢…é›¨ãƒ»é›¨ã®æ—¥'},
  {cat:'ğŸ“ ã‚¹ãƒãƒƒãƒˆ',text:'ãŠã™ã™ã‚ã®ãƒ‰ãƒƒã‚°ã‚«ãƒ•ã‚§ã‚„ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚ã‚Šã¾ã™ã‹ï¼Ÿ',timing:'é€±æœ«å‰'},
  {cat:'ğŸ’¤ æ—¥å¸¸',text:'ã†ã¡ã®å­ã®å¯é¡”ãŒé¢ç™½ã‹ã£ãŸã®ã§å…±æœ‰ï¼ˆç¬‘ï¼‰ã¿ãªã•ã‚“ã®å­ã¯ã©ã‚“ãªå¯æ–¹ï¼Ÿ',timing:'ã„ã¤ã§ã‚‚'},
  {cat:'ğŸŠ è¨˜å¿µæ—¥',text:'ä»Šæ—¥ã¯ã€‡ã€‡ã®æ—¥ï¼ãƒšãƒƒãƒˆã®ã€‡ã€‡ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦',timing:'è¨˜å¿µæ—¥'},
  {cat:'ğŸ“Š æŠ•ç¥¨',text:'çŠ¬æ´¾ï¼ŸçŒ«æ´¾ï¼Ÿãã‚Œã¨ã‚‚ä¸¡æ–¹ï¼ï¼Ÿä»Šæ—¥ã¯å¤§èª¿æŸ»ã®æ—¥ğŸ¾',timing:'ãƒã‚¿åˆ‡ã‚Œæ™‚'}
];

function loadCalendar() {
  var todayDow = new Date().getDay();
  // ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒ
  var todayTopic = null;
  WEEKLY_TOPICS.forEach(function(t) { if (t.day === todayDow) todayTopic = t; });
  if (todayTopic) {
    var content = '<div style="display:flex;gap:12px;align-items:flex-start;">';
    content += '<span style="font-size:28px;">'+(todayTopic.hasTopic?'ğŸ’¬':'ğŸ“ˆ')+'</span>';
    content += '<div><strong style="font-size:15px;">'+todayTopic.topic+'</strong>';
    content += '<div style="color:var(--s500);margin-top:4px;">'+todayTopic.example+'</div>';
    if (todayTopic.hasTopic) {
      content += '<div style="margin-top:8px;"><button class="btn btn-primary btn-sm" onclick="copyTextDirect(\''+todayTopic.example.replace(/'/g,"\\'")+'\')">ğŸ“‹ è©±é¡Œã‚’ã‚³ãƒ”ãƒ¼</button>';
      content += '<button class="btn btn-outline btn-sm" style="margin-left:8px;" onclick="logTopicPost()">âœ… æŠ•ç¨¿æ¸ˆ</button></div>';
    }
    content += '</div></div>';
    document.getElementById('calTodayContent').innerHTML = content;
    document.getElementById('calTodayTitle').textContent = 'ğŸ“Œ ä»Šæ—¥ã¯' + todayTopic.label + ' â€” ' + todayTopic.topic;
  }

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰
  var gHtml = '';
  WEEKLY_TOPICS.forEach(function(t) {
    var isToday = t.day === todayDow;
    gHtml += '<div class="cal-day '+(t.hasTopic?'has-topic':'')+'" style="'+(isToday?'box-shadow:0 0 0 2px #06c755;':'')+(t.hasTopic?'':'opacity:.7;')+'">';
    gHtml += '<div class="cal-label">'+(isToday?'ğŸ‘‰ ':'')+t.label+'</div>';
    gHtml += '<div class="cal-topic" style="'+(t.hasTopic?'':'color:var(--s400);')+'">'+t.topic+'</div>';
    gHtml += '<div class="cal-eg">'+t.example+'</div>';
    if (t.hasTopic) {
      gHtml += '<div class="cal-status"><button class="btn btn-outline btn-sm" style="font-size:10px;padding:4px 8px;" onclick="copyTextDirect(\''+t.example.replace(/'/g,"\\'")+'\')">ğŸ“‹ã‚³ãƒ”ãƒ¼</button></div>';
    }
    gHtml += '</div>';
  });
  document.getElementById('calGrid').innerHTML = gHtml;

  // è©±é¡Œã‚¹ãƒˆãƒƒã‚¯
  var sHtml = '';
  TOPIC_STOCK.forEach(function(t) {
    sHtml += '<tr><td style="padding:8px 12px;border-bottom:1px solid var(--s100);font-weight:600;">'+t.cat+'</td>';
    sHtml += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);" id="stock-'+t.cat+'">'+escapeHtml(t.text)+'</td>';
    sHtml += '<td style="padding:8px 12px;border-bottom:1px solid var(--s100);"><button class="btn btn-outline btn-sm" style="font-size:10px;padding:3px 8px;" onclick="copyTextDirect(\''+t.text.replace(/'/g,"\\'")+'\')">ğŸ“‹</button></td></tr>';
  });
  document.getElementById('topicStock').innerHTML = sHtml;
}

async function logTopicPost() {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }
  var ocId = prompt('æŠ•ç¨¿å…ˆã®OpenChat IDã‚’å…¥åŠ›ï¼ˆè¤‡æ•°ã®å ´åˆã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰:');
  if (!ocId) return;
  var ids = ocId.split(',');
  for (var i=0;i<ids.length;i++) {
    var id = parseInt(ids[i].trim());
    if (!id) continue;
    try {
      await adminPost('insert',{table:'oc_post_log',data:{openchat_id:id,post_type:'topic',content:'è©±é¡ŒæŠ•ç¨¿',posted_by:currentUser?currentUser.display_name:'ç®¡ç†è€…'}});
      await supaPatch('openchats','id=eq.'+id,{last_topic_at:new Date().toISOString()});
    } catch(e) {}
  }
  toast('è©±é¡ŒæŠ•ç¨¿ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ âœ…','ok');
}

// â•â•â• OpenChaté‹å–¶: ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ â•â•â•
function loadModOcSelect() {
  var sel = document.getElementById('modOc');
  sel.innerHTML = '<option value="">é¸æŠ...</option>';
  if (Array.isArray(allOpenchats)) {
    allOpenchats.forEach(function(oc) {
      sel.innerHTML += '<option value="'+oc.id+'">'+escapeHtml(oc.name)+'</option>';
    });
  }
}

async function saveModLog() {
  if (!connected) { toast('å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„','err'); return; }
  var ocId = document.getElementById('modOc').value;
  var sev = document.getElementById('modSev').value;
  var cat = document.getElementById('modCat').value;
  var desc = document.getElementById('modDesc').value.trim();
  var action = document.getElementById('modAction').value.trim();
  if (!desc) { toast('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„','err'); return; }
  try {
    await adminPost('insert',{table:'oc_mod_log',data:{openchat_id:ocId?parseInt(ocId):null,severity:sev,category:cat,description:desc,action_taken:action,reported_by:currentUser?currentUser.display_name:'ç®¡ç†è€…'}});
    toast('ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ','ok');
    document.getElementById('modDesc').value = '';
    document.getElementById('modAction').value = '';
    loadModLog();
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message,'err'); }
}

async function loadModLog() {
  if (!connected) return;
  try {
    var modRes = await adminFetch('table', { name: 'oc_mod_log', limit: 20, order: 'reported_at', asc: 'false' });
    var modJson = await modRes.json();
    var logs = (modJson.success && modJson.data) ? modJson.data.rows : [];
    if (!Array.isArray(logs) || logs.length === 0) {
      document.getElementById('modLogList').innerHTML = '<div style="color:var(--s400);font-size:12px;">ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ãªã—</div>';
      return;
    }
    var sevIcons = {red:'ğŸ”´',yellow:'ğŸŸ¡',info:'ğŸ”µ'};
    var sevClass = {red:'sev-red',yellow:'sev-yellow',info:'sev-info'};
    var html = '';
    logs.forEach(function(l) {
      html += '<div class="mod-card '+(sevClass[l.severity]||'')+'">';
      html += '<div class="mod-head">'+(sevIcons[l.severity]||'')+ ' '+escapeHtml(l.category||'')+'<span style="margin-left:auto;font-weight:400;font-size:10px;color:var(--s400);">'+(l.reported_at?l.reported_at.substring(0,16).replace('T',' '):'')+'</span></div>';
      html += '<div class="mod-body">';
      if (l.openchats) html += '<strong>'+escapeHtml(l.openchats.name)+'</strong> â€” ';
      html += escapeHtml(l.description||'');
      if (l.action_taken) html += '<br><span style="color:var(--teal-d);font-weight:600;">å¯¾å¿œ: '+escapeHtml(l.action_taken)+'</span>';
      html += '</div></div>';
    });
    document.getElementById('modLogList').innerHTML = html;
  } catch(e) {}
}

// â•â•â• ãƒãƒ‹ãƒ¥ã‚¢ãƒ« â•â•â•
function toggleManual(header) {
  header.classList.toggle('open');
  var body = header.nextElementSibling;
  body.classList.toggle('open');
}

// â•â•â• Util: Copy â•â•â•
function copyText(id) {
  var el = document.getElementById(id);
  if (!el) return;
  var text = el.textContent || el.innerText;
  navigator.clipboard.writeText(text).then(function(){
    showCopiedToast();
  }).catch(function(){
    var ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);
    showCopiedToast();
  });
}
function copyTextDirect(text) {
  navigator.clipboard.writeText(text).then(function(){ showCopiedToast(); }).catch(function(){
    var ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);showCopiedToast();
  });
}
function showCopiedToast() {
  var d=document.createElement('div');d.className='copied-toast';d.textContent='âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
  document.body.appendChild(d);setTimeout(function(){d.remove();},2200);
}

// â•â•â• REST Runner â•â•â•
async function runREST() {
  var path = document.getElementById('restQuery').value.trim();
  if (!path) return;
  var container = document.getElementById('restResult');
  container.innerHTML = '<div class="loading"><span class="spinner"></span>å®Ÿè¡Œä¸­...</div>';
  try {
    var res = await supaFetch(path);
    var data = await res.json();
    if (!Array.isArray(data)||data.length===0) {
      container.innerHTML='<div style="padding:12px;color:var(--s400);">çµæœ: 0ä»¶</div><pre style="font-size:11px;color:var(--s500);overflow:auto;">'+JSON.stringify(data,null,2)+'</pre>';
      return;
    }
    var cols = Object.keys(data[0]);
    var html = '<div class="table-scroll"><table><thead><tr>';
    cols.forEach(function(c){ html+='<th>'+c+'</th>'; });
    html += '</tr></thead><tbody>';
    data.forEach(function(row){
      html += '<tr>';
      cols.forEach(function(c){ html+='<td>'+escapeHtml(String(row[c]===null?'':row[c]))+'</td>'; });
      html += '</tr>';
    });
    html += '</tbody></table></div>';
    container.innerHTML = html;
  } catch(e) { container.innerHTML='<div style="color:var(--rose);padding:12px;">ã‚¨ãƒ©ãƒ¼: '+e.message+'</div>'; }
}

// â•â•â• Tab Nav â•â•â•
document.querySelectorAll('.sidebar-item').forEach(function(item) {
  item.addEventListener('click', function() {
    document.querySelectorAll('.sidebar-item').forEach(function(i){ i.classList.remove('active'); });
    document.querySelectorAll('.tab-content').forEach(function(t){ t.classList.remove('active'); });
    item.classList.add('active');
    var tab = item.dataset.tab;
    document.getElementById('tab-'+tab).classList.add('active');
    if (connected) {
      if (tab === 'quota_mgmt') loadQuotaMgmt();
      else if (tab === 'openchat_list') loadOcList();
      else if (tab === 'openchat_bind') loadOcBind();
      else if (tab === 'oc_daily') { loadOcListSilent(); loadOcDaily(); }
      else if (tab === 'oc_templates') { loadOcListSilent(); loadTmplTab(); }
      else if (tab === 'oc_calendar') { loadCalendar(); }
      else if (tab === 'oc_moderation') { loadOcListSilent(); loadModOcSelect(); loadModLog(); }
      else if (tab === 'oc_manual') { /* static content */ }
      else if (tab === 'admin_users') loadAdminUsers();
      else if (tab !== 'dashboard' && tab !== 'sql') loadTable(tab);
    } else {
      // Static tabs work without connection
      if (tab === 'oc_calendar') loadCalendar();
    }
  });
});

// silent OC list load for selectors
async function loadOcListSilent() {
  if (!connected) return;
  try {
    var res = await adminFetch('table', { name: 'openchats', limit: 500, order: 'name', asc: 'true' });
    var json = await res.json();
    if (json.success && json.data) allOpenchats = json.data.rows || [];
  } catch(e) {}
}

// â•â•â• Util â•â•â•
function escapeHtml(str) { var d=document.createElement('div'); d.textContent=str; return d.innerHTML; }
function toast(msg,type) { var t=document.getElementById('toast'); t.textContent=msg; t.className='toast show '+(type||'ok'); setTimeout(function(){ t.className='toast'; },3000); }

// â•â•â• Admin Users Management â•â•â•
function showAddAdminForm() { document.getElementById('addAdminForm').style.display = 'block'; }

async function loadAdminUsers() {
  if (!connected || !currentUser || currentUser.role !== 'super_admin') return;
  var container = document.getElementById('adminUsersList');
  container.innerHTML = '<div class="loading"><span class="spinner"></span>èª­ã¿è¾¼ã¿ä¸­...</div>';
  try {
    var res = await adminFetch('manage-users');
    var json = await res.json();
    if (!json.success) { container.innerHTML='<div class="empty"><div class="icon">âš ï¸</div><p>'+escapeHtml(json.error?json.error.message:'ã‚¨ãƒ©ãƒ¼')+'</p></div>'; return; }
    var users = json.data.users || [];
    if (users.length === 0) { container.innerHTML='<div class="empty"><div class="icon">ğŸ‘¤</div><p>ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã—</p></div>'; return; }
    var html = '';
    users.forEach(function(u) {
      html += '<div class="admin-user-card">';
      html += '<span class="role-badge '+u.role+'">'+u.role+'</span>';
      html += '<div style="flex:1;"><div class="au-email">'+escapeHtml(u.email)+'</div><div class="au-name">'+escapeHtml(u.display_name||'-')+'</div></div>';
      html += '<select onchange="updateAdminRole(\''+u.id+'\',this.value)">';
      ['viewer','admin','super_admin'].forEach(function(r) {
        html += '<option value="'+r+'"'+(r===u.role?' selected':'')+'>'+r+'</option>';
      });
      html += '</select>';
      if (u.email !== currentUser.email) {
        html += ' <button class="btn btn-danger btn-sm" onclick="deleteAdminUser(\''+u.id+'\',\''+escapeHtml(u.email)+'\')">å‰Šé™¤</button>';
      }
      html += '<div style="font-size:10px;color:var(--s400);">'+((u.created_at||'').substring(0,10))+'</div>';
      html += '</div>';
    });
    container.innerHTML = html;
  } catch(e) { container.innerHTML='<div class="empty"><div class="icon">âŒ</div><p>'+e.message+'</p></div>'; }
}

async function createAdminUser() {
  var email = document.getElementById('newAdminEmail').value.trim();
  var pass = document.getElementById('newAdminPass').value;
  var name = document.getElementById('newAdminName').value.trim();
  var role = document.getElementById('newAdminRole').value;
  if (!email || !pass) { toast('ãƒ¡ãƒ¼ãƒ«ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™','err'); return; }
  if (pass.length < 6) { toast('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šå¿…è¦ã§ã™','err'); return; }
  try {
    var res = await adminPost('manage-users', { sub_action: 'create', email: email, password: pass, display_name: name, role: role });
    var json = await res.json();
    if (json.success) {
      toast('ç®¡ç†è€…ã‚’ä½œæˆã—ã¾ã—ãŸ: '+email, 'ok');
      document.getElementById('addAdminForm').style.display = 'none';
      document.getElementById('newAdminEmail').value = '';
      document.getElementById('newAdminPass').value = '';
      document.getElementById('newAdminName').value = '';
      loadAdminUsers();
    } else { toast(json.error?json.error.message:'ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'err'); }
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err'); }
}

async function updateAdminRole(userId, newRole) {
  try {
    var res = await adminPost('manage-users', { sub_action: 'update', user_id: userId, role: newRole });
    var json = await res.json();
    if (json.success) { toast('ãƒ­ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'ok'); loadAdminUsers(); }
    else { toast(json.error?json.error.message:'æ›´æ–°å¤±æ•—', 'err'); loadAdminUsers(); }
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err'); }
}

async function deleteAdminUser(userId, email) {
  if (!confirm('ç®¡ç†è€…ã€Œ'+email+'ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  try {
    var res = await adminPost('manage-users', { sub_action: 'delete', user_id: userId });
    var json = await res.json();
    if (json.success) { toast('ç®¡ç†è€…ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'ok'); loadAdminUsers(); }
    else { toast(json.error?json.error.message:'å‰Šé™¤å¤±æ•—', 'err'); }
  } catch(e) { toast('ã‚¨ãƒ©ãƒ¼: '+e.message, 'err'); }
}

// â•â•â• Init â•â•â•
window.addEventListener('DOMContentLoaded', function() {
  // API_BASE ã‚’è‡ªå‹•è¨­å®šï¼ˆGitHub Pages â†’ Supabase Edge Functionï¼‰
  API_BASE = 'https://yxtenqytvbmmbrzcllqk.supabase.co/functions/v1/api-admin';

  // æ—¢å­˜ JWT ã§è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ
  var jwt = localStorage.getItem('admin_jwt');
  var userJson = localStorage.getItem('admin_user');
  if (jwt && userJson) {
    try {
      var user = JSON.parse(userJson);
      // JWT æœ‰åŠ¹æ€§ç¢ºèª
      adminFetch('me').then(function(res) {
        return res.json();
      }).then(function(json) {
        if (json.success) {
          onLoginSuccess(json.data);
        } else {
          // JWT æœŸé™åˆ‡ã‚Œ â†’ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¡¨ç¤º
          localStorage.removeItem('admin_jwt');
          localStorage.removeItem('admin_user');
          document.getElementById('loginOverlay').style.display = 'flex';
        }
      }).catch(function() {
        document.getElementById('loginOverlay').style.display = 'flex';
      });
    } catch(e) {
      document.getElementById('loginOverlay').style.display = 'flex';
    }
  } else {
    document.getElementById('loginOverlay').style.display = 'flex';
  }
});

// â•â•â• Changelog â•â•â•
var CHANGELOG = [
  {
    ver: 'v0.6.0', date: '2026-02-22', current: true,
    title: 'ç®¡ç†è€…èªè¨¼ & ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡',
    changes: [
      { type: 'feat', text: 'Supabase Auth (email/password) ã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ã‚’è¿½åŠ ' },
      { type: 'feat', text: 'ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ (RBAC): super_admin / admin / viewer' },
      { type: 'feat', text: 'ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ (super_admin ã®ã¿): è¿½åŠ ãƒ»ãƒ­ãƒ¼ãƒ«å¤‰æ›´ãƒ»å‰Šé™¤' },
      { type: 'feat', text: 'api-admin Edge Function: èªè¨¼ + ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ã‚­ã‚· API' },
      { type: 'feat', text: 'admin_users ãƒ†ãƒ¼ãƒ–ãƒ«: ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ç®¡ç†' },
      { type: 'improve', text: 'ANON KEY æ‰‹å‹•å…¥åŠ›ã‚’å»ƒæ­¢ â†’ JWT èªè¨¼ã«ç§»è¡Œï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šï¼‰' },
      { type: 'improve', text: 'ã‚µã‚¤ãƒ‰ãƒãƒ¼é …ç›®ã®ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹è¡¨ç¤º/éè¡¨ç¤ºåˆ¶å¾¡' }
    ]
  },
  {
    ver: 'v0.5.2', date: '2026-02-20',
    title: 'DBã‚¹ã‚­ãƒ¼ãƒåŒæœŸ & ã‚«ãƒ©ãƒ ä¿®æ­£',
    changes: [
      { type: 'fix', text: 'pet_families ã‚¯ã‚¨ãƒªã® registered_at â†’ created_at ä¿®æ­£ï¼ˆå®ŸDBã‚«ãƒ©ãƒ åã«æ•´åˆï¼‰' },
      { type: 'feat', text: 'openchats: country, description, notes, phase, leader_name, last_report_at, last_topic_at ã‚«ãƒ©ãƒ è¿½åŠ ' },
      { type: 'feat', text: 'oc_post_log: posted_by ã‚«ãƒ©ãƒ è¿½åŠ ' },
      { type: 'feat', text: 'oc_mod_log: severity, category, description, action_taken, reported_by, reported_at ã‚«ãƒ©ãƒ è¿½åŠ ' },
      { type: 'improve', text: 'ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ 20260220200000_dashboard_sync.sql è¿½åŠ ã§DBæ•´åˆæ€§ã‚’ç¢ºä¿' }
    ]
  },
  {
    ver: 'v0.5.1', date: '2026-02-19',
    title: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒæœŸ & æ‰“åˆ»ãƒã‚°ä¿®æ­£',
    changes: [
      { type: 'feat', text: 'æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: OpenChaté¸æŠæ™‚ã«DBã‹ã‚‰å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å–å¾—ã—å¤‰æ•°ã‚’ç½®æ› ({area}, {total}, {dog}, {cat} ç­‰)' },
      { type: 'feat', text: 'æ›´æ–°å±¥æ­´ãƒšãƒ¼ã‚¸: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’ã‚¯ãƒªãƒƒã‚¯ã§æ›´æ–°å±¥æ­´ã‚’è¡¨ç¤º' },
      { type: 'fix', text: 'ãƒ¡ãƒ³ãƒãƒ¼æ‰“åˆ»: ãƒ¡ãƒ³ãƒãƒ¼ãŒRich Menuã‚¿ãƒƒãƒ—æ™‚ã€Œæœªç™»éŒ²ã€æ‰±ã„ã«ãªã‚‹ãƒã‚°ã‚’ä¿®æ­£ï¼ˆowner/memberåˆ¤å®šè¿½åŠ ï¼‰' },
      { type: 'fix', text: 'ãƒ¡ãƒ³ãƒãƒ¼ãƒªãƒã‚¤ãƒ³ãƒ‰: 1æ—¥1å®¶æ—1å›åˆ¶é™ï¼ˆPropertiesServiceãƒ•ãƒ©ã‚°ï¼‰ã§ãƒ«ãƒ¼ãƒ—é€šçŸ¥ã‚’é˜²æ­¢' },
      { type: 'fix', text: 'checkinGenkiApi: ãƒ¡ãƒ³ãƒãƒ¼çµŒç”±ã®æ„å›³ã—ãªã„æ‰“åˆ»ã‚’é˜²æ­¢ã™ã‚‹ã‚¬ãƒ¼ãƒ‰è¿½åŠ ' },
      { type: 'improve', text: 'insertCheckin: line_idãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨˜éŒ²ã—æ‰“åˆ»è€…ã®è¿½è·¡ãŒå¯èƒ½ã«' },
      { type: 'improve', text: 'GASè¨ºæ–­ãƒ„ãƒ¼ãƒ«: listAllTriggers(), repairTriggers(), cleanupReminderFlags() è¿½åŠ ' }
    ]
  },
  {
    ver: 'v0.5.0', date: '2026-02-17',
    title: 'OpenChaté‹å–¶çµ±åˆ',
    changes: [
      { type: 'feat', text: 'OpenChatä¸€è¦§ç®¡ç†: å›½/ã‚¨ãƒªã‚¢/ãƒ•ã‚§ãƒ¼ã‚º/ãƒªãƒ¼ãƒ€ãƒ¼ç®¡ç†ã€æ–°è¦ç™»éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤' },
      { type: 'feat', text: 'å®¶æ— Ã— OpenChatç´ã¥ã‘: å®¶æ—ã‚’ä»»æ„ã®OpenChatã«ç´ã¥ã‘ï¼ˆãƒã‚¤ãƒ³ãƒ‰/ã‚¢ãƒ³ãƒã‚¤ãƒ³ãƒ‰ï¼‰' },
      { type: 'feat', text: 'OpenChaté‹å–¶ãƒ‘ãƒãƒ«: æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ»æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»è©±é¡Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³' },
      { type: 'feat', text: 'é‹å–¶ãƒãƒ‹ãƒ¥ã‚¢ãƒ«: ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ãƒ»ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰è¾æ›¸ãƒ»å¯¾å¿œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…è”µ' },
      { type: 'feat', text: 'ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­å®šãƒšãƒ¼ã‚¸: OpenChatç´ã¥ã‘æ¸ˆã¿ã®å ´åˆã«ãƒªãƒ³ã‚¯è¡¨ç¤º' },
      { type: 'improve', text: 'DB: openchats, oc_post_log, oc_mod_log ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã€RLSãƒãƒªã‚·ãƒ¼è¨­å®š' },
      { type: 'improve', text: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: OpenChatæ•°ãƒ»ç·ãƒ¡ãƒ³ãƒãƒ¼æ•°ã‚’ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã«è¿½åŠ ' }
    ]
  },
  {
    ver: 'v0.4.7', date: '2026-02-15',
    title: 'æ ãƒ»èª²é‡‘ç®¡ç†',
    changes: [
      { type: 'feat', text: 'åŸºæœ¬æ ï¼ˆmax_membersï¼‰ã‚’å®¶æ—ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒ è¨­å®šå¯èƒ½ã«' },
      { type: 'feat', text: 'ãƒœãƒ¼ãƒŠã‚¹æ ï¼ˆbonus_slotsï¼‰ãƒ»æœ‰æ–™æ ï¼ˆpaid_slotsï¼‰ã®ç®¡ç†UI' },
      { type: 'fix', text: 'ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®¶æ—æ‹›å¾…ãƒšãƒ¼ã‚¸: åŸºæœ¬æ ãŒDBã‹ã‚‰å‹•çš„èª­ã¿è¾¼ã¿ã•ã‚Œã‚‹ã‚ˆã†ä¿®æ­£ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰2â†’DBå€¤ï¼‰' },
      { type: 'improve', text: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: æœ€è¿‘ç™»éŒ²å®¶æ—ãƒ†ãƒ¼ãƒ–ãƒ«ã«åŸºæœ¬æ è¡¨ç¤º' }
    ]
  },
  {
    ver: 'v0.4.5', date: '2026-02-13',
    title: 'Supabaseç§»è¡Œ & ç®¡ç†ãƒ‘ãƒãƒ«v1',
    changes: [
      { type: 'feat', text: 'Google Sheets â†’ Supabase PostgreSQL å®Œå…¨ç§»è¡Œ' },
      { type: 'feat', text: 'ç®¡ç†ãƒ‘ãƒãƒ«åˆç‰ˆ: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ãƒ†ãƒ¼ãƒ–ãƒ«é–²è¦§ã€SQL/RESTãƒ„ãƒ¼ãƒ«' },
      { type: 'feat', text: 'GAS 02_supabase.gs: å…¨é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ç¶­æŒã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é€éç§»è¡Œ' },
      { type: 'improve', text: 'RLSãƒãƒªã‚·ãƒ¼: anon keyã§ã®å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¢ã‚¯ã‚»ã‚¹è¨­å®š' },
      { type: 'improve', text: 'æ¥ç¶šè¨­å®š: LocalStorageã«ä¿å­˜ã—ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚è‡ªå‹•æ¥ç¶š' }
    ]
  },
  {
    ver: 'v0.4.0', date: '2026-02-08',
    title: 'LINE MVP åˆç‰ˆ',
    changes: [
      { type: 'feat', text: 'Rich Menu: å…ƒæ°—ã§ã™ / å¿ƒé…ãªå­ãŒã„ã‚‹ / ãƒ¬ãƒãƒ¼ãƒˆ / å®¶æ— / è¨­å®š' },
      { type: 'feat', text: 'å…ƒæ°—ãƒã‚§ãƒƒã‚¯: ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—æ‰“åˆ» + å®¶æ—è‡ªå‹•Pushé€šçŸ¥' },
      { type: 'feat', text: 'å¿ƒé…ãƒã‚§ãƒƒã‚¯: LIFF ãƒšãƒƒãƒˆé¸æŠ â†’ ç—‡çŠ¶é¸æŠ â†’ è¨˜éŒ² â†’ å®¶æ—é€šçŸ¥' },
      { type: 'feat', text: 'å®¶æ—ç®¡ç†: å®¶æ—ã‚³ãƒ¼ãƒ‰ç™ºè¡Œãƒ»å‚åŠ ãƒ»æ‹›å¾…ãƒ»ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†' },
      { type: 'feat', text: 'ãƒ¬ãƒãƒ¼ãƒˆLIFF: é€£ç¶šæ—¥æ•°ãƒ»å…ƒæ°—ç‡ãƒ»åœ°åŸŸçµ±è¨ˆã®å¯è¦–åŒ–' },
      { type: 'feat', text: 'è¨­å®šLIFF: å€‹äººæƒ…å ±ç·¨é›†ãƒ»ãƒšãƒƒãƒˆæƒ…å ±ç·¨é›†ãƒ»é€šçŸ¥è¨­å®š' },
      { type: 'feat', text: 'å®šæ™‚ãƒªãƒã‚¤ãƒ³ãƒ‰: AM8:00 / PM8:00 + 3æ—¥é€£ç¶šæœªæ‰“åˆ»ãƒ•ã‚©ãƒ­ãƒ¼' }
    ]
  }
];

function showChangelog() {
  var html = '';
  CHANGELOG.forEach(function(v) {
    html += '<div class="cl-ver">';
    html += '<div class="cl-ver-head">';
    html += '<span class="cl-ver-tag '+(v.current?'current':'old')+'">'+v.ver+'</span>';
    html += '<span class="cl-ver-date">'+v.date+'</span>';
    html += '<span class="cl-ver-title">'+escapeHtml(v.title)+'</span>';
    html += '</div>';
    html += '<ul class="cl-changes">';
    v.changes.forEach(function(c) {
      html += '<li class="'+c.type+'"><span class="cl-badge '+c.type+'">'+(c.type==='feat'?'NEW':c.type==='fix'?'FIX':'æ”¹å–„')+'</span>'+escapeHtml(c.text)+'</li>';
    });
    html += '</ul></div>';
  });
  document.getElementById('clBody').innerHTML = html;
  document.getElementById('clOverlay').classList.add('show');
}

function closeChangelog() {
  document.getElementById('clOverlay').classList.remove('show');
}
</script>
<!-- â•â•â• Changelog Modal â•â•â• -->
<div class="cl-overlay" id="clOverlay" onclick="if(event.target===this)closeChangelog()">
  <div class="cl-modal">
    <div class="cl-head">
      <span style="font-size:22px;">ğŸ“</span>
      <h2>æ›´æ–°å±¥æ­´</h2>
      <button class="cl-close" onclick="closeChangelog()">âœ•</button>
    </div>
    <div class="cl-body" id="clBody"></div>
  </div>
</div>

<!-- â•â•â• Login Overlay â•â•â• -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-card">
    <h1>ğŸ¾ PawBon Admin</h1>
    <p>ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³</p>
    <div class="field">
      <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
      <input type="email" id="loginEmail" placeholder="admin@example.com" onkeydown="if(event.key==='Enter')adminLogin()">
    </div>
    <div class="field">
      <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
      <input type="password" id="loginPass" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" onkeydown="if(event.key==='Enter')adminLogin()">
    </div>
    <button class="login-btn" id="loginBtn" onclick="adminLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <div class="login-error" id="loginError"></div>
  </div>
</div>

</body>
</html>
